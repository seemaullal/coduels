(function(){function focusElement(event){var container;blurElement();container=$(event.target).parent().parent();container.addClass("active-signup-icon");}
function blurElement(){$(".active-signup-icon").removeClass("active-signup-icon");}
$(function(){$(".signup-input").on("focus",focusElement);$(".signup-input").on("blur",blurElement);});global.fl.shared={focusInputElement:focusElement,blurInputElement:blurElement};}());(function(){var f;function handleModalClick(event){if(event.target==f.get(0)){event.preventDefault();f.hide();}}
function showLoginForm(){f=$("#fl-signin-form-container");f.show();f.on('click',handleModalClick);$('.signin-close',f).on('click',function(){f.hide();});$(".signup-input",f).on("focus",global.fl.shared.focusInputElement);$(".signup-input",f).on("blur",global.fl.shared.blurInputElement);$("[name=username]",f).focus();}
function handleSignIn(event){event.preventDefault();showLoginForm();}
$(".sign-in-action").on("click",handleSignIn);fl.showLoginForm=showLoginForm;}());(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports,__webpack_require__){"use strict";__webpack_require__(1);var addFiles,editorSettings,BreadCrumbs,buffer,editorAction,EditorContainerView,editorModels,editorRoutes,editPermissions,errorModalView,extMessaging,Filetree,FiletreeView,FlooHandler,flux,handlerAction,menu,menuView,MessagesView,messageAction,mugshot,panel,PanelView,perms,prefs,solicitation_view,Terminals,theme,Theme,UserlistView,usersModel,WorkerActions,WebRTC,webrtcActions;messageAction=__webpack_require__(2);errorModalView=__webpack_require__(3);messageAction.onMODAL(function(msg){return errorModalView.show(msg);});EditorContainerView=__webpack_require__(26);FiletreeView=__webpack_require__(27);Filetree=__webpack_require__(9);menuView=__webpack_require__(28);usersModel=__webpack_require__(21);UserlistView=__webpack_require__(20);MessagesView=__webpack_require__(13);PanelView=__webpack_require__(29);buffer=__webpack_require__(4);editorAction=__webpack_require__(5);handlerAction=__webpack_require__(12);panel=__webpack_require__(30);flux=__webpack_require__(11);menu=__webpack_require__(31);perms=__webpack_require__(16);editorModels=__webpack_require__(6);Terminals=__webpack_require__(18).Terminals;BreadCrumbs=__webpack_require__(32);FlooHandler=__webpack_require__(10);prefs=__webpack_require__(17);editorRoutes=__webpack_require__(33);theme=__webpack_require__(19);mugshot=__webpack_require__(15);addFiles=__webpack_require__(34);editorSettings=__webpack_require__(35);editPermissions=__webpack_require__(36);Theme=__webpack_require__(19);extMessaging=__webpack_require__(8);solicitation_view=__webpack_require__(37);WorkerActions=__webpack_require__(24);WebRTC=__webpack_require__(22);webrtcActions=__webpack_require__(38);$(function web_editor(){var handler,hPanels,panels,sidePanel,leftPanels,rightPanels,sidepanelHeight,FileMenu,ViewMenu,SettingsMenu,HelpMenu,CollabMenu,ThemeMenu,menuBar,editors,users,me,bufs,filetree,panelHeight,webrtc,centerPanel,terminals,solicitationButton;flux.settings.debug=fl.editor_settings.debug;flux.settings.namespace=fl.editor_settings.path;bufs=new buffer.Buffers();editors=new editorModels.Editor([],bufs);editors.createEditor();users=new usersModel.Users();terminals=new Terminals([],{users:users});me=new usersModel.User();filetree=new Filetree();addFiles.init(fl.editor_settings.repo_info);editorSettings.init();editPermissions.init(fl.editor_settings.room_owner,fl.editor_settings.room);if(!(prefs.theme in Theme.theme)){prefs.theme="lowlight_customized";}
$(document.body).addClass("theme-"+prefs.theme);function mugHandler(){mugshot.stop();if(perms.indexOf("datamsg")<0){return;}
if(prefs.mugshots&&!prefs.dnd){mugshot.start(me.getMyConnection());}else{mugshot.cancelSnapshot();}}
WorkerActions.onMESSAGE(function(m){var data=m.data;switch(data.name){case"error":console.error(JSON.stringify(data.data));return;default:console.log(m);}});perms.on(mugHandler);prefs.on("dnd",mugHandler);prefs.on("mugshots",mugHandler);editorAction.set(bufs,terminals,prefs);handlerAction.setBuffers(bufs);handler=new FlooHandler(fl.editor_settings,users,me,bufs,filetree,terminals);webrtc=new WebRTC(users,me);panelHeight=$(window).outerHeight()-$("#editor-top-bar").outerHeight();leftPanels=new panel.Panels({size:panelHeight,id:"leftPanels",items:[{headerClass:"sidebar-header sidebar-header-top",id:"FiletreeView",component:FiletreeView,props:{tree:filetree,name:fl.editor_settings.room,terminals:terminals},}]});leftPanels.load();rightPanels=new panel.Panels({id:"rightPanels",size:panelHeight,items:[{headerClass:"sidebar-header sidebar-header-top",id:"UserlistView",component:UserlistView.UserlistView,props:{users:users,me:me,prefs:prefs},}]});rightPanels.load();centerPanel=new panel.Panels({id:"centerPanel",size:panelHeight,items:[{id:"EditorView",component:EditorContainerView,props:{bufs:bufs,editors:editors},minSize:100,},{headerClass:"sidebar-header",id:"MessagesView",defaultSize:145,minSize:5,grid:70,component:MessagesView,props:{messages:messageAction.messages,users:users,focus:false},}],});centerPanel.load();hPanels=new panel.Panels({size:$(window).width(),id:"hPanels",items:[{id:"leftPanels",component:PanelView.PanelViewVertical,props:{panels:leftPanels},defaultSize:225,minSize:0,},{id:"centerPanels",component:PanelView.PanelViewVertical,props:{panels:centerPanel},minSize:262,},{id:"rightPanels",component:PanelView.PanelViewVertical,props:{panels:rightPanels},defaultSize:228,minSize:5,grid:228,}]},true);var vPanels=new panel.Panels({size:panelHeight,id:"vPanels",draggable:false,items:[{id:"interactive",component:solicitation_view.SolicitationView,props:{},size:0,},{id:"hPanels",component:PanelView.PanelViewHorizontal,props:{panels:hPanels,size:panelHeight},size:panelHeight,}]});vPanels.load();React.render(new React.createElement(PanelView.PanelViewVertical,{panels:vPanels}),document.getElementById("hPanels"));FileMenu=new menu.Menu({name:"File",items:[{name:"Add files",icon:"upload",action:editorAction.upload,},{name:"New File",icon:"plus",action:editorAction.new_file_prompt,},{name:"Download",icon:"download",action:editorAction.download,},{name:"Rename",icon:"pencil",action:editorAction.rename_prompt,},]});CollabMenu=new menu.Menu({name:"Collaborate",items:[{name:"Follow changes",icon:"magnet",action:editorAction.follow,pref:"following",selected:prefs.following,},{name:"Summon",icon:"bullhorn",action:editorAction.summon,perm:"highlight",},{name:"Request Permission to Edit",icon:"comment",action:editorAction.request_perms,perm:"request_perms",},{name:"Workspace permissions",icon:"flag",action:handlerAction.edit_permissions,perm:"patch",},{name:"Open in Google Hangout",icon:"facetime-video",action:handlerAction.hangout,perm:"patch",},{name:"Start Screen Sharing",icon:"picture",action:webrtcActions.start_screen,perm:"patch"}]});ThemeMenu=new menu.Menu({name:"Theme",items:_.map(theme.theme,function(name,id){return{name:name,action:editorAction.pref.bind(editorAction,"theme",id),theme:id,selected:prefs.theme===id,};}),});SettingsMenu=new menu.Menu({name:"Settings",items:[{name:"Mugshots",icon:"user",action:function(){editorAction.pref("mugshots",!prefs.mugshots);},pref:"mugshots",selected:prefs.mugshots,},{name:"Notifications",icon:"bell",action:function(){editorAction.pref("showNotifications",!prefs.showNotifications);messageAction.notify("Browser notifications "+(prefs.showNotifications?"enabled":"disabled"),true);},pref:"showNotifications",selected:prefs.showNotifications,},{name:"Sound effects",icon:"volume-up",action:function(){editorAction.pref("sound",!prefs.sound);},pref:"sound",selected:prefs.sound,},{name:"Do not Disturb",icon:"ban-circle",action:function(){editorAction.pref("dnd",!prefs.dnd);},pref:"dnd",selected:prefs.dnd,},{name:"Reset UI",icon:"repeat",action:editorAction.reset_ui,},{name:"Audio Only",icon:"eye-close",action:function(){var audioOnly=!prefs.audioOnly;if(prefs.mugshots&&audioOnly){editorAction.pref("mugshots",false);}
editorAction.pref("audioOnly",audioOnly);},pref:"audioOnly",selected:prefs.audioOnly,},{name:"Editor Settings",icon:"cog",action:editorAction.editor_settings,}]});ViewMenu=new menu.Menu({name:"View",items:[{name:"Split Vertical",icon:"resize-vertical",action:function(){editorAction.split_editor("vertical");}},{name:"Split Horizontal",icon:"resize-horizontal",action:function(){editorAction.split_editor("horizontal");}},{name:"Clear Splits",icon:"resize-small",action:function(){editorAction.unsplit_editor();}},],});HelpMenu=new menu.Menu({name:"Help",items:[{name:"WebRTC",icon:"facetime-video",href:"/help/webrtc",},{name:"FlooTTY",icon:"phone-alt",href:"/help/flootty",},{name:"Plugins",icon:"edit",href:"/help/plugins",},],});menuBar=new menu.MenuBar([FileMenu,CollabMenu,ThemeMenu,SettingsMenu,ViewMenu,HelpMenu]);React.render(new React.createElement(BreadCrumbs,null),document.getElementById("buf_path"));React.render(new React.createElement(menuView.MenuBarView,{menubar:menuBar}),document.getElementById("floobits-menu"));solicitationButton=document.getElementById("solicitation_button");if(solicitationButton){React.render(new React.createElement(solicitation_view.SolicitationButton,null),solicitationButton);}
editorRoutes.initRoutes(fl.editor_settings.room_owner,fl.editor_settings.room);handler.go(fl.editor_settings.room_owner,fl.editor_settings.room,fl.editor_settings.path);});},function(module,exports,__webpack_require__){var flog,gl=self,nativeConsole=console,ignoredErrors=[],FlErrors={},flio=__webpack_require__(39);if(!console){gl.console={};}
_.each(["log","info","debug","error","table","trace","warn"],function(f){if(!_.isFunction(console[f])){console[f]=function(){};}});function FlError(description,path,line,column,error){this.description=description||"";this.path=path||"";this.line=line||0;this.column=column||0;this.stack=error?error.stack:"";this.id=this.toString();this.ignored=false;this.occurrences=1;this.location=self.location.href;this.lastSent=0;this.sendingAt=0;if(line===0){this.ignored=true;}
if(path===""){this.ignored=true;}
this.traceLogs=false;}
FlError.prototype.toJSON=function(){return{column:this.column,description:this.description,ignored:this.ignored,lastSent:this.lastSent,line:this.line,location:this.location,occurrences:this.occurrences,path:this.path,sendingAt:this.sendingAt,stack:this.stack,};};FlError.prototype.scheduleSend=function(){var second,minute,hour,sendingAt,lastSent,now,delay;second=1000;minute=second*60;hour=minute*60;delay=hour;now=new Date().getTime();sendingAt=this.sendingAt;console.log("sendingAt?",sendingAt,this.id);if(sendingAt){return;}
console.log("scheduling sends");_.delay(_.bind(function(){console.log("sending in a second");this.send_();},this),second);lastSent=this.lastSent;sendingAt=now;sendingAt+=now-lastSent;if(sendingAt>now+delay){sendingAt=now+delay;}
this.sendingAt=sendingAt;_.delay(_.bind(function(){console.log("sending from scheduleSend");this.send_();this.occurrences=0;this.sendingAt=0;this.lastSent=lastSent;},this),sendingAt-now);};FlError.prototype.send_=function(){if(!this.occurrences){return;}
flog.sError("JavaScript FlError: "+this.id,this.toJSON());};function sendToServer(level,subject,message){console.log("sending to server",level,subject,message);if(_.indexOf(ignoredErrors,subject)!==-1){console.log("Ignoring error.",subject);return;}
if(!self.window){self.postMessage({name:"error",data:{subject:subject,message:message}});return;}
$.ajax({type:"POST",url:flio.apiURL("log"),data:JSON.stringify({subject:subject,message:message}),success:function(){},error:function(xhr){if(xhr.status===400){console.log("Ignored error",xhr.responseJSON);ignoredErrors.push(subject);}},dataType:'json',contentType:'application/json'});}
FlError.prototype.toString=function(){return[this.description,this.path,this.line.toString(),this.column.toString(),this.stack.toString()].join(" ");};function Log(){try{this.logLevel_=fl.editor_settings.logLevel;}catch(e){this.logLevel_=Log.Level.ERROR;console.log("Setting log level to error because of no editor_settings.logLevel.",e);}
this.namespace_=null;}
Log.prototype.logLevel=function(){return this.logLevel_;};Log.prototype.setLogLevel=function(level){this.logLevel_=level;};Log.prototype.namespace=function(){return this.namespace_;};Log.prototype.setNamespace=function(namespace){this.namespace_=namespace;};Log.prototype.log_=function(logLevel,args){if(logLevel>this.logLevel()){return;}
if(this.traceLogs){nativeConsole.log("tracing",this.traceLogs);this.trace();}
args=_.toArray(args);if(this.namespace_){args.unshift(this.namespace_);}
switch(logLevel){case Log.Level.INFO:nativeConsole.info.apply(nativeConsole,args);break;case Log.Level.LOG:nativeConsole.log.apply(nativeConsole,args);break;case Log.Level.DIR:nativeConsole.dir.apply(nativeConsole,args);break;case Log.Level.ERROR:nativeConsole.error.apply(nativeConsole,args);break;case Log.Level.DEBUG:nativeConsole.debug.apply(nativeConsole,args);break;default:break;}};Log.prototype.table=function(args){if(this.logLevel_>=Log.Level.LOG){nativeConsole.table.apply(nativeConsole,arguments);}};Log.prototype.trace=function(args){if(this.logLevel_>=Log.Level.LOG){nativeConsole.trace.apply(nativeConsole,arguments);}};Log.prototype.log=function(args){this.log_(Log.Level.LOG,arguments);};Log.prototype.dir=function(args){this.log_(Log.Level.DIR,arguments);};Log.prototype.info=function(args){this.log_(Log.Level.INFO,arguments);};Log.prototype.error=function(args){this.log_(Log.Level.ERROR,arguments);};Log.prototype.debug=function(args){this.log_(Log.Level.DEBUG,arguments);};Log.prototype.warn=function(args){this.log_(Log.Level.INFO,arguments);};Log.prototype.sError=function(subject,message){sendToServer("ERROR",subject,message);};Log.prototype.triggerErrorOnPurpose=function(){_.defer(function(){gl.scream();});};Log.prototype.testIgnoredError=function(){_.defer(function(){throw"Ignored terror test";});};Log.Level={ERROR:0,INFO:1,DIR:2,LOG:2,DEBUG:3};flog=new Log();flog.ignoredErrors=ignoredErrors;gl.console=flog;module.exports={setNamespace:flog.setNamespace.bind(flog)};self.onerror=function handleError(description,path,line,column,opt_error){var error,id;if(!line){return;}
if(!path){return;}
error=new FlError(description,path,line,column,opt_error);id=error.toString();if(id in FlErrors){error=FlErrors[id];}else{FlErrors[id]=error;}
error.occurrences++;error.scheduleSend();};self.flog=flog;},function(module,exports,__webpack_require__){"use strict";var buttonModel=__webpack_require__(40),messagesModel=__webpack_require__(41),flux=__webpack_require__(11),NOTIFICATION_DURATION=5*1000,prefs=__webpack_require__(17),Actions,notifications=[];self.addEventListener("beforeunload",function(){_.each(notifications,function(n){n.close();});});Actions=flux.createActions({notify:function(msg,force){var n;if(force!==true){if(!prefs.showNotifications||!prefs.canNotify){return;}
if(window.document.hasFocus&&window.document.hasFocus()){return;}}
if(fl.editor_settings){msg=fl.editor_settings.room+": "+msg;}
n=new Notification(msg,{icon:"/static/images/icon_64x64.png"});notifications.push(n);n.onshow=function(){_.delay(function(){n.close();notifications.splice(notifications.indexOf(n),1);},NOTIFICATION_DURATION);};},log:function(msg,opt_alertLvl,notify){var msgObject;opt_alertLvl=opt_alertLvl||messagesModel.LEVEL.INFO;msgObject=new messagesModel.Message({msg:msg,type:"log",level:opt_alertLvl,});this.messages.insert(msgObject,0);if(notify===false){return msgObject;}
if(notify===true||opt_alertLvl>=messagesModel.LEVEL.WARNING){this.notify(msg);}
return msgObject;},info:function(msg){return this.log(msg,messagesModel.LEVEL.INFO);},success:function(msg){return this.log(msg,messagesModel.LEVEL.SUCCESS);},warn:function(msg){return this.log(msg,messagesModel.LEVEL.WARNING);},error:function(msg){return this.log(msg,messagesModel.LEVEL.ERROR);},modal:function(msg){return msg;},interactive:function(msg,buttons){var msgObject=new messagesModel.Message({msg:msg,type:"interactive",buttons:buttons.map(function(b){return new buttonModel.Button(b);}),});this.messages.insert(msgObject,0);return msgObject;},user:function(username,msg,time){var msgObject=new messagesModel.Message({type:"user",username:username,msg:msg,time:time*1000||Date.now(),});this.messages.insert(msgObject,0);if(username!==fl.username){this.notify("<"+username+"> "+msg);}
return msgObject;},messages:new messagesModel.Messages(),});module.exports=new Actions();},function(module,exports,__webpack_require__){"use strict";var ErrorView,modal=__webpack_require__(42);ErrorView=React.createClass({displayName:"ErrorView",mixins:[modal.ReactModalMixin],renderBody:function(){return(React.createElement("p",{className:"alert-block alert-error"},this.props.message));},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"OK")));}});function show(message){modal.showModal(ErrorView,{message:message,title:"Floobits Error"});}
module.exports={show:show};},function(module,exports,__webpack_require__){"use strict";var Buffer,Buffers,flux=__webpack_require__(11),util=__webpack_require__(43),editorAction=__webpack_require__(5),handlerAction=__webpack_require__(12),messageAction=__webpack_require__(2),dmp=new diff_match_patch(),fields=flux.FieldTypes;function guid(id,owner,workspace){return owner+"/"+workspace+"/"+id;}
Buffer=flux.createModel({modelName:"Buffer",fieldTypes:{buf:fields.string,highlights:fields.array,id:fields.number,md5:fields.number,open:fields.bool,path:fields.string,visible:fields.bool,encoding:fields.string,populated:fields.bool,},getDefaultFields:function(){return{buf:null,encoding:"utf8",};},});Buffer.prototype.setGetBufTimeout=function(){var id=this.id;this.strike_timeout=setTimeout(function(){console.log("strikeout triggered because before md5s were different");handlerAction.get_buf(id);},1100);};Buffer.prototype.setSaveBufTimeout=function(){var id=this.id;clearTimeout(this.saveTimeout);this.saveTimeout=setTimeout(function(){handlerAction.save_buf(id);},2500);};Buffer.prototype.patch=function(patch_obj){var buf,clean_patch=true,newTextPointer,i,md5_before,md5_after,patches,result,text;if(!this.populated){return;}
try{patches=dmp.patch_fromText(patch_obj.patch);}catch(e){throw new Error("Received Invalid bytes from workspace."+e.toString()+"Patch was: "+patch_obj.patch);}
console.debug("applying",patch_obj.patch,"to",patch_obj.path);md5_before=util.md5(this.buf);if(patch_obj.md5_before!==md5_before){console.log("starting md5s don't match! ours:",md5_before,"patch's:",patch_obj.md5_before);}
if(_.isEmpty(patches)){console.log("Got an empty set of patches.");return;}
try{result=dmp.patch_apply(patches,this.buf);}catch(e){console.sError("Patch apply error on web.",{patch:patches,buf:this.buf,result:result,subject:"Patch Apply Failed ",error:e,message:{description:"Patch apply failed"},});throw e;}
text=result[0];for(i=0;i<result[1].length;i++){if(result[1][i]!==true){clean_patch=false;break;}}
if(clean_patch===false){console.error("Couldn't apply patch. Getting buffer from server...",result);messageAction.log("Couldn't apply patch to buffer "+this.path+" Re-fetching buffer from server...");this.populated=false;clearTimeout(this.strike_timeout);handlerAction.get_buf(this.id);return;}
md5_after=util.md5(text);if(patch_obj.md5_before===md5_before&&patch_obj.md5_after!==md5_after){console.log("md5's don't match! buffer is",md5_after,"but we expected",patch_obj.md5_after);this.populated=false;clearTimeout(this.strike_timeout);handlerAction.get_buf(this.id);return;}
newTextPointer=[text];editorAction.patch(this.id,result,newTextPointer);this.set({'buf':newTextPointer[0]},{silent:true});if(this.buf===text){clearTimeout(this.strike_timeout);if(patch_obj.md5_after!==md5_after){this.setGetBufTimeout();}}else if(patch_obj.md5_before!==md5_before){clearTimeout(this.strike_timeout);this.setGetBufTimeout();}else{console.log("replacing didn't match :( should be",text,"but was",this.buf);try{console.log(dmp.patch_toText(dmp.patch_make(this.buf,text)));}catch(e){console.log("Error making patch of text --> this.buf:",e);}}};Buffers=flux.createCollection({modelName:"Buffers",model:Buffer,});module.exports={Buffer:Buffer,Buffers:Buffers,};},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11),theme=__webpack_require__(19),perms=__webpack_require__(16),actions,line=null,lastOpenedBuffer=null;actions=flux.createActions({kick:function(connectionIDorUsername){return connectionIDorUsername;},open:function(bufferID,line_){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with id "+bufferID);}
lastOpenedBuffer=buf;line=line_;return[buf,line_];},open_term:function(id){var term=this.terminals.get(id);if(!term){return new Error("No terminal with id "+id+" was found");}
return term;},close_term:function(id){var term=this.terminals.get(id);if(!term){return new Error("No terminal with id "+id+" was found");}
return term;},close:function(bufferID){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with id "+bufferID);}
if(buf===lastOpenedBuffer){lastOpenedBuffer=null;}
return buf;},split_editor:function(type){return type;},unsplit_editor:function(){return;},open_from_path:function(path){var buffer;buffer=this.buffers.find(function(buffer){return buffer.path===path;});if(!buffer){return new Error("Buffer not found: "+path);}
this.open(buffer.id);return buffer;},create_buf:function(path,buf,type,switchToBuf){return[path,buf,type,switchToBuf];},created:function(buf){return buf;},highlight:function(bufferID,ranges,connectionID,username,summon){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with id "+bufferID);}
return[buf,ranges,connectionID,username,summon];},remove_highlight:function(connectionID){return connectionID;},patch:function(bufferID,dmpPatchResult,newTextPointer){return[bufferID,dmpPatchResult,newTextPointer];},imagify:function(buf){return buf;},new_file_prompt:function(pathPrefix){return pathPrefix||"";},new_file:function(path){var id;id=this.on(this.CREATED,function(buf){if(buf.path===path){this.open(buf.id);this.off(id);}},this);return path;},delete_buf:function(bufferID){return bufferID;},download:function(){var bufName,data,encoding;if(!lastOpenedBuffer){return;}
bufName=lastOpenedBuffer.path.split("/").slice(-1)[0];data=lastOpenedBuffer.buf;encoding="text/plain;charset=UTF-8";if(lastOpenedBuffer.encoding==="base64"){data=StringView.base64ToBytes(data);encoding="application/octet-stream";}
saveAs(new Blob([data],{type:encoding,endings:"transparent"}),bufName);return;},rename_prompt:function(){return;},start_rename_prompt:function(bufferId){var buffer=this.buffers.get(bufferId);if(!buffer){return new Error("Couldn't find buffer for buffer id: "+bufferId);}
return buffer.path;},rename_request:function(newPath){if(!lastOpenedBuffer){return;}
lastOpenedBuffer.path=newPath;this.rename(lastOpenedBuffer);this.open(lastOpenedBuffer.id,line);return[lastOpenedBuffer,newPath];},rename:function(buf){return buf;},fullscreen:function(){return;},follow:function(username){if(username){this.prefs.followUsers.toggle(username);return this.pref("followUsers",this.prefs.followUsers,true);}
return this.pref("following",!this.prefs.following);},summon:function(){return;},request_perms:function(){return;},pref:function(name,value,force){if(this.prefs[name]===value&&!force){return new Error("Preference "+name+" already has value "+value);}
this.prefs[name]=value;this.prefs.save(fl.editor_settings.prefs_path);return[this.prefs,name];},pull_repo:function(repoType,repoURL){return[repoType,repoURL];},upload:function(){return;},open_default_buf:function(filetree){var keys,i,buffer,README,textfile,dirs=[],leaf;keys=Object.keys(filetree);for(i=0;i<keys.length;i++){leaf=filetree[keys[i]];if(_.isNumber(leaf)){buffer=this.buffers.get(leaf);if(buffer.path.split("/").pop().indexOf("README")!==-1){this.open(buffer.id);return true;}
if(!textfile&&buffer.encoding==="utf8"){textfile=buffer;}}else{dirs.push(leaf);}}
if(textfile){this.open(textfile.id);return true;}
for(i=0;i<dirs.length;i++){if(this.open_default_buf(dirs[i])){return;}}
return false;},editor_settings:function(){return;},tab_settings_change:function(){return;},});actions.prototype.set=function(buffers,terminals,prefs){this.buffers=buffers;this.terminals=terminals;this.prefs=prefs;};module.exports=new actions();},function(module,exports,__webpack_require__){"use strict";var Editor,AceEditorModel,LANGS,id=0,AceDocument=ace.require("ace/document").Document,handlerAction=__webpack_require__(12),EditSession=ace.require("ace/edit_session").EditSession,UndoManager=ace.require("ace/undomanager").UndoManager,AceRange=ace.require("ace/range").Range,prefs=__webpack_require__(17),dmp=new diff_match_patch(),util=__webpack_require__(43),editorAction=__webpack_require__(5),flux=__webpack_require__(11);AceEditorModel=flux.createModel({modelName:"AceEditor",fieldTypes:{id:flux.FieldTypes.number,ace:flux.FieldTypes.object.ephemeral(),tabs:flux.List,activeTab:flux.FieldTypes.number,activeBuf:flux.FieldTypes.number,terminals:flux.List,elem:flux.FieldTypes.object.ephemeral(),active:flux.FieldTypes.bool},getID:function(){return"editor_"+this.id;},getDefaultFields:function(args){var elem=document.createElement("div");return{elem:elem,ace:ace.edit(elem),terminals:new flux.List(),tabs:new flux.List(),};},init:function(){this.elem.setAttribute("id",this.getID());this.elem.className="ace_editor";editorAction.onOPEN_TERM(function(term){if(!this.active){return;}
if(this.terminals.indexOf(term)!==-1){return;}
this.terminals.push(term);},this);editorAction.onCLOSE_TERM(function(term){if(!this.active){return;}
console.log("before this.terminals",this.terminals);this.terminals.toggle(term);console.log("after this.terminals",this.terminals);},this);}});Editor=flux.createCollection({model:AceEditorModel,activeEditor:null,name:"Editor",handlers:{},docs:{},editorSessions:{},highlights:{},bufs:null,ignoreChanges:false,init:function(args,bufs){this.bufs=bufs;editorAction.on(function(event,arg0,arg1){var args=_.toArray(arguments).slice(1);switch(event){case editorAction.OPEN:this.openBuffer.apply(this,args);break;case editorAction.CLOSE:this.closeBuffer.apply(this,args);break;case editorAction.PATCH:this.patch.apply(this,args);break;case editorAction.HIGHLIGHT:this.highlight.apply(this,args);break;case editorAction.REMOVE_HIGHLIGHT:this.removeHighlight.apply(this,args);break;default:return;}},this);},activateEditor:function(model){this.activeEditor=model.id;this.silent_=true;this.map(function(editor){editor.active=editor.id===model.id;});this.silent_=false;},createEditor:function(){var model=new AceEditorModel();model.docs=this.docs;model.editorSessions=this.editorSessions;this.add(model);model.ace.on("focus",this.activateEditor.bind(this,model));this.activateEditor(model);},on_selectionChange:function(bufID,event,selection){var ranges,following,doc,iter;if(this.ignoreChanges){return;}
doc=selection.doc;following=prefs.isFollowing();prefs.pauseFollowMode(2000);iter=selection.getAllRanges();if(iter.length===0){iter=[selection.getRange()];}
ranges=_.map(iter,function(r){return[doc.positionToIndex(r.start,0),doc.positionToIndex(r.end,0)];});handlerAction.send_highlight(bufID,ranges,following);},removeHighlight:function(connectionID){var highlights=this.highlights[connectionID];_.each(highlights,function(highlight){var es=this.editorSessions[highlight.bufID];if(!es){return;}
try{es.removeMarker(highlight.markerID);}catch(e){console.log(e);}},this);this.highlights[connectionID]=[];},on_documentChange:function(bufID,change,doc){var buf,patches,patchInfo,newTxt;if(this.ignoreChanges){return;}
buf=this.bufs.get(bufID);if(!buf||!buf.populated){return;}
newTxt=doc.getValue();patches=dmp.patch_make(buf.buf,newTxt);if(patches.length===0){return;}
patchInfo={md5_before:util.md5(buf.buf),md5_after:util.md5(newTxt),id:buf.id,patch:dmp.patch_toText(patches)};handlerAction.patch_buf(patchInfo);buf.set({'buf':newTxt},{silent:true});prefs.pauseFollowMode(2000);},openBuffer:function(buf){var doc,es,bufID=buf.id,firstPopulation=true,handlers=this.handlers[bufID];if(!handlers){handlers=this.handlers[bufID]={};}
doc=this.docs[bufID];if(!doc){doc=new AceDocument(buf.buf||"");doc.setNewLineMode("unix");handlers.documentChange=this.on_documentChange.bind(this,bufID);doc.on("change",handlers.documentChange);this.docs[bufID]=doc;}
es=this.editorSessions[bufID];if(!es){es=new EditSession(doc);console.log("set",buf,". mode to "+util.modeForFile(buf.path));es.setMode("ace/mode/"+util.modeForFile(buf.path));es.setUseWrapMode(true);handlers.selectionChange=this.on_selectionChange.bind(this,bufID);es.selection.on("changeCursor",handlers.selectionChange);es.selection.on("changeSelection",handlers.selectionChange);configureEditSession(es);this.editorSessions[bufID]=es;}
if(!_.isUndefined(handlers.buf)){return;}
handlers.buf=buf.on(function(){if(!buf.populated){return;}
this.setDoc(buf);if(firstPopulation){firstPopulation=false;es.setUndoManager(new UndoManager());}},this);},closeBuffer:function(buf){var doc,es,close=0,handlers=this.handlers[buf.id];this.forEach(function(editor){editor.tabs.forEach(function(id){if(id===buf.id){close++;}});});if(close>1){return;}
delete this.handlers[buf.id];if(!handlers){return;}
doc=this.docs[buf.id];doc.removeListener("change",handlers.documentChange);delete this.docs[buf.id];es=this.editorSessions[buf.id];es.selection.removeListener("changeCursor",handlers.selectionChange);es.selection.removeListener("changeSelection",handlers.selectionChange);delete this.editorSessions[buf.id];buf.off(handlers.buf);},setDoc:function(buf){var bytes,file_elem,hex,es,doc,img,left,top,positions={},mime_type=util.image_mime_from_extension(buf.path);this.ignoreChanges=true;this.map(function(editor){if(buf.id!==editor.activeBuf){return;}
try{positions[editor.id]=editor.ace.getCursorPosition();}catch(ignored){}});es=this.editorSessions[buf.id];left=es.getScrollLeft();top=es.getScrollTop();doc=this.docs[buf.id];console.log("setting buf",buf.path);if(buf.encoding!=="base64"){if(doc){doc.setValue(buf.buf);}}else{bytes=StringView.base64ToBytes(buf.buf);if(mime_type){buf.img="data:image/"+mime_type+";base64,"+buf.buf;editorAction.imagify(buf);}else{hex=StringView.bytesToHex(bytes);if(doc){doc.setValue(hex);}}}
_.each(positions,function(pos,id){this.get(id).ace.moveCursorToPosition(pos);},this);es.setScrollLeft(left);es.setScrollTop(top);this.ignoreChanges=false;},highlight:function(buf,ranges,connectionID,username,summon){var doc,gotoLine,id,es,args=arguments;doc=this.docs[buf.id];if(!doc||!buf.populated){if(!summon&&!prefs.isFollowing(username)){return;}
id=buf.on(function(name){if(!buf.populated){return;}
this.highlight.apply(this,args);buf.off(id);},this);editorAction.open(buf.id);return;}
this.removeHighlight(connectionID);es=this.editorSessions[buf.id];_.each(ranges,function(range){var markerID,start,end,klass="highlight highlight_"+util.userColor(username);if(range[0]===range[1]){range[1]++;}
start=doc.indexToPosition(range[0],0);end=doc.indexToPosition(range[1],0);markerID=es.addMarker(new AceRange(start.row,start.column,end.row,end.column),klass,username,true);this.highlights[connectionID].push({bufID:buf.id,markerID:markerID});gotoLine=start.row;},this);if(summon){prefs.pauseFollowMode(5000);}
if(!summon&&!prefs.isFollowing(username)){return;}
editorAction.open(buf.id,gotoLine+1);},patch:function(bufID,dmpPatchResult,newTextPointer){var doc=this.docs[bufID],buf=this.bufs.get(bufID);if(!doc){return;}
if(!buf.populated){return;}
this.ignoreChanges=true;_.each(dmpPatchResult[2],function(patch){var offset=patch[0],length=patch[1],replace=patch[2],startPos=doc.indexToPosition(offset,0),endPos=doc.indexToPosition(offset+length,0),r=new AceRange(startPos.row,startPos.column,endPos.row,endPos.column);console.log("replacing",r,replace);this.map(function(editor){editor.ace.$blockScrolling++;});doc.replace(r,replace);this.map(function(editor){editor.ace.$blockScrolling--;});},this);newTextPointer[0]=doc.getValue();this.ignoreChanges=false;},});function configureEditSession(es){console.log("Configuring editor session");es.setTabSize(localStorage.getItem("tabSize")||2);es.setUseSoftTabs(_.isNull(localStorage.getItem("softTabs"))?true:localStorage.getItem("softTabs")=="true");}
module.exports={Editor:Editor,configureEditSession:configureEditSession,};},function(module,exports,__webpack_require__){"use strict";var AceEditorView,dmp,LANGS,EditorView,TerminalView,TabView,editorAction=__webpack_require__(5),perms=__webpack_require__(16),handlerAction=__webpack_require__(12),EditSession=ace.require("ace/edit_session").EditSession,util=__webpack_require__(43),flux=__webpack_require__(11),prefs=__webpack_require__(17),editorModel=__webpack_require__(6),Theme=__webpack_require__(19);TabView=React.createClass({displayName:"TabView",render:function(){var bufId=this.props.bufId,path=this.props.path;return(React.createElement("li",{className:"editor-tab"+(this.props.active?" active":""),id:"editor-tab-"+bufId,"data-buf-id":bufId,"data-path":path},React.createElement("a",{className:"editor-tab-name-container",href:"#",title:path},React.createElement("span",{className:"editor-tab-name"},this.props.fileName),React.createElement("span",{className:"glyphicon glyphicon-remove-circle editor-tab-close"}))));}});EditorView=React.createClass({displayName:"EditorView",mixins:[flux.createAutoBinder(["editor.terminals"])],resize:function(){this.props.editor.ace.resize(true);},handleDrag:function(){this.resize();},handleDragStop:function(){this.resize();},getInitialState:function(){return{showEditor:true,showTerminal:false,};},tabs:null,activateTab_:function(type,id){var tab;this.tabs.forEach(function(tab){tab.active=false;});tab=_.find(this.tabs,function(tab){return tab.type===type&&tab.id===id;});if(tab){tab.active=true;}
return tab;},openTab_:function(type,id,name,path){var tab=this.activateTab_(type,id);if(!tab){this.tabs.push({path:path||name,fileName:name,active:true,id:id,type:type,bufId:type+'-'+id,});}
this.props.editor.set({activeTab:id},{silent:true});this.props.editor.tabs.set(_.pluck(this.tabs,"id"),{silent:true});this.setState({showEditor:type==="buf",showTerminal:type==="term",});},closeTab_:function(type,id){var index=-1,tab;tab=_.find(this.tabs,function(tab,i){index=i;return tab.id===id&&tab.type===type;});if(!tab){return;}
this.tabs.splice(index,1);this.props.editor.set({activeTab:tab.id},{silent:true});this.props.editor.tabs.set(_.pluck(this.tabs,"id"),{silent:true});this.setState({display:!!this.tabs.length});if(!tab.active||!this.tabs.length){return;}
tab=this.tabs[index]||this.tabs[--index];if(tab.type==="term"){editorAction.open_term(tab.id);}else{editorAction.open(tab.id);}},componentDidMount:function(){this.tabs=[];this.editorActionOnID=editorAction.on(function(event,bufOrTerm){if(!this.props.editor.active){return;}
switch(event){case editorAction.OPEN_TERM:return this.openTab_("term",bufOrTerm.id,bufOrTerm.title);case editorAction.CLOSE_TERM:return this.closeTab_("term",bufOrTerm.id);case editorAction.OPEN:return this.openTab_("buf",bufOrTerm.id,bufOrTerm.path.split("/").pop(),bufOrTerm.path);case editorAction.CLOSE:return this.closeTab_("buf",bufOrTerm.id);default:break;}},this);this.editorActionOnRenameID=editorAction.onRENAME(function(buf){var tab;tab=_.find(this.tabs,function(tab){return tab.id===buf.id;});if(!tab){return;}
tab.path=buf.path;tab.fileName=buf.path.split("/").pop();this.setupTabs();},this);this.props.editor.tabs.forEach(function(id){var name,path,type="buf",buf=this.props.bufs.get(id);if(!buf){return;}
name=buf.path.split("/").pop();path=buf.path;this.tabs.push({path:path||name,fileName:name,active:true,id:id,type:type,bufId:type+'-'+id});},this);if(this.tabs.length){this.props.editor.tabs.set(_.pluck(this.tabs,"id"),{silent:true});this.setState({showEditor:true,showTerminal:false});}
this.setupTabs();},componentWillUnmount:function(){editorAction.off(this.editorActionOnID);editorAction.off(this.editorActionOnRenameID);},componentDidUpdate:function(){this.setupTabs();},getTabs:function(){return $(this.getDOMNode()).find(".nav-tabs").children("li");},setupTabs:function(){var el,ul,tabs="";el=$(this.getDOMNode());ul=$(".nav-tabs",el);this.tabs.forEach(function(tab){tabs+=React.renderToStaticMarkup(React.createElement(TabView,{path:tab.path,bufId:tab.bufId,fileName:tab.fileName,active:tab.active}));});ul.html(tabs);ul.sortable({axis:"x",placeholder:"editor-tab-placeholder",tolerance:"pointer",update:function(event,ui){var order,tabs;order=_.map($("li",this.getDOMNode()),function(li){return+li.getAttribute("data-buf-id");});this.tabs.sort(function(bufA,bufB){var i;for(i=0;i<order.length;i++){if(bufA.id===order[i]){return-1;}
if(bufB.id===order[i]){return 1;}}
return 0;});this.props.editor.tabs.set(_.pluck(this.tabs,"id"),{silent:true});}.bind(this),});tabs=this.getTabs();tabs.off();tabs.on("click",this.onClick_);},onClick_:function(event){var attr,type,id;event.preventDefault();this.props.editor.ace.focus();attr=$(event.currentTarget).attr("data-buf-id");attr=attr.split("-");type=attr[0];id=+attr[1];if($(event.target).hasClass("editor-tab-close")){if(type==="term"){editorAction.close_term(id);}else{editorAction.close(id);}
return;}
if(type==="term"){editorAction.open_term(id);}else if(type==="buf"){editorAction.open(id);}},render:function(){var editor=this.props.editor;var terms=editor.terminals.map(function(terminal){return(React.createElement(TerminalView,{ref:"terminal"+editor.id,terminal:terminal,key:terminal.id}));});return(React.createElement("div",{className:"editor-container",style:{display:"block"}},React.createElement("div",{className:"editor-tabs"},React.createElement("ul",{className:"nav nav-tabs",style:{left:0}})),React.createElement("div",{style:{display:this.state.showTerminal?"block":"none"},className:"flootty"},terms),React.createElement("div",{style:{display:this.state.showEditor?"block":"none"}},React.createElement(AceEditorView,{ref:"ace"+editor.id,id:editor.id,editor:editor,bufs:this.props.bufs}))));}});TerminalView=React.createClass({displayName:"TerminalView",getInitialState:function(){return{display:"block"};},componentDidMount:function(){this.getDOMNode().appendChild(this.props.terminal.div);this.onOpenTermId=editorAction.onOPEN_TERM(function(term){if(term.id===this.props.terminal.id){this.setState({display:"block"});return;}
if(this.state.display!=="none"){this.setState({display:"none"});}},this);},componentWillUnmount:function(){editorAction.off(this.onOpenTermId);},render:function(){return(React.createElement("div",{style:{display:this.state.display}}));}});AceEditorView=React.createClass({displayName:"AceEditorView",aceEdit:null,isActive:function(){return this.props.editor.active;},componentDidMount:function(){var buf,es;this.highlights={};this.aceHandlers={};this.docs=this.props.editor.docs;this.editorSessions=this.props.editor.editorSessions;this.bufs=this.props.bufs;this.refs.editor.getDOMNode().appendChild(this.props.editor.elem);this.onPermsId=perms.on(function(){this.aceEdit.setReadOnly(perms.indexOf("patch")===-1);},this);this.aceEdit=this.props.editor.ace;this.aceEdit.renderer.setShowPrintMargin(false);this.aceEdit.getSession().setMode("ace/mode/text");this.aceEdit.setReadOnly(perms.indexOf("patch")===-1);this.themeName=prefs.theme;this.aceEdit.setTheme("ace/theme/"+prefs.theme);this.props.editor.tabs.forEach(function(id){buf=this.bufs.get(id);if(!buf){return;}
if(buf.id===this.props.editor.activeTab){return;}
this.openBuffer(buf);es=this.editorSessions[buf.id];es.setMode("ace/mode/"+util.modeForFile(buf.path));},this);buf=this.bufs.get(this.props.editor.activeTab);if(buf){this.openBuffer(buf);es=this.editorSessions[buf.id];es.setMode("ace/mode/"+util.modeForFile(buf.path));}
this.editorActionOnID=editorAction.on(function(event,arg0,arg1){var args=_.toArray(arguments).slice(1);if(event===editorAction.PREF&&arg1==="theme"){this.aceEdit.setTheme("ace/theme/"+arg0.theme);if(this.isActive()){$(document.body).removeClass("theme-"+this.themeName).addClass("theme-"+arg0.theme);}
this.themeName=arg0.theme;return;}
if(event===editorAction.IMAGIFY){this.imagify.apply(this,args);return;}
if(!this.isActive()){return;}
switch(event){case editorAction.OPEN:this.openBuffer.apply(this,args);break;case editorAction.CLOSE:break;case editorAction.SUMMON:this.sendCurrentPosition();this.aceEdit.focus();break;}},this);this.configureEditor();editorAction.onTAB_SETTINGS_CHANGE(this.configureEditor.bind(this));},configureEditor:function(){console.log("configuring",this.editorSessions);if(_.isObject(this.editorSessions)){_.forEach(this.editorSessions,editorModel.configureEditSession);}},componentWillUnmount:function(){perms.off(this.onPermsId);editorAction.off(this.editorActionOnID);_.each(this.aceHandlers,function(id){var buf=this.bufs.get(id);if(!buf){return;}
this.closeBuffer(buf);},this);},sendCurrentPosition:function(){var pos,doc,activeBuf=this.props.editor.activeBuf;if(!activeBuf){return;}
doc=this.docs[activeBuf];if(!doc){return;}
pos=doc.positionToIndex(this.aceEdit.getCursorPosition());handlerAction.send_highlight(activeBuf,[[pos,pos]],false,true);},render:function(){return(React.createElement("div",{ref:"editor"},React.createElement("img",{ref:"editor_image",className:"editor-image",style:{display:"none"}})));},imagify:function(buf){var img;if(this.props.editor.activeBuf!==buf.id){return;}
img=this.refs.editor_image.getDOMNode();img.style.display="block";this.props.editor.elem.style.display="none";img.src=buf.img;},openBuffer:function(buf,line){var id,es,doc,firstPopulation,mime_type,img,editorStyle;doc=this.docs[buf.id];if(!doc){console.error("no doc");}
es=this.editorSessions[buf.id];if(!es){console.error("no es");}
this.aceEdit.setSession(es);if(_.isFinite(line)){console.log("going to line",line);this.aceEdit.gotoLine(line);}
img=this.refs.editor_image.getDOMNode();editorStyle=this.props.editor.elem.style;editorStyle.display="block";img.style.display="none";if(buf.encoding==="base64"&&buf.img){img.style.display="block";editorStyle.display="none";if(this.props.editor.activeBuf!==buf.id&&buf.populated){img.src=buf.img;}}
this.props.editor.activeBuf=buf.id;this.aceEdit.focus();}});module.exports=EditorView;},function(module,exports,__webpack_require__){"use strict";var callback,handlerAction=__webpack_require__(12),webrtcAction=__webpack_require__(38);function handleMessage(event){event=event.originalEvent;if(!event.data){return;}
switch(event.data.name){case"flooScreenShareResponse":console.log("Got content script stuff",event);callback(event.data.id);break;case"flooScreenHasExtension":console.log("Website: user has extension");webrtcAction.can_share_screen(true);break;}}
function getSharedScreenId(cb){callback=cb;setTimeout(function(){console.log("Getting screen share id");window.postMessage({text:"flooScreenShare"},"*");},1);}
function getCanShare(){setTimeout(function(){console.log("Checking to see if we have a chrome extension.");window.postMessage({text:"flooScreenDoWeHaveAnExtension"},"*");},0);}
function init(){console.log("Initing ext msg.");$(window).on("message",handleMessage);function changeListener(evt){var evt_data,origin,parse_url;parse_url=function(url){var a=document.createElement("a");a.href=url;return{hostname:a.hostname,port:a.port,protocol:a.protocol};};origin=parse_url(evt.origin);if(origin.protocol!=="https:"||!origin.hostname.match(/\.googleusercontent\.com$/)){console.log("discarding because event origin is",origin);return;}
console.log("got event",evt.data);try{evt_data=JSON.parse(evt.data);}catch(e){console.log("Couldn't parse event json:",e);return;}
if(evt_data.temp_data){fl.editor_settings.temp_data=_.extend(fl.editor_settings.temp_data,evt_data.temp_data);try{handlerAction.set_temp_data(evt_data.temp_data);}catch(e){console.log(e);}}}
if(window.parent){if(window.addEventListener){window.addEventListener("message",changeListener,false);}else if(window.attachEvent){window.attachEvent("onmessage",changeListener);}
window.parent.postMessage(JSON.stringify({owner:fl.editor_settings.room_owner,room:fl.editor_settings.room}),"*");}}
module.exports={getSharedScreenId:getSharedScreenId,getCanShare:getCanShare,init:init};},function(module,exports,__webpack_require__){"use strict";var Filetree,id=0,flux=__webpack_require__(11);Filetree=flux.createModel({modelName:"tree",fieldTypes:{id:flux.FieldTypes.number,tree:flux.FieldTypes.object,},getDefaultFields:function(){return{id:++id,};},addBuf:function(buf){var node=this.tree,paths=buf.path.split("/"),name=paths.pop();try{_.each(paths,function(p){var n=node[p];if(!n){n={};node[p]=n;}
node=n;});node[name]=buf.id;}catch(e){console.error("Path conflict for",buf.path);return;}
this.update();},removePath:function(bufPath){var i,nodes=[],name,node=this.tree,paths=bufPath.split("/");name=paths.pop();for(i=0;i<paths.length;i++){node=node[paths[i]];if(!node){console.error("Couldn't find filetree node for path",bufPath);return;}}
delete node[name];if(!paths.length){this.update();return;}
if(_.size(node)===0){this.removePath(paths.join("/"));return;}
this.update();}});Filetree.Event={OPEN:"open"};module.exports=Filetree;},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11),Handler=__webpack_require__(44),Socket=__webpack_require__(25),perms=__webpack_require__(16),Buffer=__webpack_require__(4).Buffer,User=__webpack_require__(21).User,editorAction=__webpack_require__(5),handlerAction=__webpack_require__(12),messageAction=__webpack_require__(2),webrtcAction=__webpack_require__(38),appHistory=__webpack_require__(45),prefs=__webpack_require__(17);function FlooHandler(settings,users,me,bufs,filetree,terminals){Handler.call(this,settings.api_key,settings.auth_secret,settings.username,settings.engine_io_url);this.users=users;this.me=me;this.bufs=bufs;this.filetree=filetree;this.terminals=terminals;this.saveTimeout=null;this.lastHighlight=null;editorAction.on(this.handleActions_.bind(this,"editor"));messageAction.on(this.handleActions_.bind(this,"messages"));handlerAction.on(this.handleActions_.bind(this,"handler"));}
FlooHandler.prototype=Object.create(Handler.prototype);FlooHandler.prototype.constructor=FlooHandler;_.assign(FlooHandler.prototype,{messages:null,users:null,user:null,on_room_info:function(workspace){var usersMap={},tree={};usersMap[workspace.users[workspace.user_id].username]=this.me;this.me.myConnectionID=workspace.user_id;fl.username=workspace.users[workspace.user_id].username;console.log("room info",workspace);console.log("my user id",workspace.user_id);perms.set(workspace.perms,{silent:true});setTimeout(perms.update.bind(perms),0);_.each(workspace.users,function(connection,id){usersMap[connection.username]=this.upsertUser(connection,usersMap[connection.username],workspace.user_id);},this);this.users.set(_.values(usersMap));this.filetree.tree=workspace.tree;_.each(workspace.bufs,function(buf,id){this.bufs.add(new Buffer(buf));},this);_.each(workspace.terms,function(term,termId){var user=this.users.getByConnectionID(term.owner);this.terminals.addTerminal(termId,term.term_name,term.size[0],term.size[1],user.id);},this);messageAction.success(("You have joined "+this.path_+"."));if(!appHistory.start()){editorAction.open_default_buf(this.filetree.tree);}
this.permsChanged();if(perms.indexOf("patch")===-1){prefs.following=true;messageAction.info("Following changes because you don't have edit permission.");}
handlerAction.ready(workspace);this.temp_data={};workspace.temp_data=workspace.temp_data||{};this.handle_temp_data(workspace.temp_data);this.temp_data=workspace.temp_data;},on_ack:function(){return;},on_patch:function(data){var buf=this.bufs.get(data.id);if(!buf){return;}
if(!buf.populated){console.log("buf isn't populated. fetching");Socket.send_get_buf(buf.id);return;}
if(buf.encoding==="base64"){console.log("Floobits can't handle binary patches at the moment. Re-fetching.");Socket.send_get_buf(buf.id);return;}
buf.patch(data);},on_term_stdin:function(data){var user=this.users.getByConnectionID(data.user_id);if(!user){console.error("on_term_stdin: No user with conn id.",data.user_id);return;}
if(!prefs.isFollowing(user.id)){return;}
editorAction.open_term(data.id);},on_disconnect:function(){Handler.prototype.on_disconnect.apply(this,arguments);this.users.reset([]);},upsertUser:function(connection,opt_user,opt_myUserId){var user,username,isMe=connection.user_id===opt_myUserId;username=connection.username;user=opt_user||new User();user.createConnection(connection.user_id,connection.client,connection.platform,connection.version,isMe);user.set({isMe:isMe,id:username,permissions:new flux.List(connection.perms),isAnon:connection.is_anon,gravatar:connection.gravatar,});return user;},on_join:function(connInfo){var i,foundUser,user,image,data;console.log("connInfo",connInfo);foundUser=this.users.get(connInfo.username);user=this.upsertUser(connInfo,foundUser);messageAction.log((connInfo.username+" joined using "+connInfo.client+" on "+connInfo.platform),null,true);handlerAction.connection_joined(connInfo);if(!foundUser){this.users.add(user);}
image=this.me.getMyConnection().image;if(!image||connInfo.client!=="web"){return;}
Socket.emitDataMessage({name:"user_image",image:image,},[connInfo.user_id]);},on_perms:function(data){var user,permissions;user=this.users.getByConnectionID(data.user_id);if(!user){console.log("user not found",data.user_id);return;}
permissions=user.permissions.valueOf();switch(data.action){case"add":permissions=_.uniq(permissions.concat(data.perms));break;case"remove":permissions=_.difference(permissions,data.perms);break;case"set":permissions=_.clone(data.perms);break;default:console.log("Unhandled permission type");break;}
user.permissions.set(permissions);if(user.isMe){perms.set(permissions.valueOf());this.permsChanged();}},permsChanged:function(){var args=[];if(perms.indexOf("kick")!==-1){messageAction.log("You have permission to administer this workspace.");return;}
if(perms.indexOf("patch")!==-1){messageAction.log("You have permission to edit this workspace.");return;}
if(perms.indexOf("request_perms")!==-1){args.push({name:"Request edit permission",classNames:["btn-warning"],action:function(){Socket.send_request_perms({perms:["edit_room"]});}.bind(this)});}
if(this.me.isAnon){args.push({name:"Sign in",classNames:["btn-primary"],action:fl.showLoginForm});}
messageAction.interactive("You don't have permission to edit this workspace.",args);},on_request_perms:function(data){var user,permMapping={'edit_room':'edit','admin_room':'admin'},permsEvent;user=this.users.getByConnectionID(data.user_id);if(!user){console.error("No user for conn id",data.user_id);return;}
permsEvent={user_id:data.user_id,perms:data.perms};messageAction.interactive(user.username+" is requesting "+permMapping[data.perms]+" permission.",[{name:"Allow",classNames:["btn-danger"],action:function(){permsEvent.action="add";Socket.send_perms(permsEvent);}.bind(this)},{name:"Reject",classNames:["btn-warning"],action:function(){permsEvent.action="reject";Socket.send_perms(permsEvent);}.bind(this)},{name:"Ignore",},]);},on_part:function(partData){var connId,connInfo,username,user;connId=partData.user_id;username=partData.username;user=this.users.get(username);if(!user){console.log("part: Unknown user parted.",username);return;}
connInfo=user.connections.get(connId);messageAction.log((username+" left. (Using "+connInfo.client+" on "+connInfo.platform+")"),null,true);webrtcAction.stop_video_chat(connId);user.connections.remove(connId);if(user.connections.length<1){this.users.remove(user.id);}
editorAction.remove_highlight(connId);},on_create_buf:function(data){var b=new Buffer(data);this.bufs.add(b);this.filetree.addBuf(b);editorAction.created(b);messageAction.info((data.username+" created "+data.path));},on_get_buf:function(data){var b=this.bufs.get(data.id);data.populated=true;b.set(data);clearTimeout(b.strike_timeout);},on_rename_buf:function(data){var b=this.bufs.get(data.id);if(!b){return;}
b.path=data.path;this.filetree.removePath(data.old_path);this.filetree.addBuf(b);editorAction.rename(b);},on_delete_buf:function(data){var b=this.bufs.get(data.id);if(!b){return;}
editorAction.close(b.id);this.bufs.remove(b.id);this.filetree.removePath(b.path);messageAction.info((data.username+" deleted "+data.path));},on_msg:function(msg){console.log("got message",msg);messageAction.user(msg.username,msg.data,msg.time);},on_datamsg:function(msg){var user;console.log("Data message",msg);if(msg.data.name==="user_image"){user=this.users.getByConnectionID(msg.user_id);if(!user){return;}
user.connections.get(msg.user_id).image=msg.data.image;}},handle_temp_data:function(data){if(!data.hangout||!data.hangout.url){if(this.temp_data.hangout&&this.temp_data.hangout.url){messageAction.info("This workspace is no longer being edited in a Hangout");}
return;}
messageAction.interactive("This workspace is being edited in a Google Hangout",[{name:"Open Hangout",classNames:["btn-success"],action:function(){self.location.href=data.hangout.url;}},]);},on_set_temp_data:function(data){this.handle_temp_data(data.data);_.extend(this.temp_data,data.data);},on_delete_temp_data:function(data){this.handle_temp_data(data.data);_.each(data.data,function(k){delete this.temp_data[k];},this);},kick:function(connectionIDorUsername){if(_.isNumber(connectionIDorUsername)){Socket.send_kick({"user_id":connectionIDorUsername});}else{Socket.send_kick({"username":connectionIDorUsername});}},sendMessage:function(message){Socket.send_msg({"data":message});this.on_msg({username:this.me.username,data:message,time:Date.now()/1000,});},renameBuf:function(buf,newPath){Socket.send_rename_buf({"id":buf.id,"path":newPath});},createBuf:function(data){Socket.send_create_buf({buf:data.buf||"",path:data.path,encoding:data.encoding||"utf8",});},deleteBuf:function(bufID){Socket.send_delete_buf({id:bufID});},handleActions_:function(prefix,action,data){var func,args,functionName;args=_.toArray(arguments).slice(2);functionName="onAction_"+prefix+"_"+action;func=this[functionName];console.log("handling action",functionName);if(_.isFunction(func)){func.apply(this,args);}},on_highlight:function(data){if(!data||_.size(data.ranges)===0){return;}
editorAction.highlight(data.id,data.ranges,data.user_id,data.username,data.summon);this.lastHighlight=data;}});FlooHandler.prototype["onAction_handler_"+handlerAction.UPDATE_PERMS]=function(connectionID,perms){Socket.send_perms({user_id:connectionID,perms:perms,action:"set",});};FlooHandler.prototype["onAction_handler_"+handlerAction.SEND_HIGHLIGHT]=function(bufID,ranges,following,summon){Socket.send_highlight({id:bufID,ranges:ranges,following:following,summon:summon,});};FlooHandler.prototype["onAction_handler_"+handlerAction.SAVE_BUF]=function(bufID){Socket.send_saved({id:bufID});};FlooHandler.prototype["onAction_handler_"+handlerAction.GET_BUF]=function(bufID){Socket.send_get_buf(bufID);};FlooHandler.prototype["onAction_handler_"+handlerAction.PATCH_BUF]=function(patchInfo){Socket.send_patch(patchInfo);if(this.saveTimeout){clearTimeout(this.saveTimeout);}
this.saveTimeout=setTimeout(function(){Socket.send_saved({id:patchInfo.id});this.saveTimeout=null;}.bind(this),5000);};FlooHandler.prototype["onAction_editor_"+editorAction.KICK]=function(connectionIDorUsername){this.kick(connectionIDorUsername);};FlooHandler.prototype["onAction_editor_"+editorAction.FOLLOW]=function(){if(this.lastHighlight&&prefs.isFollowing()){this.on_highlight(this.lastHighlight);}};FlooHandler.prototype["onAction_editor_"+editorAction.OPEN]=function(buf){if(!buf.populated){Socket.send_get_buf(buf.id);}};FlooHandler.prototype["onAction_editor_"+editorAction.DELETE_BUF]=function(bufID){this.deleteBuf(bufID);};FlooHandler.prototype["onAction_editor_"+editorAction.NEW_FILE]=function(path){this.createBuf({path:path});};FlooHandler.prototype["onAction_editor_"+editorAction.CREATE_BUF]=function(path,buf,encoding,switchToBuf){this.createBuf({path:path,buf:buf,encoding:encoding,});};FlooHandler.prototype["onAction_editor_"+editorAction.PULL_REPO]=function(repoType,repoURL){Socket.send_pull_repo({type:repoType,url:repoURL,});};FlooHandler.prototype["onAction_editor_"+editorAction.RENAME_REQUEST]=function(buf,newPath){this.renameBuf(buf,newPath);};FlooHandler.prototype["onAction_editor_"+editorAction.REQUEST_PERMS]=function(){if(perms.indexOf("request_perms")===-1){messageAction.log("You don't have permission to edit this workspace.");return;}
Socket.send_request_perms({perms:["edit_room"]});};FlooHandler.prototype["onAction_handler_"+handlerAction.HANGOUT]=function(){var url=fl.editor_settings.new_hangout_url;if(this.temp_data.hangout&&this.temp_data.hangout.url){url=this.temp_data.hangout.url;}
self.location.href=url;};FlooHandler.prototype["onAction_handler_"+handlerAction.SET_TEMP_DATA]=function(temp_data){Socket.send_set_temp_data({data:temp_data});};FlooHandler.prototype["onAction_handler_"+handlerAction.SEND_MESSAGE]=function(message){console.log("sending message",message);this.sendMessage(message);};FlooHandler.prototype["onAction_handler_"+handlerAction.BROADCAST_FOR_PERM]=function(name,data,perm){return this.workspaceMessageForPerm(name,data,perm);};FlooHandler.prototype["onAction_handler_"+handlerAction.EMIT_DATA_MESSAGE]=function(data,to){Socket.emitDataMessage(data,to);};FlooHandler.prototype["onAction_handler_"+handlerAction.BROADCAST_DATA_MESSAGE]=function(data){return this.workspaceDataMessage(data);};FlooHandler.prototype["onAction_handler_"+handlerAction.BROADCAST_DATA_MESSAGE_FOR_PERM]=function(data,perm){return this.workspaceMessageForPerm("datamsg",{data:data},perm);};FlooHandler.prototype.workspaceDataMessage=function(data){var ids=_.chain(this.users.data.collection).flatten("connections").filter(function(conn){return!conn.isMe;}).map(function(conn){return conn.id;}).value();return Socket.emitDataMessage(data,ids);};FlooHandler.prototype.workspaceMessageForPerm=function(name,data,perm){var f=Socket["send_"+name],ids;ids=_.chain(this.users.data.collection).flatten("connections").filter(function(conn){return!conn.isMe&&conn.client==="web"&&conn.perms.indexOf(perm)>-1;}).map(function(conn){return conn.id;}).value();data.to=ids;return f(data);};module.exports=FlooHandler;},function(module,exports,__webpack_require__){module.exports=(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports,__webpack_require__){"use strict";var fields=__webpack_require__(1).FieldTypes,collections=__webpack_require__(2),models=__webpack_require__(3);fields.model=fields.instanceOf(models.DataModel);fields.collection=fields.instanceOf(collections.DataCollection);module.exports={inherit:__webpack_require__(4).inherit,createActions:__webpack_require__(5),createAutoBinder:__webpack_require__(6),createModel:models,createCollection:collections.createCollection,List:__webpack_require__(7),settings:__webpack_require__(8),Emitter:__webpack_require__(9),FieldTypes:fields,backends:{local:__webpack_require__(10),XHRStorage:__webpack_require__(11)}};},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),list=__webpack_require__(7),chainablePrototype,OneOfField,InstanceOfField,ObjectOfField,OneOfTypeField,ArrayOfField;function PrimitiveChainable(){this.isEphemeral=false;this.defaultsTo=null;this.isRequired=false;this.newMe_=false;}
PrimitiveChainable.prototype.newify=function(ephemeral,defaults,required){var newMe;if(this.newMe_){newMe=this;}else{newMe=new this.constructor();newMe.newMe_=true;}
newMe.isEphemeral=ephemeral;newMe.defaultsTo=defaults;newMe.isRequired=required;return newMe;};PrimitiveChainable.prototype.ephemeral=function(){return this.newify(true,this.defaultsTo,this.isRequired);};PrimitiveChainable.prototype.required=function(){return this.newify(this.isEphemeral,this.defaultsTo,true);};PrimitiveChainable.prototype.defaults=function(defaults){return this.newify(this.isEphemeral,defaults,this.isRequired);};PrimitiveChainable.prototype.validate=function(){return false;};function BooleanField(){PrimitiveChainable.call(this);this.defaultsTo=false;}
utils.inherit(BooleanField,PrimitiveChainable);BooleanField.prototype.validate=function(value){return utils.isBoolean(value);};function NumberField(){PrimitiveChainable.call(this);this.defaultsTo=0;}
utils.inherit(NumberField,PrimitiveChainable);NumberField.prototype.validate=function(value){return utils.isNumber(value);};function StringField(){PrimitiveChainable.call(this);this.defaultsTo="";}
utils.inherit(StringField,PrimitiveChainable);StringField.prototype.validate=function(value){return utils.isString(value);};function FunctionField(){PrimitiveChainable.call(this);this.defaultsTo=null;}
utils.inherit(FunctionField,PrimitiveChainable);FunctionField.prototype.validate=function(value){return utils.isFunction(value);};function ObjectField(){PrimitiveChainable.call(this);this.defaultsTo={};}
utils.inherit(ObjectField,PrimitiveChainable);ObjectField.prototype.validate=function(value){return!utils.isArray(value)&&utils.isObject(value);};function ArrayField(){PrimitiveChainable.call(this);this.defaultsTo=[];}
utils.inherit(ArrayField,PrimitiveChainable);ArrayField.prototype.validate=function(value){return utils.isArray(value);};chainablePrototype={ephemeral:function(){this.isEphemeral=true;return this;},defaults:function(defaults){this.defaultsTo=defaults;return this;},required:function(){this.isRequired=true;return this;},validate:function(){return false;}};function extendChainableField(init,validate){function F(){}
F.prototype=Object.create(chainablePrototype);F.prototype.validate=validate;F.prototype.init=init;return F;}
OneOfField=extendChainableField(function OneOfField(enum_){if(!utils.isArray(enum_)){throw new Error("Enums require an array");}
this.defaultsTo=null;this.enum_=enum_;this.isEphemeral=false;this.isRequired=false;return this;},function OneOfField_validate(value){for(var i=0;i<this.enum_.length;i++){if(this.enum_[i]===value){return true;}}
return false;});InstanceOfField=extendChainableField(function InstanceOfField(klass){if(!klass||!klass.prototype||!klass.prototype.isPrototypeOf){throw new Error("I need a klass (constructor)");}
this.defaultsTo=null;this.isEphemeral=false;this.isRequired=false;this.proto_=klass.prototype;return this;},function InstanceOfField_validate(value){return this.proto_.isPrototypeOf(value);});OneOfTypeField=extendChainableField(function OneOfTypeField(ones){this.defaultsTo=null;this.isEphemeral=false;this.isRequired=false;this.ones_=ones;if(!utils.isArray(ones)){throw new Error("I need an array of fields");}
return this;},function validate(value){for(var i=0;i<this.ones_.length;i++){if(this.ones_[i].validate(value)){return true;}}
return false;});ArrayOfField=extendChainableField(function ArrayOfField(field){if(!field||!field.validate){throw new Error("I need a field");}
this.field=field;this.defaultsTo=field.defaults;this.isEphemeral=false;this.isRequired=false;return this;},function validate(value){if(!utils.isArray(value)){return false;}
for(var i=0;i<value.length;i++){if(!this.field.validate(value[i])){return false;}}
return true;});ObjectOfField=extendChainableField(function ObjectOfField(field){if(!field||!field.validate){throw new Error("I need a field");}
this.field=field;this.isEphemeral=false;this.isRequired=false;return this;},function _validate(value){var keys,key,i,validate=this.field.validate;if(!utils.isObject(value)){return false;}
keys=Object.keys(value);for(i=0;i<keys.length;i++){key=keys[i];if(!Object.hasOwnProperty.call(value,key)){continue;}
if(!validate(value[key])){return false;}}
return true;});function checkType(Model,props,propName,componentName){var prop=props[propName];if(utils.isNull(prop)){return;}
if(Model.prototype.isPrototypeOf(prop)){return new Error("Validation failed: "+propName+" "+componentName);}}
function createChainableField(f){return f.init.bind(f);}
module.exports={FieldTypes:{array:new ArrayField(),bool:new BooleanField(),func:new FunctionField(),list:list,number:new NumberField(),object:new ObjectField(),arrayOf:createChainableField(new ArrayOfField()),instanceOf:createChainableField(new InstanceOfField()),objectOf:createChainableField(new ObjectOfField()),oneOf:createChainableField(new OneOfField()),oneOfType:createChainableField(new OneOfTypeField()),string:new StringField()},checkType:checkType};},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),settings=__webpack_require__(8),data_emitter=__webpack_require__(12);function DataCollection(data){data_emitter.DataEmitter.call(this);this.eventIds={};this.data={collection:{},order:[]};Object.seal(this.data);this.set(data);}
utils.inherit(DataCollection,data_emitter.DataEmitter);DataCollection.prototype.add=function(model){if(this.add_(model)){this.update(this.model.modelName);}};DataCollection.prototype.add_=function(model,index){var data=this.data;if(utils.isUndefined(index)){index=this.length;}
if(data.collection.hasOwnProperty(model.id)){data.collection[model.id].set(model.valueOf());return data.collection[model.id];}
if(!this.validate_(model)){try{model=new this.model(model);}catch(e){if(!this.strict){return false;}
throw e;}}
data.order.splice(index,0,model.id);data.collection[model.id]=model;model.on(function(name){this.update(this.model.modelName+"."+name);},this);return model;};DataCollection.prototype.insert=function(model,index){this.add_(model,index);this.update(this.model.modelName);};DataCollection.prototype.remove=function(id){var item;item=this.remove_(id);this.update(this.model.modelName);return item;};DataCollection.prototype.sort=function(){var collection=this.data.collection,sort_=this.sort_.bind(this);this.data.order.sort(function(a,b){return sort_(collection[a],collection[b]);});};DataCollection.prototype.splice=function(index,howMany){var elements,removed,collection=this.data.collection;this.silent_=true;if(utils.isUndefined(howMany)){howMany=this.length;}
removed=this.data.order.splice(index,howMany);removed=utils.map(removed,function(id){var model=collection[id];if(!model){return;}
delete collection[id];model.off(this.eventIds[id]);delete this.eventIds[id];return model;},this);elements=utils.toArray(arguments).slice(2);utils.each(elements,function(elem){this.add_(elem,index);index++;},this);this.silent_=false;this.update(this.fieldName||this.model.modelName);return removed;};DataCollection.prototype.sort_=function(a,b){if(a.id<b.id){return-1;}
if(b.id<a.id){return 1;}
return 0;};DataCollection.prototype.remove_=function(id){var index,model,data=this.data;model=data.collection[id];if(!model){return;}
delete data.collection[id];model.off(this.eventIds[id]);delete this.eventIds[id];index=data.order.indexOf(id);if(index!==-1){data.order.splice(index,1);}
return model;};DataCollection.prototype.getRawData=function(){return this.data.collection;};DataCollection.prototype.set=function(models){var collection,newCollection={},newOrder=[];this.silent_=true;if(!utils.isArray(models)){throw new Error("You must pass set an array of raw data or instances");}
utils.each(models,function(model){model=this.add_(model);if(model===false){return;}
newCollection[model.id]=model;},this);collection=this.data.collection;this.data.order.forEach(function(id){if(id in newCollection){newOrder.push(id);return;}
collection[id].off(this.eventIds[id]);delete this.eventIds[id];},this);this.data.collection=newCollection;this.data.order=newOrder;this.silent_=false;this.update(this.fieldName||this.model.modelName);return this.length;};DataCollection.prototype.reset=function(){utils.each(Object.keys(this.data.collection),function(id){this.remove_(id);},this);};DataCollection.prototype.map=function(f,opt_thisArg){var collection=this.data.collection;return this.data.order.map(function(id,index){return f.call(opt_thisArg,collection[id],id,index);});};DataCollection.prototype.forEach=function(f,opt_thisArg){var collection=this.data.collection;this.data.order.map(function(id,index){f.call(opt_thisArg,collection[id],index);});};DataCollection.prototype.reduce=function(f,accumulator,opt_thisArg){var collection=this.data.collection;return this.data.order.reduce(function(result,item,index){return f.call(opt_thisArg,result,collection[item],index);},accumulator);};DataCollection.prototype.get=function(id){return this.data.collection[id];};DataCollection.prototype.byIndex=function(index){if(index<0){index=this.length+index;}
return this.data.collection[this.data.order[index]];};DataCollection.prototype.valueOf=function(){return this.map(function(value){return(utils.isUndefined(value)||utils.isNull(value))?value:value.valueOf();});};DataCollection.prototype.save=function(key,id){if(!this.backend){throw new Error("you must specify a backend");}
return this.backend.save(key,this,id);};DataCollection.prototype.find=function(f,opt_thisArg){var id,collection=this.data.collection;id=utils.each(this.data.order,function(id,index){return(f.call(opt_thisArg,collection[id],index)===true?false:null);});return collection[id];};Object.defineProperty(DataCollection.prototype,"length",{get:function getLength(){return this.data.order.length;}});function createCollection(options){if(!options.model){throw new Error("I need a model",options.modelName);}
function Collection(opt_list){var defaults,list;list=opt_list||[];this.model=options.model;this.validate_=this.model.prototype.isPrototypeOf.bind(this.model.prototype);this.modelName=options.modelName||"Collection";defaults=utils.isFunction(options.getDefaultFields)?options.getDefaultFields():[];DataCollection.call(this,defaults);list.forEach(function(data){this.add(this.model.prototype.isPrototypeOf(data)?data:new this.model(data));},this);if(utils.isFunction(this.init)){this.init.apply(this,arguments);}}
utils.inherit(Collection,DataCollection);Collection.prototype.model=options.model;Collection.load=function(key,id,cb){if(!options.backend){throw new Error("you must specify a backend");}
if(!utils.isFinite(id)){id=key;key="";}
return options.backend.load(key,Collection,id,cb);};utils.each(options,function(property,name){if(utils.contains(['model','modelName'],name)){return;}
if(name==="sort"){if(!utils.isFunction(property)){throw new Error("The sort property must be a function");}
Collection.prototype.sort_=property;return;}
if(utils.has(Collection.prototype,name)){throw new Error("Collection "+options.modelName+" already has property "+name);}
Collection.prototype[name]=property;});return Collection;}
module.exports={DataCollection:DataCollection,createCollection:createCollection};},function(module,exports,__webpack_require__){"use strict";var fieldRegex=/(\w+)/,utils=__webpack_require__(4),data_emitter=__webpack_require__(12),fields=__webpack_require__(1).FieldTypes,isDataEmitter=data_emitter.isDataEmitter;function DataModel(opt_data){data_emitter.DataEmitter.call(this);this.data={};this.eventIds={};}
utils.inherit(DataModel,data_emitter.DataEmitter);DataModel.prototype.save=function(key,cb){if(!this.backend){throw new Error("you must specify a backend");}
return this.backend.save(key,this,this.id,cb);};DataModel.prototype.set=function(d,options){var changed=[];this.silent_=true;utils.each(d,function(dataValue,propertyName){if(!utils.has(this.schema,propertyName)){return;}
this[propertyName]=dataValue;changed.push(propertyName);},this);this.silent_=false;if(options&&options.silent){return;}
this.update(changed);};DataModel.prototype.valueOf=function(){var v={};utils.each(this.nonEphemeralFields,function(field){var value=this.data[field];if(utils.isUndefined(value)||utils.isNull(value)){return value;}
v[field]=value.valueOf();},this);return v;};DataModel.prototype.bindToField=function(field,fieldName){this.eventIds[fieldName]=field.on(function(name){this.update(fieldName);},this);};module.exports=DataModel;function createModel(options){var id_=0,fieldTypes,modelName,nonEphemeralFields;if(!utils.isObject(options)){throw new Error("options with prototypes are required to make a DataModel");}
fieldTypes=options.fieldTypes||{};modelName=options.modelName||"Model";function Model(opt_data){var defaults,data;DataModel.call(this);data=opt_data||{};this.modelName=modelName;this.backend=options.backend;if(options.getDefaultFields&&utils.isFunction(options.getDefaultFields)){defaults=options.getDefaultFields();}else{defaults={};}
defaults.id=defaults.id||id_++;this.silent_=true;utils.each(this.schema,function(Field,fieldName){var defaultValue=utils.has(data,fieldName)?data[fieldName]:defaults[fieldName];if(isDataEmitter(Field.prototype)){if(!defaultValue){this[fieldName]=new Field();return;}
if(!defaultValue.isPrototypeOf(Field)){this[fieldName]=new Field(defaultValue);return;}
this[fieldName]=defaultValue;return;}
if(utils.has(data,fieldName)||utils.has(defaults,fieldName)){this[fieldName]=defaultValue;return;}
if(Field.isRequired){throw new Error("The field "+fieldName+" is required according to you!");}
this[fieldName]=Field.defaultsTo;},this);this.silent_=false;Object.seal(this.data);if(utils.isFunction(this.init)){this.init.apply(this,arguments);}}
utils.inherit(Model,DataModel);if(!utils.has(fieldTypes,"id")){fieldTypes.id=fields.number;}
Object.seal(fieldTypes);Model.prototype.schema=fieldTypes;Model.modelName=modelName;Model.load=function(key,id){if(!options.backend){throw new Error("you must specify a backend");}
if(!utils.isFinite(id)){id=key;key="";}
return options.backend.load(key,Model,id);};nonEphemeralFields=[];utils.each(fieldTypes,function(fieldType,fieldName){if(!fieldType){throw new Error("The field '"+fieldName+"' is invalid for '"+modelName+"'.");}
if(!fieldType.isEphemeral){nonEphemeralFields.push(fieldName);}
Object.defineProperty(Model.prototype,fieldName,{get:function(){return this.data[fieldName];},set:function(v){var err,current=this.data[fieldName],isEmitter=isDataEmitter(v),wasEmitter=isDataEmitter(current);this.validate(v,fieldName);if(!wasEmitter&&!isEmitter){this.data[fieldName]=v;return this.update(fieldName);}
if(wasEmitter&&isEmitter){this.data[fieldName]=v;current.off(this.eventIds[fieldName]);this.bindToField(v,fieldName);return this.update(fieldName);}
if(wasEmitter&&!isEmitter){current.set(v);return this.update(fieldName);}
this.data[fieldName]=v;this.bindToField(v,fieldName);this.update(fieldName);},});});Object.freeze(nonEphemeralFields);Model.prototype.nonEphemeralFields=nonEphemeralFields;utils.each(options,function(property,name){if(utils.contains(['fieldTypes','getDefaultFields','modelName'],name)){return;}
if(utils.has(Model.prototype,name)){throw new Error("Model "+options.modelName+" already has property "+name);}
Model.prototype[name]=property;});return Model;}
createModel.DataModel=DataModel;module.exports=createModel;},function(module,exports,__webpack_require__){(function(global){"use strict";var _isFinite,MAX_SAFE_INTEGER=Math.pow(2,53)-1;if(typeof global!=="undefined"){_isFinite=global.isFinite;}else if(typeof window!=="undefined"){_isFinite=window.isFinite;}else if(typeof self!=="undefined"){_isFinite=self.isFinite;}else{}
function assign_(object,source){var index=-1,key,props=Object.keys(source),length=props.length;while(++index<length){key=props[index];object[key]=source[key];}
return object;}
function contains(collection,target){var length=collection?collection.length:0,index=-1;if(isFunction(collection.indexOf)){return collection.indexOf(target)>=0;}
if(!(hasLength(length))){collection=values(collection);length=collection.length;}
while(++index<length){if(collection[index]===target){return true;}}
return false;}
function map(collection,iter,self){var data={};if(collection.map){return collection.map(iter,self);}
each(collection,function(item,key){data[key]=iter.call(self,item,key);});return data;}
function each(collection,iter,self){var index=-1,keys_,length=collection?collection.length:0;if(!(hasLength(length))){keys_=keys(collection);length=keys_.length;while(++index<length){var key=keys_[index];if(iter.call(self,collection[key],key,collection)===false){return collection[key];}}}
while(++index<length){if(iter.call(self,collection[index],index,collection)===false){return collection[index];}}}
function extend(){var length=arguments.length,object=arguments[0],i=0;while(++i<length){assign_(object,arguments[i]);}
return object;}
function has(object,key){return object?Object.hasOwnProperty.call(object,key):false;}
function hasLength(length){return(typeof length=='number'&&length>-1&&length<=MAX_SAFE_INTEGER);}
function inherit(c,sc){c.prototype=Object.create(sc.prototype,{});c.prototype.super_=sc;c.super_=sc;c.prototype.constructor=c;}
function isArray(a){return Array.isArray(a);}
function isBoolean(a){return typeof(a)==="boolean";}
function isFinite(a){return typeof(a)==="number"&&_isFinite(a);}
function isFunction(a){return typeof(a)==="function";}
function isNull(a){return a===null;}
function isNumber(a){return typeof(a)==="number";}
function isString(a){return typeof(a)==="string";}
function isObject(a){var type=typeof a;return type==='function'||(a&&type==='object')||false;}
function isUndefined(a){return typeof(a)==="undefined";}
function keys(a){try{return Object.keys(a);}catch(unused){}
return[];}
function size(a){if(a&&isFinite(a.length)&&a.length>=0){return a.length;}
return Object.keys(a).length;}
function toArray(a){var length=a?a.length:0;if(hasLength(length)&&isFunction(a.slice)){return a.slice();}
return values(a);}
function values(a){var i=-1,keys_=keys(a),length=keys_.length,v=[];while(++i<length){v.push(a[keys_[i]]);}
return v;}
module.exports={contains:contains,each:each,extend:extend,has:has,inherit:inherit,isArray:isArray,isBoolean:isBoolean,isFinite:isFinite,isFunction:isFunction,isNull:isNull,isNumber:isNumber,isString:isString,isObject:isObject,isUndefined:isUndefined,map:map,keys:keys,size:size,toArray:toArray,values:values,};}.call(exports,(function(){return this;}())))},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),Emitter=__webpack_require__(9);function createActions(actions){var properties={};function Action_(){Action_.super_.call(this);utils.each(actions,function(theAction,actionName){var eventName=actionName.toUpperCase();if(!utils.isFunction(theAction)){this[actionName]=theAction;return;}
this.fields_.push(eventName);theAction.name_=eventName;this["on"+eventName]=this.on.bind(this,eventName);if(actionName.indexOf("async")!==0){this[actionName]=function action_action(){var ret=theAction.apply(this,arguments);if(ret instanceof Error){return ret;}
this.emit.apply(this,[eventName].concat(ret));return null;}.bind(this);return;}
this[actionName]=function action_action(){var args=utils.toArray(arguments),cb=args.pop(),ret,that=this;if(!utils.isFunction(cb)){that=cb;cb=args.pop();}
if(!utils.isFunction(cb)){throw new Error("I take a callback or callback, this as final arguments");}
ret=theAction.apply(this,arguments);if(ret instanceof Error){return ret;}
this.emitAsync.call(this,cb.bind(that,ret),eventName,ret);return null;}.bind(this);return;},this);if(utils.isFunction(this.init)){this.init.apply(this,arguments);}}
utils.inherit(Action_,Emitter);properties={on:{value:function(event,listener,opt_thisArg){if(utils.isString(event)&&!utils.contains(this.fields_,event)){throw new Error("event "+event+" is not a valid event ");}
return Emitter.prototype.on.apply(this,arguments);}},};utils.each(actions,function(theAction,actionName){var eventName;if(theAction==="init"){return;}
eventName=actionName.toUpperCase();properties[eventName]={get:function eventGetter(){return eventName;},enumerable:true};});Object.defineProperties(Action_.prototype,properties);Action_.prototype.fields_=[];return Action_;}
module.exports=createActions;},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),isDataEmitter=__webpack_require__(12).isDataEmitter,settings=__webpack_require__(8);function getModels(propPaths,props,componentName){return propPaths.map(function(propPath){var i,model,paths;model=props;paths=propPath.split(".");for(i=0;i<paths.length;i++){model=model[paths[i]];if(!model)break;}
if(!model&&settings.debug){throw new Error("No model found for "+propPath+" "+componentName);}
return model;});}
function createAutoBinder(propPaths,models){var mixin,boundIds_={};if(utils.isUndefined(propPaths)&&utils.isUndefined(models)){throw new Error("I require propPaths or models");}
if(!utils.isArray(models)){models=[];}
mixin={componentDidMount:function(){var update=function(name,modelName){var owner=this._owner,componentName="unknown";if(!this.isMounted()){return;}
while(owner){componentName=owner.componentName;if(componentName){break;}
owner=owner._owner;}
console.log("force updating "+name+" of "+componentName+" because of "+modelName);this.forceUpdate();};getModels(propPaths,this.props,this.componentName).concat(models).forEach(function(model){if(isDataEmitter(model)){boundIds_[model.on(update.bind(this,this.componentName,model.modelName))]=model;}},this);},componentWillUnmount:function(){utils.each(boundIds_,function(model,id){model.off(id);});}};return mixin;}
module.exports=createAutoBinder;},function(module,exports,__webpack_require__){var utils=__webpack_require__(4),data_emitter=__webpack_require__(12),ARRAY_MUTATORS=["fill","pop","push","reverse","shift","sort","splice","unshift"];function List(name,opt_data){data_emitter.DataEmitter.apply(this,arguments);this.modelName=name;this.collection=[];if(!opt_data){opt_data=name;name="List";}
utils.each(opt_data||[],function(item){this.collection.push(item);},this);}
utils.inherit(List,data_emitter.DataEmitter);utils.each(Object.getOwnPropertyNames(Array.prototype),function(name){var f=Array.prototype[name];if(!utils.isFunction(f)){return;}
if(!utils.contains(ARRAY_MUTATORS,name)){List.prototype[name]=function(){return f.apply(this.collection,arguments);};return;}
List.prototype[name]=function(){var ret=f.apply(this.collection,arguments);this.update();return ret;};});Object.defineProperty(List.prototype,"length",{get:function length(){return this.collection.length;}});List.prototype.update=function(){this.super_.prototype.update.call(this);};List.prototype.get=function(index){return this.collection[index];};List.prototype.set=function(values,options){this.collection=values;if(!options||options.silent!==true){this.update();}};List.prototype.toggle=function(value){if(this.collection.indexOf(value)===-1){this.collection.push(value);return true;}
this.collection=this.collection.filter(function(currentValue){return currentValue!=value;});return false;};List.prototype.valueOf=function(){return utils.map(this.collection,function(value){return(utils.isUndefined(value)||utils.isNull(value))?value:value.valueOf();});};module.exports=List;},function(module,exports,__webpack_require__){"use strict";var settings={debug:false,namespace:"",};Object.seal(settings);module.exports=settings;},function(module,exports,__webpack_require__){var utils=__webpack_require__(4);function Emitter(){this.count=0;this.on_={};this.all_={};}
Emitter.prototype.on=function(opt_event,listener,opt_thisArg){if(utils.isFunction(opt_event)){this.all_[++this.count]=listener?opt_event.bind(listener):opt_event;return this.count;}
if(!utils.has(this.on_,opt_event)){this.on_[opt_event]={};}
this.on_[opt_event][++this.count]=opt_thisArg?listener.bind(opt_thisArg):listener;return this.count;};Emitter.prototype.emit=function(event){var args;args=utils.toArray(arguments);utils.each(this.all_,function(l){l.apply(null,args);},this);args.shift();utils.each((this.on_[event]||{}),function(l,k){l.apply(null,args);},this);};Emitter.prototype.emitAsync=function(cb,event,args){var events=this.on_[event]||{},async=utils.size(events)+utils.size(this.all_);args=[args].concat(function popAsync(){if(async===0){throw new Error("cb fired more than once");}
async-=1;if(async===0){return cb&&cb();}});utils.each(this.all_,function(l){l.apply(null,args);},this);utils.each(events,function(l,k){l.apply(null,args);},this);};Emitter.prototype.off=function(opt_event_or_id){if(utils.isNumber(opt_event_or_id)){delete this.all_[opt_event_or_id];utils.each(this.on_,function(events,event){delete events[opt_event_or_id];});return;}
if(utils.isString(opt_event_or_id)){delete this.on_[opt_event_or_id];return;}
if(utils.isUndefined(opt_event_or_id)){this.all_={};this.on_={};return;}
throw new Error("WTF is "+opt_event_or_id+" ?");};module.exports=Emitter;},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),settings=__webpack_require__(8),localStorage;try{localStorage=window.localStorage;}catch(e){localStorage={};}
function LocalStorage(){}
LocalStorage.prototype.supported=function(){try{return'localStorage'in window&&window.localStorage!==null;}catch(e){return false;}};LocalStorage.prototype.getKey=function(namespace,model,id){return"floobits::"+(namespace||settings.namespace)+"::"+model.modelName+"::"+(id||model.id);};LocalStorage.prototype.save=function(namespace,model,id,cb){var key=this.getKey(namespace,model,id);try{localStorage[key]=JSON.stringify(model.valueOf());}catch(e){if(utils.isFunction(cb)){cb(e);return e;}}};LocalStorage.prototype.load=function(namespace,model,id,cb){var cereal,data,key=this.getKey(namespace,model,id);if(!utils.isFunction(cb)){cb=function(){};}
cereal=localStorage[key];if(!cereal){return cb(new Error("No data to load"));}
try{data=JSON.parse(cereal);}catch(e){console.warn(e);cb(e);return e;}
if(!utils.isFinite(model.id)&&!(model.id&&model.id.length)){model=new model(data);cb(null,model);return model;}
model.set(data);cb(null,model);return model;};module.exports=new LocalStorage();},function(module,exports,__webpack_require__){var utils=__webpack_require__(4),settings=__webpack_require__(8);function XHRStorage(getUrl){this.getUrl=getUrl;}
XHRStorage.prototype.supported=function(){return(typeof $!=="undefined")&&$.ajax;};XHRStorage.prototype.getUrl=function(namespace,model,id){var getUrl=model.getUrl||(model.prototype&&model.prototype.getUrl),getPath=model.getPath||(model.prototype&&model.prototype.getPath);if(utils.isFunction(getUrl)){return getUrl.call(model,id,namespace);}
if(namespace||settings.namespace){return(namespace||settings.namespace)+getPath.call(model,id,namespace);}
return window.location.protocol+"//"+window.location.host+getPath.call(model,id,namespace);};XHRStorage.prototype.save=function(namespace,model,id,cb){var data;try{data=JSON.stringify(model.valueOf());}catch(e){if(typeof cb!=="function"){cb(e);return e;}}
return $.ajax({data:data,url:this.getUrl(namespace,model),method:"post",complete:function(xhr,status){if(status==="error"){return cb(xhr);}else{return cb(null,xhr);}}});};XHRStorage.prototype.parse=function(model,data,id){model.set(data);};XHRStorage.prototype.load=function(namespace,model,id,cb){var isInstance=utils.isFinite(model.id)||(model.id&&model.id.length);if(typeof cb!=="function"){cb=function(){};}
return $.ajax({url:this.getUrl(namespace,model,id),method:"get",error:cb,success:(function(data){if(model.parse){return cb(null,model.parse(model,data,id));}
this.parse(model,data,id);return;}.bind(this)),});};module.exports=XHRStorage;},function(module,exports,__webpack_require__){var Emitter=__webpack_require__(9),utils=__webpack_require__(4),settings=__webpack_require__(8);function DataEmitter(){this.recursing_=false;this.silent_=false;Emitter.call(this);this.fieldName=null;}
utils.inherit(DataEmitter,Emitter);DataEmitter.prototype.validate=function(field){var err;if(settings.debug){err=this.schema[field](this.data,field,this.modelName);if(err)throw err;}};DataEmitter.prototype.load=function(key,cb){if(!this.backend){throw new Error("you must specify a backend");}
return this.backend.load(key,this,this.id,cb);};DataEmitter.prototype.update=function(fields){if(this.silent_||this.recursing_){return;}
this.recursing_=true;if(this.didUpdate(fields)===false){return;}
this.recursing_=false;this.emit.apply(this,arguments);};DataEmitter.prototype.didUpdate=function(){return true;};function isDataEmitter(value){return DataEmitter.prototype.isPrototypeOf(value);}
module.exports={DataEmitter:DataEmitter,isDataEmitter:isDataEmitter,};}])},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11),Actions=flux.createActions({get_buf:function(bufferID){return bufferID;},patch_buf:function(patchInfo){return patchInfo;},save_buf:function(bufferID){return bufferID;},send_highlight:function(bufferID,ranges,following,summon){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with bufferID "+bufferID);}
if(!buf.populated){return new Error("Buffer is not yet populated "+bufferID);}
if(_.isEqual([bufferID,ranges,following,summon],this.prevHighlight)){return new Error("Not sending duplicate highlight: "+this.prevHighlight);}
this.prevHighlight=[bufferID,ranges,following,summon];return[bufferID,ranges,following,summon];},send_message:function(message){if(message){return message;}
return new Error("Empty message.");},update_perms:function(connectionID,perms){return[connectionID,perms];},broadcast_for_perm:function(name,data,permission){return[name,data,permission];},emit_data_message:function(data,to){return[data,to];},broadcast_data_message:function(data){return data;},broadcast_data_message_for_perm:function(data,permission){return[data,permission];},edit_permissions:function(){console.log("edit_permissions");return;},connection_joined:function(connection){return connection;},ready:function(roomInfo){return roomInfo;},hangout:function(){return;},set_temp_data:function(temp_data){return temp_data;},});Actions.prototype.setBuffers=function(buffers){this.buffers=buffers;};module.exports=new Actions();},function(module,exports,__webpack_require__){"use strict";var MessagesView,InteractiveMessageView,UserMessageView,LogMessageView,flux=__webpack_require__(11),util=__webpack_require__(43),handlerAction=__webpack_require__(12);LogMessageView=React.createClass({displayName:"LogMessageView",render:function(){var message=this.props.message;return(React.createElement("div",{className:"message alert alert-"+message.levelName,role:"alert"},React.createElement("div",{className:"message-content"},React.createElement("div",{className:"message-timestamp"},message.prettyTime),React.createElement("div",{className:"message-text"},message.msg))));}});UserMessageView=React.createClass({displayName:"UserMessageView",render:function(){var message=this.props.message,urlRegexp=/https?:\/\/\S+/g,userColor=util.userColor(message.username),result,msgTxt=[],before,after,key=0,prevIndex=0,imgOrTxt;while(true){result=urlRegexp.exec(message.msg);if(!result){msgTxt.push(message.msg.slice(prevIndex));break;}
before=message.msg.slice(prevIndex,result.index);prevIndex=result.index+result[0].length;after=message.msg.slice(prevIndex,urlRegexp.lastIndex);if(util.image_mime_from_extension(result[0])){imgOrTxt=(React.createElement("img",{src:result[0]}));}else{imgOrTxt=result[0];}
msgTxt.push(React.createElement("span",{key:key++},before,React.createElement("a",{target:"_blank",href:result[0]},imgOrTxt),after));}
return(React.createElement("div",{className:"message"},React.createElement("div",{className:"message-content"},React.createElement("div",{style:{},className:"message-timestamp"},message.prettyTime),React.createElement("div",{style:{},className:"message-text"},React.createElement("span",{className:"message-username"},React.createElement("span",{className:"user-color-square",style:{backgroundColor:userColor}}),message.username||message.type,":"),msgTxt))));}});InteractiveMessageView=React.createClass({displayName:"InteractiveMessageView",getInitialState:function(){return{clicked:null};},onClick:function(button){if(this.state.clicked!==null){return;}
button.action();this.setState({clicked:button.id});},render:function(){var message=this.props.message,buttons=message.buttons||[];buttons=buttons.map(function(b){var classes="btn ",clicked=this.state.clicked;if(clicked===null||clicked===b.id){classes+=b.classNames.join(" ");}
if(clicked===b.id){classes+=" dim";}
return(React.createElement("button",{key:b.id,className:classes,onClick:this.onClick.bind(this,b)},b.name));},this);return(React.createElement("div",{className:"message"},React.createElement("div",{className:"message-content"},React.createElement("div",{className:"message-timestamp"},message.prettyTime),React.createElement("div",{className:"message-text"},message.msg,buttons.length&&React.createElement("div",{className:"buttons"},buttons)))));}});MessagesView=React.createClass({displayName:"MessagesView",mixins:[flux.createAutoBinder(["messages"])],handleMessage_:function(event){var input,ret;event.preventDefault();input=this.refs.newMessage.getDOMNode();ret=handlerAction.send_message(input.value);if(ret){console.error(ret);}
input.value="";},componentDidMount:function(){if(this.props.focus){this.refs.newMessage.getDOMNode().focus();}},render:function(){var nodes,chatInput;nodes=this.props.messages.map(function(message){switch(message.type){case"user":return new React.createElement(UserMessageView,{message:message,key:message.id});case"log":return new React.createElement(LogMessageView,{message:message,key:message.id});case"interactive":return new React.createElement(InteractiveMessageView,{message:message,key:message.id});}},this);chatInput=(React.createElement("div",{className:"chat-input-container"},React.createElement("form",{onSubmit:this.handleMessage_},React.createElement("input",{type:"text",ref:"newMessage",defaultValue:"",className:"chat-input",placeholder:"type here to chat"}))));return(React.createElement("div",{className:"messages-container"},chatInput,React.createElement("div",{className:"messages-list"},nodes)));}});module.exports=MessagesView;},,function(module,exports,__webpack_require__){"use strict";var handlerActions=__webpack_require__(12),messageAction=__webpack_require__(2),perms=__webpack_require__(16),THUMB_WIDTH=228,THUMB_HEIGHT=228;function MugShot(node){this.snapshotInterval=null;this.drawTimeouts={};this.stream=null;}
MugShot.prototype.start=function(myConn){if(perms.indexOf("patch")===-1){messageAction.info("Mugshots require edit permission.");return;}
this.stop();this.myConn=myConn;this.snapshotInterval=setInterval(_.bind(this.snapshot,this),60000);this.snapshot();};MugShot.prototype.stop=function(){clearInterval(this.snapshotInterval);this.snapshotInterval=null;this.clearDrawTimeouts();this.stopStream();if(this.myConn){this.myConn.image=null;}};MugShot.prototype.snapshot=function(){console.log("Creating snapshot.");getUserMedia({audio:false,video:{optional:[{maxWidth:THUMB_WIDTH},{maxHeight:THUMB_HEIGHT},]},},_.bind(this.gotUserMedia,this));};MugShot.prototype.clearDrawTimeouts=function(){_.each(this.drawTimeouts,function(timeout){clearTimeout(timeout);});this.drawTimeouts={};};MugShot.prototype.stopStream=function(){if(this.stream){try{this.stream.stop();}catch(e){console.error("Error stopping stream in stopStream:",e);}
this.stream=null;}
this.clearDrawTimeouts();};MugShot.prototype.gotUserMedia=function(err,stream){if(err){console.error("Error getting snapshot!",err);return;}
if(this.stream){console.error("Mug shot stream already exists! Killing old stream");try{this.stream.stop();}catch(e){console.error("Error stopping stream in gotUserMedia:",e);}}
this.stream=stream;this.getSnapshotFromStream(stream,function(err,data){handlerActions.broadcast_data_message_for_perm({name:"user_image",image:data,},"patch");this.myConn.image=data;this.stopStream();}.bind(this));};MugShot.prototype.getSnapshotFromStream=function(stream,cb){var self=this,canvas,canvasContext,i,video;video=document.createElement("video");video.setAttribute("width",THUMB_WIDTH);video.setAttribute("height",THUMB_HEIGHT);canvas=document.createElement("canvas");canvas.setAttribute("width",THUMB_WIDTH);canvas.setAttribute("height",THUMB_HEIGHT);canvasContext=canvas.getContext("2d");video.src=(window.URL&&window.URL.createObjectURL(stream))||stream;video.play();function done(err,result){try{video.pause();video.src="";video=null;}catch(e){console.error("Mugshot draw: Error pausing video:",e);}
try{delete self.drawTimeouts[stream];}catch(unused){}
return cb(err,result);}
i=45;function draw(){var data;i--;try{canvasContext.clearRect(0,0,canvas.width,canvas.height);canvasContext.drawImage(video,0,0,video.width,video.height);if(fl.editor_settings.logLevel>0){canvasContext.fillText(Date().toString(),1,10);canvasContext.fillText("i:"+i,1,25);}}catch(e){console.log("Capture self shot failed.",e);}
data=self.handleFrame_(canvas,canvasContext,false);if(data){console.log("handled snapshot");return done(null,data);}
if(i<=0){console.log("snapshot still not ready. forcing");data=self.handleFrame_(canvas,canvasContext,true);return done(null,data);}
self.drawTimeouts[stream]=setTimeout(draw,34);}
_.defer(draw.bind(this));};MugShot.prototype.cancelSnapshot=function(){handlerActions.broadcast_data_message_for_perm({name:"user_image",image:null},"patch");};MugShot.prototype.handleFrame_=function(canvas,canvasContext,force){var data,i,r,g,b,imageData=canvasContext.getImageData(0,0,canvas.width,canvas.height),goodPixels=0;data=new Array(imageData.data.length/4);for(i=0;i<data.length;i++){r=imageData.data[i*4];g=imageData.data[i*4+1];b=imageData.data[i*4+2];data[i]=Math.round(0.21*r+0.72*g+0.07*b);imageData.data[i*4]=data[i];imageData.data[i*4+1]=data[i];imageData.data[i*4+2]=data[i];if(data[i]>20&&data[i]<240){goodPixels++;}}
if(goodPixels<(imageData.data.length*0.10)&&!force){return null;}
canvasContext.putImageData(imageData,0,0);data={width:canvas.width,height:canvas.height,data:canvas.toDataURL(),};return data;};module.exports=new MugShot();},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11);module.exports=new flux.List("Permission");},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11),util=__webpack_require__(43),fieldTypes=flux.FieldTypes,prefs;var UserPref=flux.createModel({backend:flux.backends.local,followPaused:false,modelName:"UserPref",fieldTypes:{id:fieldTypes.string.defaults("UserPref"),theme:fieldTypes.string,sound:fieldTypes.bool.defaults(true),path:fieldTypes.string,following:fieldTypes.bool,followUsers:fieldTypes.list,logLevel:fieldTypes.number,showNotifications:fieldTypes.bool,showImages:fieldTypes.bool.defaults(true),dnd:fieldTypes.bool,mugshots:fieldTypes.bool,audioOnly:fieldTypes.bool,canNotify:fieldTypes.bool.ephemeral(),},getDefaultFields:function(){var editorSettings=fl.editor_settings;return{theme:editorSettings.theme,sound:!!editorSettings.sound,following:!!editorSettings.follow_mode,logLevel:editorSettings.logLevel,};},isFollowing:function(username){if(this.followPaused){return false;}
if(_.isUndefined(username)){if(this.followUsers.length>0){return true;}
return this.following;}
if(this.followUsers.indexOf(username)!==-1){return true;}
return this.following;},pauseFollowMode:function(duration){var self=this;function resetFollowMode(){self.followPaused=false;delete self.pauseFollowTimeout;}
if(!this.following&&!this.followUsers.length){return;}
clearTimeout(this.pauseFollowTimeout);this.followPaused=true;this.pauseFollowTimeout=setTimeout(resetFollowMode,duration);},didUpdate:function(field){if(field!=="showNotifications"){return;}
this.requestNotificationPermission();},onNotificationPermission_:function(permission){var canNotify=permission==="granted";if(canNotify===this.canNotify){return;}
this.set({canNotify:canNotify},{silent:true});this.save();},requestNotificationPermission:function(){if(!self.Notification||!_.isFunction(Notification.requestPermission)||!this.showNotifications){return;}
Notification.requestPermission(this.onNotificationPermission_.bind(this));},});prefs=new UserPref(fl.editor_settings);prefs.load(fl.editor_settings.prefs_path);prefs.requestNotificationPermission();module.exports=prefs;},function(module,exports,__webpack_require__){"use strict";var Terminals,TerminalModel,Socket=__webpack_require__(25),editorAction=__webpack_require__(5),flux=__webpack_require__(11);TerminalModel=flux.createModel({modelName:"Terminal",fieldTypes:{id:flux.FieldTypes.number,term:flux.FieldTypes.object.ephemeral(),username:flux.FieldTypes.string,div:flux.FieldTypes.object.ephemeral(),title:flux.FieldTypes.string,}});Terminals=flux.createCollection({model:TerminalModel,modelName:"Terminals",users:null,getTerm_:function(id){var term=this.get(id);return term&&term.term;},init:function(args,args2){this.users=args2.users;Socket.onCREATE_TERM(function(term){var user=this.users.getByConnectionID(term.owner);this.addTerminal(term.id,term.term_name,term.size[0],term.size[1],user.id);},this);Socket.onDELETE_TERM(function(data){var term=this.getTerm_(data.id);if(!term){return;}
editorAction.close_term(term.id);term.destroy();this.remove(+data.id);},this);Socket.onTERM_STDOUT(function(data){var term=this.getTerm_(data.id);if(!term||!term.children){return;}
try{term.write(StringView.makeFromBase64(data.data,"UTF-8").toString());}catch(e){console.warn(e);}},this);Socket.onUPDATE_TERM(function(data){var term=this.getTerm_(data.id);console.log("update term",data);if(term&&data.size){term.resize(data.size[0],data.size[1]);}},this);Socket.onSYNC(function(terms){console.log('Attempting to sync...');_.each(terms,function(data,id){var term=this.getTerm_(id);if(!term){return;}
term.resize(data.cols,data.rows);},this);},this);},addTerminal:function(id,title,cols,rows,username){var div,term;id=parseInt(id,10);term=new Terminal({cols:cols,rows:rows,title:title,handler:this.onData.bind(this,id)});div=document.createElement("div");term.open(div);term.id=id;term.title=title;this.add({id:id,term:term,username:username,div:div,title:title});},onData:function(id,data){Socket.send_term_stdin({id:id,data:new StringView(data).toBase64()});}});module.exports={Terminals:Terminals};},function(module,exports,__webpack_require__){"use strict";var theme;theme={monokai:"Monokai",lowlight_customized:"Lowlight Customized",clouds:"Clouds",};module.exports={theme:theme,};},function(module,exports,__webpack_require__){"use strict";var Connection,UserView,UserlistView,ChatUserlistView,IsMeUserView,NotMeUserView,GravatarThumbnailView,ImageThumbnailView,VideoThumbnailView,ListViewMixin,flux=__webpack_require__(11),modal=__webpack_require__(42),PermissionView=__webpack_require__(46),perms=__webpack_require__(16),editorAction=__webpack_require__(5),webrtcAction=__webpack_require__(38),mixins=__webpack_require__(47),util=__webpack_require__(43);Connection=React.createClass({displayName:"Connection",componentName:"Connection",getInitialState:function(){return{showPopover:false,};},kick_:function(){editorAction.kick(this.props.connection.id);},render:function(){var connection=this.props.connection;return(React.createElement("div",{className:"user-conn"},React.createElement("span",{className:"user-client-name"},connection.isMe?"me":connection.client),React.createElement("span",{className:"pull-right"},connection.path),this.props.isAdmin&&React.createElement("span",{className:"btn-group pull-right",onClick:this.kick_},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-eject"})," Kick"))));}});IsMeUserView=React.createClass({displayName:"IsMeUserView",getInitialState:function(){return{sharing:false};},shareScreen:function(event){var err;event.preventDefault();event.stopPropagation();if(this.state.sharing){webrtcAction.stop_screen(this.props.connection.id);this.setState({sharing:false});return;}
err=webrtcAction.start_screen();if(err instanceof Error){return;}
this.setState({sharing:true});},render:function(){return(React.createElement("div",null,React.createElement("div",{style:{display:"inline-block"}},React.createElement("a",{href:"https://chrome.google.com/webstore/detail/floobits-screen-sharing/lmojaknpofhmdnbpanagbbeinbjmbodo"}),React.createElement("a",{href:"#",onClick:this.shareScreen},React.createElement("i",{className:"glyphicon glyphicon-facetime-video"})," ",this.state.sharing?"Stop Screen Sharing":"Share Screen")),React.createElement("div",{style:{display:"inline-block",paddingTop:8}},React.createElement("a",{href:"/help/webrtc#screenshare",target:"_blank",title:"Screen Share Help"},React.createElement("i",{className:"glyphicon glyphicon-question-sign"})))));}});NotMeUserView=React.createClass({displayName:"NotMeUserView",kick_:function(){this.props.user.connections.forEach(function(conn){console.log("kicking",conn);editorAction.kick(conn.id);});},editPerms_:function(){modal.showModal(PermissionView,{user:this.props.user,me:this.props.me,title:"Edit Permissions for "+this.props.user.id});},followUser_:function(){editorAction.follow(this.props.user.id);},render:function(){var isAdmin=this.props.isAdmin,user=this.props.user;return(React.createElement("div",null,React.createElement("span",{className:"user-client-name"},user.id),React.createElement("span",{className:"pull-right"},React.createElement("a",{target:"_blank",href:"/"+user.id+"/"},React.createElement("i",{className:"glyphicon glyphicon-info-sign"})," Info")),isAdmin&&React.createElement("div",{onClick:this.kick_,className:"pull-right",style:{clear:"both"}},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-eject"})," Kick")),!this.props.isListView&&React.createElement("div",{onClick:this.followUser_,className:"pull-right",style:{clear:"both"}},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-magnet"})," ",this.props.isFollowing?"Unfollow":"Follow")),isAdmin&&React.createElement("div",{onClick:this.editPerms_,className:"pull-right",style:{clear:"both"}},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-cog"})," Permissions"))));},});UserView={mixins:[flux.createAutoBinder(['prefs'])],getInitialState:function(){return{opened:false};},followUser_:function(){editorAction.follow(this.props.user.id);},settingsClick:function(){$(this.refs.user.getDOMNode()).toggleClass("opened");this.state.opened=!!this.state.opened;},render:function(){var connectionNodes=[],user,isAdmin,me,isListView,isFollowing,inVideoChat=false;user=this.props.user;me=this.props.me;isAdmin=me.isAdmin;isListView=this.props.isListView;user.connections.forEach(function(connection){if(!inVideoChat&&connection.inVideoChat){inVideoChat=true;}
if(!connection.connected){return;}
connectionNodes.push(React.createElement(Connection,{connection:connection,key:connection.id,me:me,username:user.username,isListView:this.props.isListView,isAdmin:isAdmin}));},this);isFollowing=this.props.prefs.followUsers.indexOf(user.id)!==-1;return(React.createElement("div",{ref:"user",className:"user"+(this.state.opened?" opened":"")},React.createElement("div",null,!this.props.isListView&&React.createElement("i",{title:isFollowing?("Stop following "+user.id):("Follow "+user.id+"'s changes"),className:"glyphicon user-indicator user-following"+(isFollowing?" enabled":""),onClick:this.followUser_}),inVideoChat&&React.createElement("i",{title:user.id+" is in video chat",className:"glyphicon user-indicator in-video"}),this.body()),React.createElement("div",{ref:"settings",className:"user-info"},React.createElement("div",{className:"stack-up"},React.createElement("div",{className:"stack-up-content"},connectionNodes.length," connection",connectionNodes.length===1?"":"s"),React.createElement("hr",null),React.createElement("div",{className:"stack-up-content"},connectionNodes),React.createElement("hr",null),React.createElement("div",{className:"stack-up-content"},this.props.connection.isMe?React.createElement(IsMeUserView,{user:user,isAdmin:isAdmin,connection:this.props.connection}):React.createElement(NotMeUserView,{user:user,isAdmin:isAdmin,isListView:isListView,isFollowing:isFollowing})),React.createElement("hr",{style:{clear:"both"}}))),React.createElement("div",{className:"user-bar",onClick:this.settingsClick},React.createElement("span",{className:"user-color-square highlight_"+user.color,style:{backgroundColor:user.color}}),React.createElement("span",{className:"user-username"},user.id),React.createElement("i",{className:"glyphicon user-arrow"}))));}};GravatarThumbnailView=React.createClass({displayName:"GravatarThumbnailView",mixins:[UserView],onClick:function(){webrtcAction.start_video_chat(this.props.connection.id);},body:function(){var canEdit=perms.indexOf("patch")!==-1,src=this.props.user.gravatar;if(src){src+="?s=228";}else{src="/static/images/anonymous.png";}
return(React.createElement("img",{src:src,className:"user-thumb",title:canEdit?"Start video chat":null,onClick:this.onClick}));}});ImageThumbnailView=React.createClass({displayName:"ImageThumbnailView",mixins:[UserView],componentDidUpdate:function(){this.refs.mugshot.getDOMNode().setAttribute("src",this.props.connection.image.data);},onClick:function(){webrtcAction.start_video_chat(this.props.connection.id);},body:function(){var canEdit=perms.indexOf("patch")!==-1,className="user-thumb"+(this.props.connection.isMe?" user-my-conn":"");return(React.createElement("img",{ref:"mugshot",className:className,style:{width:this.props.connection.image.width,height:this.props.connection.image.height},title:canEdit?"Start video chat":null,onClick:this.onClick,src:this.props.connection.image.data}));}});VideoThumbnailView=React.createClass({displayName:"VideoThumbnailView",mixins:[UserView],getInitialState:function(){var poster="/static/images/anonymous.png";if(this.props.connection.image){poster=this.props.connection.image.data;}else if(this.props.user.gravatar){poster=this.props.user.gravatar+"?s=228";}
return{poster:poster,};},componentDidMount:function(){this.id=this.props.connection.visualizer.onVISUALIZE(function(volume){this.refs.volume.getDOMNode().style.width=volume+"%";},this);},componentWillUnmount:function(){var elem=this.refs["user-thumb-"+this.props.connection.id].getDOMNode(),fullscreenElement=util.getFullscreenElement();this.props.connection.visualizer.off(this.id);if(util.getFullscreenElement()===elem){console.log("exiting full screen before unmounting");util.exitFullscreen();}},onClick:function(){var elem=this.refs["user-thumb-"+this.props.connection.id].getDOMNode(),fullscreenElement=util.getFullscreenElement();if(fullscreenElement===elem){util.exitFullscreen();return;}
util.requestFullscreen(elem);},stop:function(){if(this.props.screenShare){return webrtcAction.stop_screen(this.props.connection.id);}
webrtcAction.stop_video_chat(this.props.connection.id);},body:function(){var classNames=["user-thumb"];if(this.props.connection.isMe&&!this.props.screenShare){classNames.push("user-my-conn");}
if(this.props.connection.audioOnly){classNames.push("audio-only");}
return(React.createElement("div",null,React.createElement("i",{className:"glyphicon user-indicator user-stop",title:"Close",onClick:this.stop}),React.createElement("div",{className:"visualizer",ref:"volume"}),React.createElement("video",{className:classNames.join(" "),ref:"user-thumb-"+this.props.connection.id,onClick:this.onClick,src:this.props.src,autoPlay:"autoplay",poster:this.poster,muted:this.props.connection.isMe?"muted":null})));}});ListViewMixin={mixins:[flux.createAutoBinder(['users'])],render:function(){var thumbnailNodes=[],isListView,user,isAdmin,me,prefs;user=this.props.user;me=this.props.me;isListView=this.isListView;isAdmin=me.isAdmin;prefs=this.props.prefs;this.props.users.forEach(function(user){var hasRendered=false;user.connections.sort();user.connections.forEach(function(connection){var args;if(!connection.connected){return;}
args={connection:connection,key:connection.id,user:user,me:me,isListView:isListView,prefs:prefs};if(connection.streamURL){hasRendered=true;args.src=connection.streamURL;args.key+="video";thumbnailNodes.push(React.createElement(VideoThumbnailView,args));}else if(connection.image){hasRendered=true;args.key+="image";thumbnailNodes.push(React.createElement(ImageThumbnailView,args));}
if(!hasRendered){hasRendered=true;args.key+="gravatar";thumbnailNodes.push(React.createElement(GravatarThumbnailView,args));}
if(connection.screenStreamURL){args.src=connection.screenStreamURL;args.key+="screen";args.screenShare=true;thumbnailNodes.push(React.createElement(VideoThumbnailView,args));}},this);},this);return(React.createElement("div",{className:"user-list"},thumbnailNodes));}};ChatUserlistView=React.createClass({displayName:"ChatUserlistView",mixins:[ListViewMixin],componentName:"ChatUserlistView",isListView:true,});UserlistView=React.createClass({displayName:"UserlistView",componentName:"UserlistView",mixins:[ListViewMixin],isListView:false,});module.exports={ChatUserlistView:ChatUserlistView,UserlistView:UserlistView,};},function(module,exports,__webpack_require__){"use strict";var Connection,Connections,flux=__webpack_require__(11),util=__webpack_require__(43),context=self.AudioContext&&new self.AudioContext(),visualizer=flux.createActions({visualize:function(width){return width;}});Connection=flux.createModel({modelName:"Connection",fieldTypes:{id:flux.FieldTypes.number,path:flux.FieldTypes.string,bufId:flux.FieldTypes.number,client:flux.FieldTypes.string,platform:flux.FieldTypes.string,version:flux.FieldTypes.string,connected:flux.FieldTypes.bool,isMe:flux.FieldTypes.bool,image:flux.FieldTypes.object.defaults(null),streamURL:flux.FieldTypes.string,audioOnly:flux.FieldTypes.bool,inVideoChat:flux.FieldTypes.bool,screenStreamURL:flux.FieldTypes.string},init:function(){this.visualizer=new visualizer();},visualizer:null,jsProcessor:null,onSoundEvent:function(analyser,event){var data=new Uint8Array(analyser.frequencyBinCount),max=0;analyser.getByteFrequencyData(data);if(!data.length){return;}
_.each(data,function(frame){max=Math.max(max,frame);});max=max/2.55;this.visualizer.visualize(Math.min(max,100));},stopStream:function(){if(this.jsProcessor){this.jsProcessor.disconnect();}
this.jsProcessor=null;},processStream:function(stream){var analyser,audioSource,jsProcessor;if(!self.AudioContext){return;}
if(!context||!context.createAnalyser||!context.createScriptProcessor){console.log("Browser has no audio analyser.");return;}
console.log("begin audio thing");audioSource=context.createMediaStreamSource(stream);analyser=context.createAnalyser();analyser.fftSize=32;analyser.smoothingTimeConstant=0.5;jsProcessor=context.createScriptProcessor(1024,1,1);jsProcessor.onaudioprocess=this.onSoundEvent.bind(this,analyser);audioSource.connect(analyser);analyser.connect(jsProcessor);jsProcessor.connect(context.destination);this.stopStream();this.jsProcessor=jsProcessor;}});Connections=flux.createCollection({modelName:"Connections",model:Connection,sort:function(a,b){var aIsWeb=a.client==="web",bIsWeb=b.client==="web";if(a.image&&!b.image){return-1;}
if(b.image&&!a.image){return 1;}
if(aIsWeb&&!bIsWeb){return-1;}
if(bIsWeb&&!aIsWeb){return 1;}
if(a.id>b.id){return-1;}
return 1;}});function User(){User.super_.apply(this,arguments);}
flux.inherit(User,flux.createModel({modelName:"User",fieldTypes:{connections:Connections,id:flux.FieldTypes.string,permissions:flux.FieldTypes.list,isMe:flux.FieldTypes.bool,client:flux.FieldTypes.string,platform:flux.FieldTypes.string,isAnon:flux.FieldTypes.bool,version:flux.FieldTypes.string,gravatar:flux.FieldTypes.string,},getDefaultFields:function(){return{isAnon:true,permissions:new flux.List(),connections:new Connections()};}}));Object.defineProperty(User.prototype,"color",{get:function id(){if(this.color_){return this.color_;}
this.color_=util.userColor(this.id);return this.color_;}});Object.defineProperty(User.prototype,"isAdmin",{get:function isAdmin(){return this.permissions.indexOf("kick")!==-1;}});Object.defineProperty(User.prototype,"username",{get:function getUsername(){return this.id;}});User.prototype.getConnectionID=function(){var conn=this.connections.valueOf()[0];return conn&&conn.id;};User.prototype.createConnection=function(connectionId,client,platform,version,isMe){this.connections.add(new Connection({id:connectionId,path:"",bufId:0,client:client,platform:platform,version:version,connected:true,isMe:isMe,inVideoChat:false,}));};User.prototype.getMyConnection=function(){var conn=_.find(this.connections.valueOf(),function(conn){return conn.isMe;});return conn&&this.connections.get(conn.id);};function Users(data){Users.super_.apply(this,arguments);}
flux.inherit(Users,flux.createCollection({modelName:"Users",model:User}));Users.prototype.getByConnectionID=function(connectionId){return _.find(this.data.collection,function(user){return user.connections.get(connectionId);});};Users.prototype.getConnectionByConnectionID=function(connectionId){var user=this.getByConnectionID(connectionId);return user&&user.connections.get(connectionId);};module.exports={User:User,Users:Users};},function(module,exports,__webpack_require__){"use strict";var connConfig,mediaConstraints,connConstraints,VIDEO_SHARE,SCREEN_SHARE,AUDIO_SHARE,ExtMessaging=__webpack_require__(8),Socket=__webpack_require__(25),SoundEffects=__webpack_require__(48),Modal=__webpack_require__(42),handlerAction=__webpack_require__(12),messageAction=__webpack_require__(2),webrtcAction=__webpack_require__(38),perms=__webpack_require__(16),prefs=__webpack_require__(17);ExtMessaging.init();VIDEO_SHARE="videoshare";AUDIO_SHARE="audioshare";SCREEN_SHARE="screenshare";mediaConstraints={video:{audio:true,video:{optional:[{maxWidth:228},{maxHeight:228}]}},audio:{audio:true,optional:[{chromeRenderToAssociatedSink:true}]},screen:{audio:false,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:null,maxWidth:1920,maxHeight:1080},optional:[{maxFrameRate:10}]}}};connConfig={debug:false,iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turns:turn.floobits.com:5349",username:"floobits",credential:"stiboolf",},],limits:{audio:128,video:256},sdpHack:true};connConstraints={optional:[{DtlsSrtpKeyAgreement:true},{RtpDataChannels:true}]};function WebRTC(users,me,isChat){this.users=users;this.me=me;this.isChat=isChat;this.down_peers_={};this.up_peers_={};this.commStream=null;this.screenStream=null;this.partedUsers={};this.soundEffects=true;Socket.onWEBRTC(_.bind(this.handleMsg_,this));webrtcAction.onSTART_VIDEO_CHAT(this.startVideo,this);webrtcAction.onSTOP_VIDEO_CHAT(this.stopVideo,this);webrtcAction.onSTART_AUDIO_CHAT(this.startAudio,this);webrtcAction.onSTOP_AUDIO_CHAT(this.stopAudio,this);webrtcAction.onSTART_SCREEN(this.startScreen,this);webrtcAction.onSTOP_SCREEN(this.stopScreen,this);prefs.on(function(){if(!prefs.dnd){return;}
if(this.commStream||this.screenStream){messageAction.info("Stopping video chat because you enabled Do Not Disturb.");}
this.stopUserMedia();},this);handlerAction.onREADY(_.bind(function(roomInfo){if(_.contains(roomInfo.perms,"patch")){return;}
this.soundEffects=false;setTimeout(function(){this.soundEffects=true;}.bind(this),4000);},this));handlerAction.on(handlerAction.CONNECTION_JOINED,function(connectionInfo){if(!this.commStream&&!this.screenStream){return;}
Socket.send_webrtc({action:"marco",data:this.myStreams(),to:[connectionInfo.user_id],});},this);}
WebRTC.prototype.gotUserMedia_=function(type,users,err,stream){var err_msg,me,myConnId=this.myConnId_();if(_.isArray(users)){users=_.filter(users,function(u){return u!==myConnId;});}
if(err){console.error("WebRTC error!",err);if(err.name){err=err.name;}
if(type==="screen"){err_msg="Please read our <a href=\"/help/webrtc#screenshare\" target=\"_blank\">guide to setting up WebRTC screen sharing</a>.";}else{if(err==="DevicesNotFoundError"){err_msg="Could not detect camera or microphone.";}else{err_msg="Please read our <a href=\"/help/webrtc\" target=\"_blank\">guide to setting up WebRTC</a>.";}}
Modal.showWithUnsafeHTML("Error activating WebRTC: "+err+"\n<br />"+err_msg);return;}
if(type==="screen"){this.screenStream=stream;}else if(type==="video"||type==="audio"){this.commStream=stream;}
stream._streamType=type;if(users){Socket.send_webrtc({action:"start",data:this.myStreams(),to:users,});}
Socket.send_webrtc({action:"marco",data:this.myStreams(),to:[],});stream.onended=_.bind(this.stopStream,this,stream,type);this.addStream_(this.me.getMyConnection(),stream,type);};WebRTC.prototype.myConnId_=function(){return this.me.getMyConnection().id;};WebRTC.prototype.log_=function(otherConnId,msg){var otherUser;otherUser=this.users.getByConnectionID(otherConnId);if(!otherUser){return;}
msg=otherUser.id+msg;messageAction.info(msg);};WebRTC.prototype.handlePolo_=function(otherConnId,streams){var self=this,otherUser,myConnId,msg;if(!self.commStream&&!self.screenStream){return;}
console.log("Handling webrtc polo from",otherConnId);otherUser=this.users.getByConnectionID(otherConnId);if(!otherUser){console.log("No user for conn id",otherConnId);return;}
_.each(streams,function(type){delete self.partedUsers[otherConnId+"_"+type];self.createNewOffer_(otherConnId,type);});};WebRTC.prototype.myStreams=function(){var streams=[];if(this.commStream){streams.push(this.commStream._streamType);}
if(this.screenStream){streams.push(this.screenStream._streamType);}
return streams;};WebRTC.prototype.sendReject=function(username,otherUserId){var reason;if(prefs.dnd){messageAction.info(("Rejected "+username+"s video chat because you enabled Do Not Disturb."));reason="Do Not Disturb on";}else if(!webrtcsupport.PeerConnection){messageAction.info(("Rejected "+username+"s video chat because your browser doesnt support WebRTC."));reason="Peer's browser doesn't support WebRTC.";}else if(perms.indexOf("patch")===-1){messageAction.info(("Rejected "+username+"s video chat because you dont have edit permission."));reason="User does not have edit permission.";}
Socket.send_webrtc({action:"reject",data:reason,to:[otherUserId],});};WebRTC.prototype.handleMarco_=function(otherUserId,streams){var self=this,username;if(prefs.dnd||!webrtcsupport.PeerConnection){username=this.users.getByConnectionID(otherUserId).id;this.sendReject(username,otherUserId);return;}
if(this.isChat&&_.size(this.myStreams())===0){return;}
Socket.send_webrtc({action:"polo",data:this.myStreams(),to:[otherUserId],});_.each(streams,function(type){delete self.partedUsers[otherUserId+"_"+type];self.createNewOffer_(otherUserId,type);});};WebRTC.prototype.createNewOffer_=function(connId,type){var pc;pc=this.setupPeer_(this.down_peers_,connId,type);if(pc.sent_offer){console.log("PeerConnection offer for user",connId,type,"has already been sent");return;}
this.log_(connId," is connecting to your video chat.");pc.on("close",_.bind(this.handleClosedConnection_,this,connId,type));pc.sent_offer=true;pc.offer(function(err,sdp){if(err){console.error("sessionDescription error",err.toString());return;}
Socket.send_webrtc({action:"offer_sdp",data:sdp,stream_type:type,to:[connId],});});};WebRTC.prototype.setupPeer_=function(peers,connId,type){var pc,pcKey,config=_.cloneDeep(connConfig),ice_name;if(peers===this.up_peers_){ice_name="ice_down";}else if(peers===this.down_peers_){ice_name="ice_up";}else{throw new Error("setupPeer_ got weird peers list that is neither up nor down!");}
config.sdpHack=type!=="screen";console.log("setting sdp hack?",config.sdpHack);pcKey=connId+"_"+type;if(_.has(peers,pcKey)){console.log("setupPeer:",pcKey,"already exists. not doing anything");return peers[pcKey];}
pc=new PeerConnection(config,connConstraints);peers[pcKey]=pc;pc.on("iceConnectionStateChange",function(event){var peer=peers[pcKey];console.log("iceConnectionStateChange",event);if(connId>=this.me.getMyConnection().id){return;}
if(_.has(this.partedUsers,pcKey)){console.log(pcKey,"in partedUsers. Bailing.");return;}
if(pc.iceConnectionState!=="disconnected"){return;}
if(!peer){console.log("No peerConnection. Reconnecting to",pcKey);this.createNewOffer_(connId,type);return;}
console.log("Reconnecting to",pcKey);delete peers[pcKey];peer.once("close",function(){console.debug("closed",pcKey);this.createNewOffer_(connId,type);}.bind(this));peer.close();}.bind(this));pc.on("removeStream",function(event){console.debug("removeStream",event);});pc.on("ice",function(event){Socket.send_webrtc({action:ice_name,data:event,stream_type:type,to:[connId],});});pc.on("addStream",function(evt){var user;console.debug("addStream",evt);if(this.soundEffects){SoundEffects.join(this.users.getByConnectionID(connId).id);}
this.addStream_(this.users.getConnectionByConnectionID(connId),evt.stream,type);}.bind(this));pc.on("error",console.log);return pc;};WebRTC.prototype.handleClosedConnection_=function(connId,type){var conn,me=this.myConnId_(),otherStreams=false;conn=this.users.getConnectionByConnectionID(connId);conn.stopStream();if(type==="screen"){conn.screenStreamURL=null;}else{conn.streamURL=null;}
console.debug("Like *poof*.",connId);this.log_(connId," has disconnected from your video chat.");if(this.soundEffects){SoundEffects.leave(this.users.getByConnectionID(connId).id);}
otherStreams=_.find(this.users.valueOf(),function(u){return _.find(u.connections.valueOf(),function(c){return(c.streamURL||c.screenStreamURL)&&c.id!==me;});});if(!otherStreams){this.stopUserMedia();}};WebRTC.prototype.addStream_=function(connection,stream,type){if(type==="screen"){connection.screenStreamURL=URL.createObjectURL(stream);return;}
connection.processStream(stream);connection.set({streamURL:URL.createObjectURL(stream),audioOnly:type==="audio",});};WebRTC.prototype.handleMsg_=function(msg){var down_pc,up_pc,pcKey,supportedMessages,data,user,conn,rejectMsg;console.log("Webrtc got a data message",msg);supportedMessages=["answer_sdp","ice_down","ice_up","marco","mute","offer_sdp","polo","quit","reject","start","stop","unmute",];if(!_.contains(supportedMessages,msg.action)){console.error("Unknown webrtc message action",msg.action);return;}
data=msg.data;conn=this.users.getConnectionByConnectionID(msg.user_id);pcKey=msg.user_id+"_"+msg.stream_type;down_pc=this.down_peers_[pcKey];up_pc=this.up_peers_[pcKey];switch(msg.action){case"mute":console.log("muting user",data.mute);this.mute(data.mute,true);break;case"unmute":console.log("unmuting user",data.unmute);this.mute(data.unmute,false);break;case"reject":user=this.users.getByConnectionID(msg.user_id);rejectMsg=(user.id+" rejected your video chat request.");if(data){rejectMsg+=(" Reason: "+data);}
messageAction.log(rejectMsg);break;case"quit":conn.inVideoChat=false;this.partedUsers[pcKey]=true;this.closePeer_(msg.user_id,msg.stream_type);break;case"ice_down":if(down_pc){console.log("Processing downstream PC ICE",data);down_pc.processIce(data);}else{console.log("No PC for downstream ICE",data);}
break;case"ice_up":if(up_pc){console.log("Processing upstream PC ICE",data);up_pc.processIce(data);}else{console.log("No PC for upstream ICE",data);}
break;case"offer_sdp":this.processOfferSDP_(msg.user_id,msg.stream_type,data);break;case"answer_sdp":down_pc.handleAnswer(data);break;case"marco":conn.inVideoChat=true;this.handleMarco_(msg.user_id,data);break;case"polo":this.handlePolo_(msg.user_id,data);break;case"start":if(perms.indexOf("patch")===-1||prefs.dnd||!webrtcsupport.PeerConnection){user=this.users.getByConnectionID(msg.user_id);this.sendReject(user.id,msg.user_id);}else{if(this.commStream){Socket.send_webrtc({action:"marco",data:this.myStreams(),to:[msg.user_id],});}else{this.startUserMedia(prefs.audioOnly?"audio":"video");}}
break;case"stop":if(_.contains(data,"video")){this.stopUserMedia(this.commStream,"video");}
if(_.contains(data,"audio")){this.stopUserMedia(this.commStream,"audio");}
if(_.contains(data,"screen")){this.stopUserMedia(this.screenStream,"screen");}
break;default:console.error("Unknown webrtc event action",data);break;}};WebRTC.prototype.processOfferSDP_=function(userId,type,offer){var pc=this.setupPeer_(this.up_peers_,userId,type);if(!pc.pc){console.log("no pc.pc for",userId,type);return;}
pc.answer(offer,function(err,answer){if(err){console.log("Got answer error",err.toString());return;}
Socket.send_webrtc({action:"answer_sdp",data:answer,stream_type:type,to:[userId],});});if(type==="screen"){pc.addStream(this.screenStream);}else{pc.addStream(this.commStream);}};WebRTC.prototype.handlePart_=function(data){var self=this;_.each(["audio","video","screen"],function(type){self.partedUsers[data.user_id+"_"+type]=true;self.closePeer_(data.user_id,type);});};WebRTC.prototype.closePeer_=function(connId,type,opt_silent){var self=this,key=connId+"_"+type,conn,down_pc;down_pc=this.down_peers_[key];if(down_pc&&opt_silent===false){this.log_(connId," has quit video chat.");}
conn=self.users.getConnectionByConnectionID(connId);if(conn){conn.stopStream();}
try{down_pc.close();}catch(unused){}
delete this.down_peers_[key];setTimeout(function(){var still_connected=_.any(["video","audio","screen"],function(type){return!!self.down_peers_[connId+"_"+type];});if(still_connected){return;}
_.each(["video","audio","screen"],function(type){var pcKey=connId+"_"+type,pc=self.up_peers_[pcKey];delete self.up_peers_[pcKey];try{pc.close();}catch(unused){}});},2000);};WebRTC.prototype.startAudio=function(connId){if(this.commStream){Socket.send_webrtc({action:"start",data:this.myStreams(),to:[connId],});}else{this.startUserMedia("audio",[connId]);}};WebRTC.prototype.stopAudio=function(){this.stopUserMedia(this.commStream,"audio");};WebRTC.prototype.reloadShareScreen=function(){window.location.reload(true);};WebRTC.prototype.startScreen=function(){var self=this;if(this.screenStream){Socket.send_webrtc({action:"start",data:this.myStreams(),to:[],});return;}
if(navigator.userAgent.toLowerCase().indexOf('chrome')===-1){Modal.showWithUnsafeHTML("Sorry, only Chrome supports WebRTC screen sharing. Please read our <a href=\"/help/webrtc#screenshare\" target=\"_blank\">guide to setting up WebRTC screen sharing</a>.");return;}
console.log("setting up content script in webpage");ExtMessaging.getSharedScreenId(function(id){if(!id){console.log("no idea. bailing");return;}
console.log("media source id is",id);mediaConstraints.screen.video.mandatory.chromeMediaSourceId=id;self.startUserMedia("screen",[]);});};WebRTC.prototype.stopScreen=function(connId){if(this.myConnId_()===connId){this.stopUserMedia(this.screenStream,"screen");}else{Socket.send_webrtc({action:"stop",data:["screen"],to:[connId],});}};WebRTC.prototype.startVideo=function(connId){if(this.commStream){Socket.send_webrtc({action:"start",data:this.myStreams(),to:[connId],});}else{this.startUserMedia("video",[connId]);}};WebRTC.prototype.stopVideo=function(connId){if(this.myConnId_()===connId){this.stopUserMedia(this.commStream,"video");}else{Socket.send_webrtc({action:"stop",data:["video"],to:[connId],});}};WebRTC.prototype.startUserMedia=function(type,users){var mcs=mediaConstraints[type];if(!mcs){console.error("No constraints for type",type);return;}
if(type==="screen"&&this.screenStream){console.log("Screen share already open");return;}
if((type==="video"||type==="audio")&&this.commStream){console.log("Comm stream already open.");this.stopStream(this.commStream);}
console.log("Media constraints:",mcs);getUserMedia(mcs,_.bind(this.gotUserMedia_,this,type,users));};WebRTC.prototype.getStreamType=function(stream){var type;if(stream===this.commStream){type=stream.getVideoTracks().length>0?"video":"audio";}else if(stream===this.screenStream){type="screen";}else{throw new Error("Unknown type for stream",stream);}
return type;};WebRTC.prototype.stopStream=function(stream,type){var conn;if(!stream){return;}
if(!type){type=this.getStreamType(stream);}
if(stream._____stopped){return;}
stream._____stopped=true;try{stream.stop();}catch(unused){}
conn=this.users.getConnectionByConnectionID(this.myConnId_());if(type==="screen"){this.screenStream=null;conn.screenStreamURL=null;}else{this.commStream=null;conn.streamURL=null;}
conn.stopStream();Socket.send_webrtc({action:"quit",stream_type:type,data:{},to:[],});_.each(this.up_peers_,function(pc,pcKey){if(pcKey.split("_")[1]!==type){return;}
delete this.up_peers_[pcKey];try{pc.close();}catch(unused){}},this);};WebRTC.prototype.stopUserMedia=function(stream,type){var self=this,elementId;if(!this.commStream&&!this.screenStream){return;}
if(type){console.log("Stopping video for stream.",stream,type);this.stopStream(stream,type);}else{if(this.commStream){type=this.getStreamType(this.commStream);this.stopStream(this.commStream);}
if(this.screenStream){type="screen";this.stopStream(this.screenStream,type);}}
if(this.commStream||this.screenStream){return;}
function closePeers(peers){var openPeers=[];_.each(peers,function(peer,k){var userId=k.split("_")[0],type=k.split("_")[1];openPeers.push(k);peer.once("close",function(){openPeers=_.without(openPeers,k);if(_.isEmpty(openPeers)){console.log("all done closing");}});try{self.closePeer_(userId,type,true);}catch(e){console.debug(e);}});peers={};}
closePeers(this.up_peers_);closePeers(this.down_peers_);self.hideVideoChat();};WebRTC.prototype.hideVideoChat=function(){this.partedUsers={};};module.exports=WebRTC;},,function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11),Actions=flux.createActions({message:function(msg){return msg;},send:function(m){return m;}});module.exports=new Actions();},function(module,exports,__webpack_require__){var EventsIn,EventsOut,Socket,actions,messageAction=__webpack_require__(2),flux=__webpack_require__(11),perms=__webpack_require__(16),reqCallbacks={},patchActions=["mute","quit","reject","start","stop","unmute",];actions={socket_:null,capturedEvents:null,captureEvents:null,requestId:0,reconnectTimeout:null,engineIoURL:null};EventsIn=["ack","create_buf","create_term","datamsg","delete_buf","delete_temp_data","delete_term","error","get_buf","highlight","join","kick","msg","part","patch","perms","ping","pong","rename_buf","request_perms","room_info","saved","set_temp_data","solicit","sync","term_stdin","term_stdout","update_term","user_info","webrtc",];EventsOut=["auth","create_buf","datamsg","delete_buf","delete_temp_data","get_buf","highlight","kick","msg","patch","perms","ping","pong","pull_repo","rename_buf","request_perms","saved","set_temp_data","solicit","term_stdin","term_stdout","webrtc",];_.each(EventsOut,function(name){actions["send_"+name]=function actionOut(data,cb,that){this.send_(name,data,cb,that);return data;};});function actionIn(data){var req_id=data.req_id,f=reqCallbacks[req_id];if(f){delete reqCallbacks[data.req_id];f(data);}
return data;}
_.each(EventsIn,function(name){actions[name]=actionIn;});actions.auth=function(auth){return this.send_(null,auth);};actions.ping=function(data){return this.send_("pong",{res_id:data.req_id,});};actions.send_get_buf=function(id,cb,that){return this.send_("get_buf",{id:id},cb);};actions.disconnect=function(msg){var socket=this.socket_;this.socket_=null;if(socket){socket.off();clearInterval(this.reconnectTimeout);socket.close();}
return msg;};actions.sio_connect=function(){return;};actions.sio_disconnect=function(){return;};Socket=flux.createActions(actions);Socket.prototype.send_=function(name,msg,cb,that){msg=msg||{};if(name){if(perms.indexOf(name)===-1){console.error("OMG no permission to send",name);return;}
if(name==="webrtc"){if(perms.indexOf("patch")===-1&&patchActions.indexOf(msg.action)!==-1){console.error("Floo No permission to send webrtc",msg.action);return;}}
msg.name=name;}
if(!msg.res_id){msg.req_id=++this.requestId;}
console.log("emit",msg);this.socket_.send(JSON.stringify(msg));if(cb){reqCallbacks[msg.req_id]=cb.bind(that);}
return msg.req_id;};Socket.prototype.emitDataMessage=function(data,to){console.log("emitting data message",data,to);return this.send_("datamsg",{data:data,to:to});};Socket.prototype.connect=function(engineIoURL){var s;console.log("Connecting to",engineIoURL);this.engineIoURL=engineIoURL;try{s=new eio.Socket(engineIoURL,{transports:["websocket"]});}catch(e){messageAction.modal("Error connecting to Engine.io:"+e+"\n\n Refresh this page to try again. :(");return;}
this.socket_=s;this.requestId=0;s.on("open",function(){this.sio_connect();}.bind(this));s.on("close",function(){this.reconnect_();}.bind(this));s.on("message",function(msg){var args,f;msg=JSON.parse(msg);if(!msg.name){return;}
f=this[msg.name];if(!f){console.error("no action for "+msg.name);return;}
f(msg);}.bind(this));s.on("error",this.reconnect_.bind(this));};Socket.prototype.reconnect_=function(socket){if(this.socket_===null){console.log("Not reconnecting, no socket.");return;}
messageAction.log("Reconnecting...");this.socket_.off();this.socket_.close();if(this.reconnectTimeout){return;}
this.reconnectTimeout=setTimeout(function(){this.reconnectTimeout=null;this.connect(this.engineIoURL);}.bind(this),1500);return new Error("don't emit me");};module.exports=new Socket();},function(module,exports,__webpack_require__){"use strict";var EditorContainerView,flux=__webpack_require__(11),panel=__webpack_require__(30),panelView=__webpack_require__(29),EditorView=__webpack_require__(7),editorAction=__webpack_require__(5);EditorContainerView=React.createClass({displayName:"EditorContainerView",getInitialState:function(){return{orientation:null,panels:null,};},getSize:function(){var node=$(this.getDOMNode().parentNode);return this.state.orientation==="horizontal"?node.width():node.height();},componentDidUpdate:function(prevProps,prevState){this.resize();},componentDidMount:function(){var getItems;getItems=function(){var size=this.getSize();return this.props.editors.map(function(editor,id){return{size:size/this.props.editors.length,headerClass:"sidebar-header sidebar-header-top",id:"Editor"+id,component:EditorView,props:{editor:editor,bufs:this.props.bufs,key:id},};},this);}.bind(this);editorAction.onSPLIT_EDITOR(function(direction){if(!this.state.orientation||this.state.orientation===direction){this.props.editors.createEditor();}
this.setState({orientation:direction});this.state.panels.items.set(getItems());},this);editorAction.onRENAME_PROMPT(function(){var activeEditor=this.props.editors.find(function(editor){return editor.active;});if(activeEditor){editorAction.start_rename_prompt(activeEditor.activeTab);}},this);editorAction.onUNSPLIT_EDITOR(function(){var activeIndex;this.props.editors.forEach(function(editor,index){if(editor.active){activeIndex=index;return false;}});this.props.editors.splice(0,activeIndex);this.props.editors.splice(1);this.state.panels.items.set(getItems());},this);this.setState({panels:new panel.Panels({size:this.getSize(),items:getItems()})});},resize:function(){var size=this.getSize()+(2*(this.props.editors.length-1));if(this.state.panels){this.state.panels.resize(size);}
this.props.editors.forEach(function(editor){editor.ace.resize(true);});},handleDrag:function(){this.resize();},handleDragStop:function(){this.resize();},render:function(){if(!this.state.panels){return(React.createElement("div",null));}
if(this.state.orientation==="horizontal"){return React.createElement(panelView.PanelViewHorizontal,{panels:this.state.panels});}
return React.createElement(panelView.PanelViewVertical,{panels:this.state.panels});}});module.exports=EditorContainerView;},function(module,exports,__webpack_require__){"use strict";var FiletreeView,FileView,TermTreeView,TermTreeUserView,FolderMixin,ClosedFolderView,OpenFolderView,actions,perms=__webpack_require__(16),flux=__webpack_require__(11),editorAction=__webpack_require__(5),DelDirModalView=__webpack_require__(50),TerminalModalView=__webpack_require__(51);actions=new(flux.createActions({open:function(path){return[path];},close:function(path){return[path];}}))();TermTreeUserView=React.createClass({displayName:"TermTreeUserView",getInitialState:function(){return{expanded:true,};},render:function(){var termTrees=_.map(this.props.terms,function(term){var highlighted=false;if(this.props.openedTerm){highlighted=this.props.openedTerm===term.id;}
return(React.createElement("li",{id:"floobits-terminal-"+term.id,className:"buf-item tree-item "+(highlighted&&"highlighted"),key:term.id,onClick:function(){editorAction.open_term(term.id);}},term.title));},this);return(React.createElement("li",null,React.createElement("div",{className:"dir_name tree-item",onClick:function(){this.setState({expanded:!this.state.expanded});}.bind(this)},React.createElement("i",{className:"glyphicon glyphicon-"+(this.state.expanded?"chevron-down":"chevron-right")}),"",this.props.username),React.createElement("ol",{style:{display:(this.state.expanded)?"block":"none"}},termTrees)));}});TermTreeView=React.createClass({displayName:"TermTreeView",mixins:[flux.createAutoBinder(['terms'])],getInitialState:function(){return{openedTerm:null,};},componentDidMount:function(){editorAction.onOPEN(function(buf){this.setState({openedTerm:null,});},this);editorAction.onOPEN_TERM(function(term){this.setState({openedTerm:term.id,});},this);},onClick_:function(){if(this.props.terms.length===0){TerminalModalView.show();}},render:function(){var termUsers={},terms;this.props.terms.forEach(function(term,id){var username=term.username;termUsers[username]=termUsers[username]||[];termUsers[username].push(term);});terms=_.map(termUsers,function(terms,username){return React.createElement(TermTreeUserView,{username:username,terms:terms,key:username,openedTerm:this.state.openedTerm});},this);return(React.createElement("ol",{id:"terms"},React.createElement("li",null,React.createElement("div",{className:"dir_name tree-item",onClick:this.onClick_},React.createElement("i",{className:"glyphicon glyphicon-phone-alt"})," ",this.props.terms.length," terminal",this.props.terms.length===1?"":"s"),React.createElement("ol",null,terms))));}});FileView=React.createClass({displayName:"FileView",componentName:"FileView",openBuf:function(event){editorAction.open(this.props.id);},deleteBuf:function(event){editorAction.close(this.props.id);editorAction.delete_buf(this.props.id);event.stopPropagation();event.preventDefault();},render:function(){var canDelete=perms.indexOf("delete_buf")>=0;return(React.createElement("li",{id:"floobits-buffer-"+this.props.id,ref:"bufitem",className:"buf-item tree-item"+(this.props.highlight?" highlighted":""),onClick:this.openBuf},React.createElement("span",{className:"buf_name"},"",this.props.name),React.createElement("span",{className:"buf-delete item-delete glyphicon glyphicon-trash"+(canDelete?" item-show":""),onClick:this.deleteBuf})));}});FolderMixin={getPath:function(){var prefix=[];if(this.props.getPath){prefix=this.props.getPath();}
return prefix.concat(this.props.name);},getViewablePath:function(){var pathParts;if(!this.props.getPath){return"/";}
pathParts=this.props.getPath();pathParts.shift();return pathParts.join("/")+"/"+this.props.name;},deleteDir_:function(event){var path;event.stopPropagation();event.preventDefault();path=this.getViewablePath();DelDirModalView.show(path,this.props.tree);},addBuff_:function(event){var path;event.stopPropagation();event.preventDefault();path=this.getViewablePath();if(path[0]==="/"){path=path.substr(1);}
if(path.length){path=path+"/";}
editorAction.new_file_prompt(path);},render:function(){var nodes=this.renderNodes(),canDelete=perms.indexOf("delete_buf")>=0,canEdit=perms.indexOf("patch")>=0;return(React.createElement("li",null,React.createElement("div",{className:"dir_name tree-item",onClick:this.onClick_,style:{verticalAlign:"middle"}},React.createElement("i",{className:"glyphicon "+this.glyphicon}),"",this.props.name,React.createElement("i",{className:"item-add-buf glyphicon glyphicon-plus"+(canEdit?" item-show":""),onClick:this.addBuff_}),React.createElement("i",{className:"dir-delete item-delete glyphicon glyphicon-trash"+(canDelete?" item-show":""),onClick:this.deleteDir_})),nodes&&React.createElement("ol",null,nodes)));}};ClosedFolderView=React.createClass({displayName:"ClosedFolderView",glyphicon:"glyphicon-folder-close",mixins:[FolderMixin],renderNodes:function(){},onClick_:function(event){actions.open(this.getPath());}});OpenFolderView=React.createClass({displayName:"OpenFolderView",glyphicon:"glyphicon-folder-open",mixins:[FolderMixin],onClick_:function(event){actions.close(this.getPath());},renderNodes:function(){var name=this.props.name,children=this.props.tree||{},nodes=[],fileNodes=[],expandedTree=this.props.expandedTree&&this.props.expandedTree[name];_.keys(children).sort().forEach(function(itemname){var bufIdOrFolder=children[itemname];if(_.isNumber(bufIdOrFolder)){return fileNodes.push(React.createElement(FileView,{name:itemname,id:bufIdOrFolder,highlight:this.props.openBufID===bufIdOrFolder,key:itemname}));}
if(!expandedTree||!expandedTree[itemname]){return nodes.push(React.createElement(ClosedFolderView,{name:itemname,getPath:this.getPath,tree:bufIdOrFolder,key:itemname}));}
return nodes.push(React.createElement(OpenFolderView,{tree:bufIdOrFolder,expandedTree:expandedTree,openBufID:this.props.openBufID,name:itemname,key:itemname,getPath:this.getPath}));},this);return nodes.concat(fileNodes);}});FiletreeView=React.createClass({displayName:"FiletreeView",componentName:"FiletreeView",mixins:[flux.createAutoBinder(["tree"],[perms])],root:null,getInitialState:function(){var expandedTree={};expandedTree[this.props.name]=true;this.shouldScroll=true;return{openBufID:null,expandedTree:expandedTree};},expandPath_:function(path_){var i,p,path={},currentPath_=path;for(i=0;i<path_.length-1;i++){p=path_[i];currentPath_[p]={};currentPath_=currentPath_[p];}
currentPath_[_.last(path_)]=true;return _.merge(this.state.expandedTree,path);},componentDidMount:function(){editorAction.onOPEN(function(buf){var path=[this.props.name].concat(buf.path.split("/"));this.setState({openBufID:buf.id,expandedTree:this.expandPath_(path)},this.scroll.bind(this,"floobits-buffer-"+buf.id));},this);actions.onOPEN(function(path){this.setState({expandedTree:this.expandPath_(path)});},this);actions.onCLOSE(function(path){var i,p,tree=this.state.expandedTree,currentPath_=tree;for(i=0;i<path.length-1;i++){p=path[i];currentPath_=currentPath_[p];if(!currentPath_){return;}}
delete currentPath_[_.last(path)];this.setState({expandedTree:tree});},this);editorAction.onOPEN_TERM(function(term){this.setState({openBufID:null,},this.scroll.bind(this,"floobits-terminal-"+term.id));},this);},scroll:function(id){var bufferElement=document.getElementById(id);if(!bufferElement){return;}
if(_.isFunction(bufferElement.scrollIntoViewIfNeeded)){bufferElement.scrollIntoViewIfNeeded();}else{bufferElement.scrollIntoView();}},render:function(){return(React.createElement("div",null,React.createElement(TermTreeView,{terms:this.props.terminals}),React.createElement("ol",{id:"tree"},React.createElement(OpenFolderView,{name:this.props.name,tree:this.props.tree.tree,openBufID:this.state.openBufID,expandedTree:this.state.expandedTree}))));},});module.exports=FiletreeView;},function(module,exports,__webpack_require__){"use strict";var MP,Menu,MenuItem,MenuBarView,MenuView,NewFileView,RenameFileView,FileNameMixin,PopoverMixin=__webpack_require__(47).PopoverMixin,editorAction=__webpack_require__(5),modal=__webpack_require__(42),ModalMixin=modal.ReactModalMixin;MenuItem=React.createClass({displayName:"MenuItem",itemClick:function(item,event){if(item.action){item.action();if(!item.href){event.preventDefault();}}
this.props.leave();},render:function(){var item=this.props.item;return(React.createElement("li",{onClick:this.itemClick.bind(this,item),className:item.enabled?undefined:"disabled"},React.createElement("a",{href:item.href||"#",target:item.href?"_blank":undefined,tabIndex:"-1"},item.icon&&React.createElement("i",{className:"glyphicon glyphicon-"+item.icon}),item.name,item.selected&&React.createElement("i",{className:"glyphicon glyphicon-ok"}))));},});MenuView=React.createClass({displayName:"MenuView",mixins:[PopoverMixin],getInitialState:function(){return{showPopover:false,};},handleMouseEnter_:function(){this.props.closeAllMenus();this.handleMouseEnter();},render:function(){var leave=this.leave;return(React.createElement("div",{className:"menu-container",onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter_},React.createElement("div",{className:"dropdown"},this.props.menu.name),React.createElement("ul",{className:"dropdown-menu",style:{display:this.state.showPopover?"block":"none"}},this.props.menu.items.map(function(item){return(React.createElement(MenuItem,{key:item.name,item:item,leave:leave}));}))));},});MenuBarView=React.createClass({displayName:"MenuBarView",closeAllMenus:function(){_.each(this.refs,function(ref){return ref.leave&&ref.leave();});},render:function(){this.menus=[];this.props.menubar.forEach(function(menu,id){this.menus.push(React.createElement(MenuView,{menu:menu,key:menu.name,closeAllMenus:this.closeAllMenus,ref:'menu'+id}));},this);return(React.createElement("div",null,this.menus));}});FileNameMixin={getInitialState:function(){return{value:this.props.value||''};},onChange:function(event){this.setState({value:event.target.value});},componentDidMount:function(){var len,node=this.refs.newFileName.getDOMNode();node.focus();if(node.setSelectionRange&&node.value){len=node.value.length*2;node.setSelectionRange(len,len);}else{node.value=node.value;}},renderBody:function(){return(React.createElement("form",{onSubmit:this.onClick},React.createElement("label",{htmlFor:"newFileName"},"path"),"",React.createElement("input",{ref:"newFileName",id:"newFileName",type:"text",value:this.state.value,onChange:this.onChange})));},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-success",onClick:this.onClick},this.okButtonText),React.createElement("button",{className:"btn btn-cancel","data-dismiss":"modal"},"Cancel")));},};NewFileView=React.createClass({displayName:"NewFileView",mixins:[ModalMixin,FileNameMixin],okButtonText:"Create",renderHeader:function(){return("Create a New File or Folder");},onClick:function(event){editorAction.new_file(this.state.value);this.close();event.preventDefault();},});RenameFileView=React.createClass({displayName:"RenameFileView",mixins:[ModalMixin,FileNameMixin],okButtonText:"Rename",renderHeader:function(){return("Rename File or Folder");},onClick:function(event){editorAction.rename_request(this.state.value);this.close();event.preventDefault();},});editorAction.on(editorAction.NEW_FILE_PROMPT,function(pathPrefix){modal.showModal(NewFileView,{value:pathPrefix});});editorAction.on(editorAction.START_RENAME_PROMPT,function(oldPath){modal.showModal(RenameFileView,{value:oldPath});});module.exports={MenuView:MenuView,MenuBarView:MenuBarView,NewFileView:NewFileView,};},function(module,exports,__webpack_require__){"use strict";var PanelView,PanelViewHorizontal,PanelViewVertical,panelAction=__webpack_require__(52),flux=__webpack_require__(11);PanelView={componentName:"PanelView",mixins:[flux.createAutoBinder(["panels"])],spans_:null,draggables_:null,containerSize:null,draggablize:function(){if(!this.props.panels.draggable){return;}
this.undraggablize();this.draggables_=this.props.panels.items.map(function(item,key,index){var handle,options={axis:this.axis,containment:this.getDOMNode(),disabled:false};if(item.grid){options.grid=[item.grid,item.grid];}
handle=$(this.domFromIndex("drag-handle",index));if(!handle.length){return;}
return handle.draggable(options).on("drag",this.indexFromEvent_(this.handleDrag_)).on("dragstart",this.indexFromEvent_(this.handleDragStart_)).on("dragstop",this.indexFromEvent_(this.handleDragStop_));},this);this.draggables_=this.draggables_.filter(function(item){return!!item;});},undraggablize:function(){if(!this.draggables_||!this.draggables_.length){return;}
this.draggables_.map(function(draggable){draggable.draggable({disabled:true}).off("drag").off("dragstart").off("dragstop");});this.draggables_=null;},componentDidMount:function(){this.draggablize();this.containerSize=[$(this.getDOMNode()).outerWidth(),$(this.getDOMNode()).outerHeight()];panelAction.onRESIZE(this.onResize);},componentWillUnmount:function(){this.undraggablize();},componentDidUpdate:function(){if(this.isMounted()){this.draggablize();}},indexFromEvent_:function(cb){return function(event,ui){var index=+(event.target.getAttribute("data-handle-index"));return cb(index,event,ui);};},domFromIndex:function(ref,index){ref=this.refs[ref+index];return ref&&ref.getDOMNode();},handleDragStart:function(){this.props.panels.items.map(function(item,key,index){var comp=this.refs["component-"+index];if(_.isFunction(comp.handleDragStart)){comp.handleDragStart();}},this);},handleDragStop:function(){this.props.panels.items.map(function(item,key,index){var comp=this.refs["component-"+index];if(_.isFunction(comp.handleDrag)){comp.handleDragStop();}},this);},handleDrag:function(){this.props.panels.items.map(function(item,key,index){var comp=this.refs["component-"+index];if(_.isFunction(comp.handleDrag)){comp.handleDrag();}},this);},handleDrag_:function(index,event,ui){var comp,items=this.props.panels.items,item0Right=this.spans_[this.start]+ui.position[this.start],item1Width=this.spans_[this.end]-item0Right,item0,item1,body0,body1,item0Left,panelItem0,panelItem1;item0=this.domFromIndex("item",index-1);item1=this.domFromIndex("item",index);body0=this.domFromIndex("body",index-1);body1=this.domFromIndex("body",index);item0Left=parseInt(item0.style[this.start],10);panelItem0=items.byIndex(index-1);panelItem1=items.byIndex(index);if(item0Right-item0Left<panelItem0.minSize){item0Right=item0Left+panelItem0.minSize;item1Width=this.spans_[this.end]-item0Right;}
if(item1Width<panelItem1.minSize){item0Right=this.spans_[this.end]-panelItem1.minSize;item1Width=panelItem1.minSize;}
item0.style[this.span]=item0Right-item0Left+"px";body0.style[this.span]=item0Right-item0Left+"px";item1.style[this.span]=item1Width+"px";body1.style[this.span]=item1Width+"px";item1.style[this.start]=item0Right+"px";ui.position[this.start]=0;comp=this.refs["component-"+(index-1)];if(_.isFunction(comp.handleDrag)){comp.handleDrag();}
comp=this.refs["component-"+index];if(_.isFunction(comp.handleDrag)){comp.handleDrag();}},handleDragStart_:function(index,event,ui){var comp,items=this.props.panels.items;this.spans_={};this.spans_[this.start]=parseInt(this.domFromIndex("item",index).style[this.start],10);this.spans_[this.end]=this.spans_[this.start]+items.byIndex(index).size;comp=this.refs["component-"+(index-1)];if(_.isFunction(comp.handleDragStart)){comp.handleDragStart();}
comp=this.refs["component-"+index];if(_.isFunction(comp.handleDragStart)){comp.handleDragStart();}},handleDragStop_:function(index,event,ui){var items=this.props.panels.items,comp,start=parseInt(this.domFromIndex("item",index-1).style[this.span],10),end=parseInt(this.domFromIndex("item",index).style[this.span],10);items.byIndex(index-1).set({size:start},{silent:true});comp=this.refs["component-"+(index-1)];if(_.isFunction(comp.handleDragStop)){comp.handleDragStop();}
comp=this.refs["component-"+index];if(_.isFunction(comp.handleDragStop)){comp.handleDragStop();}
items.byIndex(index).set({size:end},{silent:true});this.props.panels.save();},render:function(){var start=0,nodes,panels=this.props.panels;nodes=this.props.panels&&this.props.panels.items.map(function(item,key,index){var bodyStyle={},component,props,containerStyle,handlerStyle;bodyStyle[this.span]=item.size;props=_.clone(item.props);props.panel={resize:panels.resizeItem.bind(panels,item),item:item,get size(){return item.size;}};props.key=index;props.ref="component-"+index;component=React.createElement(item.component,props);containerStyle={};containerStyle[this.start]=start;start+=item.size;containerStyle[this.span]=item.size;containerStyle.height=containerStyle.height||"100%";containerStyle.width=containerStyle.width||"100%";handlerStyle={};handlerStyle[this.start]=0;return(React.createElement("div",{ref:"item"+index,className:"panel-item-container",key:"item"+index,style:containerStyle},index===0?false:React.createElement("div",{ref:"drag-handle"+index,"data-handle-index":index,className:"panel-drag-handle panel-drag-handle-"+this.axis,style:handlerStyle},""),React.createElement("div",{ref:"body"+index,className:"panel-item-body-"+this.axis,style:bodyStyle},component)));},this);return(React.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0}},nodes));}};PanelViewHorizontal=React.createClass({displayName:"PanelViewHorizontal",mixins:[PanelView],axis:"x",span:"width",start:"left",end:"right",onResize:function(){var width;if(!this.isMounted()){return;}
width=$(this.getDOMNode()).outerWidth();if(width!==this.containerSize[0]){this.containerSize[0]=width;this.props.panels.resize(width);window.setTimeout(this.handleDrag,100);this.props.panels.save();}},});PanelViewVertical=React.createClass({displayName:"PanelViewVertical",mixins:[PanelView],axis:"y",span:"height",start:"top",end:"bottom",onResize:function(){var height;if(!this.isMounted()){return;}
height=$(this.getDOMNode()).outerHeight();if(height!==this.containerSize[1]){this.containerSize[1]=height;window.setTimeout(this.handleDrag,100);this.props.panels.resize(height);}},});module.exports={PanelViewVertical:PanelViewVertical,PanelViewHorizontal:PanelViewHorizontal,};},function(module,exports,__webpack_require__){"use strict";var Item,Items,Panels,id=0,panelAction=__webpack_require__(52),flux=__webpack_require__(11);Item=flux.createModel({modelName:"PanelItem",fieldTypes:{id:flux.FieldTypes.string,size:flux.FieldTypes.number,headerClass:flux.FieldTypes.string.ephemeral(),component:flux.FieldTypes.object.ephemeral().required(),props:flux.FieldTypes.object.ephemeral().required(),defaultSize:flux.FieldTypes.number.ephemeral(),minSize:flux.FieldTypes.number.ephemeral().defaults(0),maxSize:flux.FieldTypes.number.ephemeral().defaults(Infinity),grid:flux.FieldTypes.number.ephemeral().defaults(null),},});Items=flux.createCollection({model:Item,modelName:"PanelItems",});Panels=flux.createModel({backend:flux.backends.local,modelName:"Panels",fieldTypes:{items:Items,id:flux.FieldTypes.string.ephemeral(),size:flux.FieldTypes.number.ephemeral(),draggable:flux.FieldTypes.bool.ephemeral().defaults(true)},getDefaultFields:function(){return{items:new Items(),id:++id,};},resizeItem:function(item,size){var previousSize=this.size;this.silent_=true;this.size+=size-item.size;item.set({size:size},{silent:true});this.silent_=false;this.resize(previousSize);window.setTimeout(panelAction.resize,0);},resize:function(size){var spaceTaken=0,unsized=0;size=size||this.size;this.silent_=true;this.items.forEach(function(item){if(item.defaultSize){spaceTaken+=item.size;return;}
if(!item.size){unsized++;}});this.items.forEach(function(item){var s;if(!item.defaultSize){s=(size-spaceTaken)/(this.size-spaceTaken)*item.size;s=Math.round(s*10)/10;if(item.size!==s){item.set({size:s},{silent:true});}}},this);this.size=size;this.silent_=false;this.update("items");},init:function(){this.resize_();},resize_:function(){var spaceLeft=this.size,unspecifiedTotal=0;if(!_.isFinite(this.size)){return;}
this.items.forEach(function(item){if(!_.isFinite(item.size)){item.size=0;}
if(item.size){spaceLeft-=item.size;return;}
if(item.defaultSize){spaceLeft-=item.defaultSize;}else{unspecifiedTotal+=1;}},this);this.items.forEach(function(item){var size=0;if(item.size){size=item.size;if(item.minSize&&item.size<item.minSize){spaceLeft-=(item.minSize-item.size);size=item.minSize;}}else if(item.defaultSize){size=item.defaultSize;}else{size=spaceLeft/unspecifiedTotal;}
item.size=Math.round(size*10)/10;},this);this.items.forEach(function(item){if(item.defaultSize){return;}
if(spaceLeft!==0){spaceLeft+=item.size;item.size=Math.round((spaceLeft/(unspecifiedTotal+1))*10)/10;spaceLeft-=item.size;}},this);},didUpdate:function(field){if(field.length===0||field[0]!=="items"||!this.items){return;}
this.resize_();}});module.exports={Item:Item,Items:Items,Panels:Panels,};},function(module,exports,__webpack_require__){"use strict";var Menu,Item,ThemeItem,Items,MenuBar,flux=__webpack_require__(11),editorAction=__webpack_require__(5),perms=__webpack_require__(16),prefs=__webpack_require__(17),fields=flux.FieldTypes;Item=flux.createModel({fieldTypes:{id:fields.number,name:fields.string,icon:fields.string,action:fields.func,href:fields.string,perm:fields.string,pref:fields.string,theme:fields.string,selected:fields.bool.defaults(false),enabled:fields.bool.defaults(true),},init:function(){if(this.theme){editorAction.onPREF(function(prefs){this.selected=this.theme===prefs.theme;},this);}
if(this.pref){prefs.on(function(){this.selected=!!prefs[this.pref];},this);}
if(this.perm){perms.on(function(){this.enabled=perms.indexOf(this.perm)!==-1;},this);}}});Items=flux.createCollection({model:Item,modelName:"Items"});Menu=flux.createModel({fieldTypes:{id:fields.number,items:Items,name:fields.string,},});MenuBar=flux.createCollection({model:Menu,modelName:"MenuBar",});module.exports={Item:Item,Menu:Menu,MenuBar:MenuBar,};},function(module,exports,__webpack_require__){"use strict";var BreadCrumbs,flux=__webpack_require__(11),editorActions=__webpack_require__(5);BreadCrumbs=React.createClass({displayName:"BreadCrumbs",componentName:"BreadCrumbs",componentDidMount:function(){editorActions.onOPEN(function(data){this.setState({path:data.path});},this);},getInitialState:function(){return{path:""};},render:function(){return(React.createElement("a",{href:"#buf-"+this.state.path},this.state.path));}});module.exports=BreadCrumbs;},function(module,exports,__webpack_require__){"use strict";var appHistory=__webpack_require__(45),editorAction=__webpack_require__(5),ignoreNavigation=false;function initRoutes(owner,workspace){var re=new RegExp(("/"+owner+"/"+workspace+"/file/(.+)"));appHistory.addRoute(re,[function(path,data){ignoreNavigation=true;try{if(data){editorAction.open(data.state.bufId);}else{editorAction.open_from_path(re.exec(path)[1]);}}finally{ignoreNavigation=false;}},]);editorAction.on(editorAction.OPEN,function(buf){if(ignoreNavigation){return;}
appHistory.navigate(("/"+owner+"/"+workspace+"/file/"+buf.path),{bufId:buf.id});});}
module.exports={initRoutes:initRoutes,};},function(module,exports,__webpack_require__){"use strict";var AddFilesView,repoType="git",repoURL="",modal=__webpack_require__(42),util=__webpack_require__(43),messageAction=__webpack_require__(2),editorAction=__webpack_require__(5),Ignore=__webpack_require__(53);function isIgnored(file,opt_path){console.log("checking if file is ignored",file.name);if(file.size>Ignore.MAX_FILESIZE){return"file is over 10MB. Skipping upload.";}
if(file.name[0]==="."){return"Hidden files are ignored.";}
console.log("file is not ignored.",file.name,file.name[0]);return null;}
function uploadFile(file,opt_path){$.when(readFile(file,opt_path)).then(function(fullpath,result,type){var reason;reason=isIgnored(file);if(reason){messageAction.log(fullpath+" tree was ignored because: "+reason);return;}
console.log("uploading file",fullpath);createBuf(fullpath,result,type);});}
function createBuf(fullpath,result,type){if(!fullpath){console.log("Tried to create a file with no name or path.");return;}
if(fullpath[fullpath.length-1]==="/"){console.log("Tried to create a directory.");return;}
editorAction.create_buf(fullpath,result,type);}
function uploadTree(filetree,opt_ignores,opt_switchToBuf){var ignores,switchToBuf,totalSize;ignores=opt_ignores;if(!ignores){ignores=[];_.each(filetree.contents,function(item){if(item.isDir){ignores.push(Ignore.buildIgnores(item));}});}
switchToBuf=_.isUndefined(opt_switchToBuf)?true:opt_switchToBuf;totalSize=_.reduce(ignores,function(sum,ignore){return ignore.size+sum;},0);if(totalSize>Ignore.TOTAL_MAXSIZE){messageAction.log("This project is too big too upload, try and ignore big binary files with a .flooignore. size:",totalSize,"max:",Ignore.TOTAL_MAXSIZE);}
_.each(filetree.contents,function(item){var isIgnored;isIgnored=!!_.find(ignores,function(ignore){return ignore.isIgnored(item);},this);if(isIgnored){console.log("stuff was ignored");messageAction.log(item.fullpath+" was ignored.");return;}
if(item.isDir){switchToBuf=uploadTree(item,ignores,switchToBuf);}
createBuf(item.fullpath,item.buf,item.type,switchToBuf);switchToBuf=false;});return switchToBuf;}
function readFile(file,opt_path){var path,reader,text_reader,fullpath,reason,d;console.log("reading file.");d=new $.Deferred();path=opt_path?opt_path:"";fullpath=path+file.name;reader=new FileReader();text_reader=new FileReader();reader.onerror=function(e){messageAction.log(fullpath+"Failed to read file: "+fullpath);d.reject();};text_reader.onerror=reader.onerror;reader.onload=function(e){var result=new Uint8Array(e.target.result);if(!util.is_binary(result,result.length)){console.log("tree file",fullpath,"is not binary");text_reader.readAsText(file);return;}
d.resolve(fullpath,StringView.bytesToBase64(result),"base64");};text_reader.onload=function(e){console.log("tree resolved text reader");d.resolve(fullpath,e.target.result,"utf8");};reader.readAsArrayBuffer(file);return d.promise();}
AddFilesView=React.createClass({displayName:"AddFilesView",mixins:[modal.ReactModalMixin],handlePullRepo_:function(event){event.preventDefault();if(this.refs.gitType.getDOMNode().checked){repoType="git";}else if(this.refs.hgType.getDOMNode().checked){repoType="hg";}else if(this.refs.svnType.getDOMNode().checked){repoType="svn";}
repoURL=this.refs.repoURL.getDOMNode().value;console.log("Pulling repo..",repoType,repoURL);if(repoType&&repoURL){editorAction.pull_repo(repoType,repoURL);}
this.close();},handleDrop_:function(event){var length,i,entry,promises,filetree;event.preventDefault();event.stopPropagation();this.setState({over:false});event=event.nativeEvent;console.log("Dropped stuff.",event);if(event.dataTransfer.mozItemCount){this.handleMozDrop_(event);return;}
try{length=event.dataTransfer.items.length;}catch(unused){length=0;}
promises=[];filetree={isDir:true,contents:{}};for(i=0;i<length;i++){entry=event.dataTransfer.items[i].webkitGetAsEntry();if(!entry){console.error("handleDrop_: No entry for item",i);continue;}
promises.push(this._traverseFileTree(entry,filetree.contents));}
$.when.apply(this,promises).then(_.bind(function(){console.log("Finished tree traversal.",filetree);uploadTree(filetree);this.close();},this));},handleMozDrop_:function(event){var files,p,hasNoBytes,overSize;console.log("Handling moz drop.");files=event.dataTransfer.files;if(!files){this.close();return;}
hasNoBytes=false;overSize=false;_.each(files,function(file){if(file.size<1){hasNoBytes=true;return;}
if(file.size>Ignore.MAX_FILESIZE){overSize=true;return;}
readFile(file,'').then(_.bind(function(fullpath,result,type){console.log("Creating file from mozilla.");createBuf(fullpath,result,type);}),this);},this);this.close();if(hasNoBytes){messageAction.log("Not everything was uploaded, as one more items had 0 bytes.");}else if(overSize){messageAction.log("At least one file was too big and not uploaded.");}},_traverseFileTree:function(item,filetree,opt_path){var p;console.log("buffer result traverse file tree.");p=new $.Deferred();if(item.isFile){this._loadFileIntoTree(item,filetree,p,opt_path);}else if(item.isDirectory){this._loadDirectoryIntoTree(item,filetree,p,opt_path);}
return p.promise();},_loadFileIntoTree:function(item,filetree,p,opt_path){console.log("tree entry Is file",item.name);item.file(_.bind(function(file){console.log("tree calling tree read file");if(file.size>Ignore.MAX_FILESIZE){console.log("tree ignored too big file",item.name);p.reject();return;}
console.log("readfile start",item.name);readFile(file,opt_path).then(_.bind(function(fullpath,result,type){filetree[item.name]={isDir:false,fullpath:fullpath,buf:result,type:type,name:item.name,file:file};console.log("tree file resolved",item.name);p.resolve();},this)).fail(_.bind(function(){console.log("tree ignored file.",item.name,opt_path);p.resolve();},this));},this));},_loadDirectoryIntoTree:function(item,filetree,p,opt_path){var directoryReader,fullpath,promises;console.log("readfile tree _loadDirectoryIntoTree",item.name);if(item.name&&item.name.length&&item.name[0]==="."){p.resolve();return;}
fullpath="";if(_.isUndefined(opt_path)){fullpath="";}else{fullpath=opt_path+item.name+"/";}
promises=[];directoryReader=item.createReader();directoryReader.readEntries(_.bind(function(entries){var entry,i,subtree;if(_.isEmpty(entries)){console.log("tree dir is empty what",item.name);p.resolve();return;}
subtree={};filetree[item.name]={isDir:true,name:item.name,fullpath:fullpath,contents:subtree};for(i=0;i<entries.length;i++){entry=entries[i];promises.push(this._traverseFileTree(entry,subtree,fullpath));}
$.when.apply(this,promises).always(_.bind(function(){console.log("calling done from dir tree read what!",item.name);p.resolve();},this));},this));},handleDragEnter_:function(event){event.preventDefault();console.log("handle drag enter");this.setState({over:true});},handleDragLeave_:function(event){event.preventDefault();console.log("handle drag leave");this.setState({over:false});},handleDragOver_:function(event){event.preventDefault();},getInitialState:function(){return{over:false,};},renderBody:function(){console.log("addfiles repoURL?",this.props.repoURL);return(React.createElement("div",{id:"add-content-wizard",className:"workspace-wizard"},React.createElement("div",{className:"wizard-section"},React.createElement("p",null,"Drag files or a directory (Chrome only) into the box below to upload your project:"),React.createElement("div",{id:"drag-directory-box",className:this.state.over,onDrop:this.handleDrop_,onDragDrop:this.handleDrop_,onDragEnter:this.handleDragEnter_,onDragLeave:this.handleDragLeave_,onDragOver:this.handleDragOver_})),React.createElement("div",{id:"pull-in-content",className:"wizard-section"},React.createElement("p",null,"Pull files from a repository:"),React.createElement("form",{id:"pull-content-form",onSubmit:this.handlePullRepo_},React.createElement("label",null,React.createElement("input",{ref:"gitType",type:"radio",name:"repo_type",value:"git",defaultChecked:this.props.repoType==="git"})," git"),React.createElement("label",null,React.createElement("input",{ref:"hgType",type:"radio",name:"repo_type",value:"hg",defaultChecked:this.props.repoType==="hg"})," hg"),React.createElement("label",null,React.createElement("input",{ref:"svnType",type:"radio",name:"repo_type",value:"svn",defaultChecked:this.props.repoType==="svn"})," svn"),React.createElement("input",{ref:"repoURL",placeholder:"Repo URL",type:"text",size:"40",defaultValue:this.props.repoURL}),React.createElement("input",{type:"submit",className:"btn btn-warning",value:"pull"})),React.createElement("small",null,"If pulling over ssh, be sure to authorize ",React.createElement("a",{href:"/static/pubkeys/floobot.pub.txt",target:"_blank"},"our public key"),".")),React.createElement("div",{id:"pull-with-github",className:"wizard-section"},"You can add files with any of our ",React.createElement("a",{href:"/help/plugins"},"editor plugins"),"."),React.createElement("div",{id:"pull-with-github",className:"wizard-section"},"You can also ",React.createElement("a",{href:"/import/github"},"create workspaces from your repositories on GitHub"),".")));},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close")));}});function show(){modal.showModal(AddFilesView,{repoURL:repoURL,repoType:repoType});}
function init(repoInfo){console.log("addfiles init",repoInfo);editorAction.on(editorAction.UPLOAD,show);if(repoInfo.hasOwnProperty("type")){repoType=repoInfo.type;}
if(repoInfo.hasOwnProperty("url")){repoURL=repoInfo.url;}}
module.exports={show:show,init:init,};},function(module,exports,__webpack_require__){"use strict";var EditorSettingsView,modal=__webpack_require__(42),editorAction=__webpack_require__(5);EditorSettingsView=React.createClass({displayName:"EditorSettingsView",mixins:[modal.ReactModalMixin],getInitialState:function(){return{softTabs:_.isNull(localStorage.getItem("softTabs"))?true:localStorage.getItem("softTabs")=="true",tabSize:localStorage.getItem("tabSize")||2,};},handleSoftTabs:function(){localStorage.setItem("softTabs",""+this.refs.softTabs.getDOMNode().checked);editorAction.tab_settings_change();},handleTabSize:function(){localStorage.setItem("tabSize",this.refs.tabSize.getDOMNode().value);editorAction.tab_settings_change();},renderHeader:function(){return(React.createElement("strong",null,"Editor Settings"));},renderBody:function(){console.log("rendering",this.state.softTabs);return(React.createElement("div",{id:"add-content-wizard",className:"workspace-wizard"},React.createElement("div",{className:"editor-settings-container"},React.createElement("div",{className:"row"},React.createElement("label",null,React.createElement("span",{className:"col-md-6 settings-label"},"Soft Tabs"),React.createElement("span",{className:"col-md-6"},React.createElement("input",{ref:"softTabs",type:"checkbox",name:"soft_tabs",defaultChecked:this.state.softTabs,onChange:this.handleSoftTabs})))),React.createElement("div",{className:"row"},React.createElement("label",null,React.createElement("span",{className:"col-md-6 settings-label"},"Tab Size"),React.createElement("span",{className:"col-md-6"},React.createElement("input",{ref:"tabSize",type:"text",name:"tab_size",defaultValue:this.state.tabSize,onChange:this.handleTabSize})))))));},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close")));}});function show(){modal.showModal(EditorSettingsView,{});}
function init(){editorAction.on(editorAction.EDITOR_SETTINGS,show);}
module.exports={show:show,init:init,};},function(module,exports,__webpack_require__){"use strict";var EditPermissionsView,owner,workspace,handlerAction=__webpack_require__(12),flio=__webpack_require__(39),types=["admin_room","edit_room","request_perms","view_room"],modal=__webpack_require__(42);EditPermissionsView=React.createClass({displayName:"EditPermissionsView",mixins:[modal.ReactModalMixin],permissions:null,getInitialState:function(){return{secret:null,usernames:[],perms:[],selectedIndex:-1,newUser:null,anonUser:null,};},componentWillMount:function(){this.loadData();},loadData:function(){$.get(flio.apiURL("room",owner,workspace),function(data){var anonUser,perms=[];if(!this.isMounted()){return;}
_.map(data.perms,function(permissions,username){var user={id:username,permissions:permissions,};if(username==="AnonymousUser"){anonUser=user;}else{perms.push(user);}});if(this.refs.editAutocomplete){this.refs.editAutocomplete.getDOMNode().value="";this.refs.new_admin_room.getDOMNode().checked=false;this.refs.new_edit_room.getDOMNode().checked=false;this.refs.new_request_perms.getDOMNode().checked=false;this.refs.new_view_room.getDOMNode().checked=false;}
this.setState({selectedIndex:-1,usernames:[],newUser:null,secret:data.secret,perms:perms,anonUser:anonUser});}.bind(this));},componentDidUpdate:function(prevProps,prevState){var selected,el;selected=this.refs.selected;if(selected){el=selected.getDOMNode();if(_.isFunction(el.scrollIntoViewIfNeeded)){el.scrollIntoViewIfNeeded();}else{el.scrollIntoView();}}},save:function(){var data={perms:{},secret:this.refs.isSecret.getDOMNode().checked,name:workspace,owner:owner,};this.state.perms.forEach(function(user,index){data.perms[user.id]=types.filter(function(type){return this.refs[""+index+type].getDOMNode().checked;},this);},this);if(this.state.newUser){data.perms[this.state.newUser.user]=types.filter(function(type){return this.refs["new_"+type].getDOMNode().checked;},this);}
data.perms.AnonymousUser=types.filter(function(type){if(type==="admin_room"){return false;}
return this.refs["anon_"+type].getDOMNode().checked;},this);$.ajax({type:"put",url:"/api/workspace/"+data.owner+"/"+data.name,contentType:'application/json',data:JSON.stringify(data),success:_.bind(function(){console.log("success saving permission data",arguments);this.loadData();this.close();},this),error:function(){console.log("error saving permission data");}});},addSelectedUserFromLi_:function(index){this.addSelectedUser_(index);},addSelectedUser:function(){if(this.state.selectedIndex<0){this.setState({usernames:[]});return;}
this.addSelectedUser_(this.state.selectedIndex);},addSelectedUser_:function(index){var newUser;newUser=this.state.usernames[index];if(!newUser){this.setState({newUser:null,usernames:[],selectedIndex:-1});return;}
this.refs.editAutocomplete.getDOMNode().value=newUser.user;this.setState({newUser:newUser,usernames:[],selectedIndex:-1});this.refs.new_admin_room.getDOMNode().focus();},preAutoComplete_:function(event){var tab;tab=9;if(event.keyCode===tab&&!event.shiftKey){event.preventDefault();return;}},autoComplete_:function(event){var keyCode,down,up,tab,enter,selectedIndex;up=38;down=40;tab=9;enter=13;keyCode=event.keyCode;switch(keyCode){case down:selectedIndex=this.state.selectedIndex+1;if(selectedIndex>=this.state.usernames.length){selectedIndex=0;}
this.setState({selectedIndex:selectedIndex});break;case up:selectedIndex=this.state.selectedIndex-1;if(selectedIndex<0){selectedIndex=this.state.usernames.length-1;}
this.setState({selectedIndex:selectedIndex});break;case enter:case tab:this.addSelectedUser();break;default:this.fetchAutoComplete_();break;}},fetchAutoComplete_:function(){var value,input=this.refs.editAutocomplete.getDOMNode();value=input.value||"";value=value.trim();if(!value){this.setState({newUser:null,usernames:[],selectedIndex:-1});input.value="";return;}
$.get("/autocomplete/json_username/"+value,function(users){if(!(users&&users.length&&this.isMounted())){return;}
this.setState({"usernames":users,selectedIndex:0});}.bind(this)).error(function(){if(!this.isMounted()){return;}
this.setState({"usernames":[],selectedIndex:-1});}.bind(this));},handlePermissionChange_:function(type,index){var checked,refKey,permIndex=types.indexOf(type);refKey=""+index+type;checked=this.refs[refKey].getDOMNode().checked;types.forEach(function(type,currentIndex){if(index==="anon_"&&type==="admin_room"){return;}
refKey=""+index+type;if(checked&&currentIndex>permIndex){this.refs[refKey].getDOMNode().checked=true;}else if(!checked&&currentIndex<permIndex){this.refs[refKey].getDOMNode().checked=false;}},this);},getInput:function(index,user,type){var labels={"admin_room":"Admin","edit_room":"Edit","request_perms":"Request permissions","view_room":"View",};return(React.createElement("td",{key:index+type},React.createElement("label",null,labels[type]," ",React.createElement("input",{type:"checkbox",className:"perm-cb",onChange:this.handlePermissionChange_.bind(this,type,index),defaultChecked:user&&user.permissions.indexOf(type)!==-1,ref:index+type}))));},renderBody:function(){var users,anonUser,usernames,newInputs,anonInputs;if(this.state.secret===null){return(React.createElement("p",null,"Loading"));}
anonUser=this.state.anonUser;users=this.state.perms.map(function(user,index){var inputs=types.map(function(type){return this.getInput(index,user,type);},this);return(React.createElement("tr",{key:user.id},React.createElement("td",{className:"user-with-perms"},user.id),inputs));},this);usernames=this.state.usernames.map(function(user,index){return(React.createElement("li",{key:user.user+index,onClick:this.addSelectedUserFromLi_.bind(this,index),ref:this.state.selectedIndex===index?"selected":("notSelected"+index),className:this.state.selectedIndex===index?"selected":""},React.createElement("img",{style:{height:30,width:30},src:"https://secure.gravatar.com/avatar/"+user.email_hash}),React.createElement("span",{className:"username"},user.user)));},this);newInputs=types.map(this.getInput.bind(this,"new_",null));anonInputs=types.filter(function(type){return type!=="admin_room";}).map(this.getInput.bind(this,"anon_",anonUser));return(React.createElement("div",{id:"edit-perms-content-wizard",className:"workspace-wizard"},React.createElement("p",{className:"wizard-section no-content"},React.createElement("strong",null,"Edit Permissions for this Workspace")),React.createElement("div",{id:"secret-content",className:"wizard-section"},React.createElement("label",null,"This workspace is secret ",React.createElement("input",{type:"checkbox",id:"secret-workspace",ref:"isSecret",defaultChecked:this.state.secret})),React.createElement("br",null),React.createElement("small",null,"Secret workspaces are unlisted. They count towards private workspaces.")),anonUser&&React.createElement("div",{id:"all-perms-content",className:"wizard-section"},"Everyone can:",React.createElement("div",{className:"everyone-can"},React.createElement("table",null,React.createElement("tr",null,anonInputs)))),React.createElement("div",{id:"user-perms-content",className:"wizard-section"},React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"User"),React.createElement("th",{colSpan:"4"},"Permissions"))),React.createElement("tbody",null,users,React.createElement("tr",null,React.createElement("td",null,React.createElement("input",{type:"text",ref:"editAutocomplete",className:"edit-autocomplete autocomplete",onKeyDown:this.preAutoComplete_,onKeyUp:this.autoComplete_}),React.createElement("div",{className:"autocomplete-content",style:{display:(usernames.length?"block":"none")}},React.createElement("div",{ref:"autoCompleteResults",className:"edit-perms-autocomplete-results"},React.createElement("ul",{className:"autocomplete_results"},usernames)))),newInputs))))));},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-default btn-danger",onClick:this.save},"Save"),React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close")));}});function show(){modal.showModal(EditPermissionsView);}
function init(owner_,workspace_){owner=owner_;workspace=workspace_;handlerAction.on(handlerAction.EDIT_PERMISSIONS,show);}
module.exports={init:init,};},function(module,exports,__webpack_require__){"use strict";var SolicitationButton,SolicitationView,actions,Socket=__webpack_require__(25),selector=__webpack_require__(54),flux=__webpack_require__(11),WorkerActions=__webpack_require__(24),tags=[],SOLICIT_STATES,SOLICIT_STATES_REVERSE;SOLICIT_STATES={CREATE:1,BID:2,CANCEL:3,HIRE:4,ABSOLVE:5,COMPLETE:6,};SOLICIT_STATES_REVERSE=_.invert(SOLICIT_STATES);actions=new(flux.createActions({toggle:function(){return;}}))();SolicitationButton=React.createClass({displayName:"SolicitationButton",onClick_:function(){actions.toggle();},render:function(){return(React.createElement("button",{className:"btn btn-xs btn-primary",onClick:this.onClick_},"Hire help"));}});SolicitationView=React.createClass({displayName:"SolicitationView",height:250,getInitialState:function(){return{contractor:null,start:null,solicitID:null,solicitState:SOLICIT_STATES.CREATE,selectedTags:[],tags:tags,};},componentDidMount:function(){actions.onTOGGLE(function(){var panel=this.props.panel;if(panel.size>0){panel.resize(0);}else{panel.resize(this.height);}},this);if(_.isEmpty(this.state.tags)){$.get("/api/tags",function(data){tags=data.map(function(tag){return selector.createItem(tag,tag);});this.setState({tags:tags});}.bind(this));}},worker:null,create_:function(event){var editor_settings,solicitID;event.preventDefault();if(this.worker){WorkerActions.send({name:"solicit",action:"hire"});return;}
this.worker=new Worker("/static/js/build/build.solicitation_worker.js");this.worker.onmessage=WorkerActions.message;WorkerActions.onSEND(function(m){if(!this.worker){return;}
this.worker.postMessage(m);},this);WorkerActions.onMESSAGE(function(m){var data=m.data;if(data.name!=="solicit"){return;}
if(data.action==="create"){this.setState({solicitID:data.id});return;}
if(data.id!==this.state.solicitID){return;}
switch(data.action){case"bid":this.setState({contractors:data.contractors});break;}},this);editor_settings=_.clone(fl.editor_settings);delete editor_settings.room_owner;delete editor_settings.room;editor_settings.path="Pro";Socket.onJOIN(function(d){if(d.username===this.contractor){this.props.panel.resize(50);}},this);WorkerActions.send({name:"init",editor_settings:editor_settings,preferred_contractor:this.refs.preferred_contractor.getDOMNode().value,description:this.refs.description.getDOMNode().value,path:fl.editor_settings.path,});this.setState({solicitState:SOLICIT_STATES.BID});},cancel_:function(){WorkerActions.send({name:"solicit",action:"cancel",id:this.state.solicitID,});this.setState({solicitState:SOLICIT_STATES.CANCEL});},hire_:function(username){this.contractor=username;WorkerActions.send({name:"solicit",action:"hire",id:this.state.solicitID,username:username,});this.setState({solicitState:SOLICIT_STATES.HIRE});},absolve_:function(){WorkerActions.send({name:"solicit",action:"absolve",id:this.state.solicitID,});this.setState({solicitState:SOLICIT_STATES.ABSOLVE});},complete_:function(){WorkerActions.send({name:"solicit",action:"complete",id:this.state.solicitID,});this.setState({solicitState:SOLICIT_STATES.COMPLETE});},feedback_:function(event){event.preventDefault();WorkerActions.send({name:"solicit",action:"feedback",id:this.state.solicitID,rating:3,for_user:this.contractor,text:this.refs.feedback.getDOMNode().value.trim()});this.setState(this.getInitialState());},handleTagRemove:function(item){var newTags=_.filter(this.state.selectedTags,function(tag){return tag.displayName!==item.displayName;});this.setState({"selectedTags":newTags});},handleTagSelect:function(item){if(!_.isEmpty(_.filter(this.state.selectedTags,function(tag){return item.displayName===tag.displayName;}))){return;}
this.setState({"selectedTags":this.state.selectedTags.concat([item])});},render_create:function(){return(React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("h3",null,"Request a Pro"),React.createElement("p",null,"If you continue, someone will come help you for $80/hour with whatever you want. You can cancel in the first 5 minutes and pay nothing.",React.createElement("a",{target:"_blank",href:"/help/pro"},"More info"))),React.createElement("div",{className:"row"},React.createElement(selector.Selector,{selectDisplay:"Select a tag...",items:this.state.tags,handleSelect:this.handleTagSelect}),React.createElement(selector.List,{items:this.state.selectedTags,handleRemove:this.handleTagRemove}),React.createElement("fieldset",null,React.createElement("div",{className:"col-md-5"},React.createElement("label",{htmlFor:"id_description"},"Description"),React.createElement("br",null),React.createElement("textarea",{ref:"description",cols:"60",id:"id_description",name:"description",rows:"2"})),React.createElement("div",{className:"col-md-3"},React.createElement("label",{htmlFor:"id_preferred_contractor"},"Preferred Pro"),React.createElement("br",null),React.createElement("select",{id:"id_preferred_contractor",ref:"preferred_contractor",name:"preferred_contractor",defaultValue:""},React.createElement("option",{value:""},"Anybody"),React.createElement("option",{value:"ggreer"},"ggreer"),React.createElement("option",{value:"bjorn"},"bjorn"),React.createElement("option",{value:"kansface"},"kansface"))),React.createElement("div",{className:"col-md-3"},React.createElement("br",null),React.createElement("button",{type:"button",className:"btn btn-default",onClick:this.cancel_},"Cancel"),React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.create_},"Request a Pro"))))));},render_bid:function(){return(React.createElement("div",{className:"row"},_.map(this.state.contractors,function(user,username){return(React.createElement("div",{key:user.id},React.createElement("span",null,username),React.createElement("button",{className:"btn btn-primary",onClick:this.hire_.bind(this,username)},"Hire")));},this),React.createElement("button",{className:"btn btn-primary",onClick:this.cancel_},"Cancel")));},render_cancel:function(){return(React.createElement("div",{className:"row"},React.createElement("p",null,"OMG CANCELED")));},render_hire:function(){return(React.createElement("div",{className:"row"},React.createElement("button",{className:"btn btn-danger",onClick:this.absolve_},"Cancel"),React.createElement("button",{className:"btn btn-success",onClick:this.complete_},"Finish")));},render_absolve:function(){return(React.createElement("div",{className:"row"},React.createElement("p",null,"OMG ABSOLVE")));},render_complete:function(){return(React.createElement("div",{className:"row"},React.createElement("fieldset",null,React.createElement("div",{className:"col-md-5"},React.createElement("label",{htmlFor:"id_feedback"},"Description"),React.createElement("br",null),React.createElement("textarea",{ref:"feedback",cols:"60",id:"id_feedback",name:"description",rows:"3"})),React.createElement("div",{className:"col-md-3"},React.createElement("br",null),React.createElement("button",{type:"button",className:"btn btn-default",onClick:this.close_},"Cancel"),React.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.feedback_},"FeedBAKKCK")))));},render:function(){var f=this["render_"+SOLICIT_STATES_REVERSE[this.state.solicitState].toLowerCase()];if(!_.isFunction(f)){return(React.createElement("div",null,"oh shit"));}
return(React.createElement("div",{className:"container"},f.call(this)));},});module.exports={SolicitationButton:SolicitationButton,SolicitationView:SolicitationView,};},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(11),Actions,can_share_screen=false,Modal=__webpack_require__(42),editorAction=__webpack_require__(5),messageAction=__webpack_require__(2),perms=__webpack_require__(16),prefs=__webpack_require__(17);Actions=flux.createActions({start_video_chat:function(connId){if(prefs.dnd){editorAction.pref("dnd",false);messageAction.info("Do not disturb disabled.");}
if(perms.indexOf("patch")===-1){messageAction.info("You need edit permissions to video chat.");return new Error("No permission to video chat.");}
if(prefs.audioOnly){this.start_audio_chat(connId);return new Error("Starting audio chat.");}
return connId;},stop_video_chat:function(connId){if(prefs.audioOnly){this.stop_audio_chat(connId);return new Error("Stopping audio chat.");}
return connId;},start_audio_chat:function(connId){return connId;},stop_audio_chat:function(connId){return connId;},start_screen:function(connId){var errMsg;if(can_share_screen){if(prefs.dnd){editorAction.pref("dnd",false);messageAction.info("Do not disturb disabled.");}
return connId;}
if(!self.chrome||!chrome.app){errMsg="Screen sharing requires Google Chrome and the Floobits screen sharing extension.";Modal.showWithText(errMsg,"Can't Share Screen");messageAction.warn(errMsg);return new Error(errMsg);}
try{chrome.webstore.install("https://chrome.google.com/webstore/detail/lmojaknpofhmdnbpanagbbeinbjmbodo",function(){self.location.reload();});}catch(e){self.open("https://chrome.google.com/webstore/detail/lmojaknpofhmdnbpanagbbeinbjmbodo");}
return new Error("User may install extension");},stop_screen:function(connId){return connId;},can_share_screen:function(can){can_share_screen=can;return can;},});module.exports=new Actions();},function(module,exports,__webpack_require__){function apiURL(parts){var url;parts=_.toArray(arguments);url=[window.location.protocol,"//",window.location.host,"/api/"].join("");url=url+parts.join("/");return url;}
module.exports={apiURL:apiURL};},function(module,exports,__webpack_require__){"use strict";var ButtonModel,Buttons,flux=__webpack_require__(11);ButtonModel=flux.createModel({modelName:"Button",fieldTypes:{name:flux.FieldTypes.string,action:flux.FieldTypes.func,classNames:flux.FieldTypes.arrayOf(flux.FieldTypes.string),},getDefaultFields:function(){return{action:function(){return;},classNames:[],};}});Buttons=flux.createCollection({modelName:"Buttons",model:ButtonModel,});module.exports={Button:ButtonModel,Buttons:Buttons,};},function(module,exports,__webpack_require__){"use strict";var Message,Messages,LEVEL,LEVEL_TO_STRING={},id=0,flux=__webpack_require__(11),util=__webpack_require__(43);LEVEL={INFO:0,SUCCESS:1,WARNING:2,ERROR:3,};_.each(LEVEL,function(v,k){LEVEL_TO_STRING[v]=k.toLowerCase();});Message=flux.createModel({modelName:"Message",fieldTypes:{id:flux.FieldTypes.number,username:flux.FieldTypes.string,msg:flux.FieldTypes.string,type:flux.FieldTypes.string,level:flux.FieldTypes.number,time:flux.FieldTypes.number,buttons:flux.FieldTypes.collection,},getDefaultFields:function(){return{id:++id,time:Date.now()};},});Object.defineProperty(Message.prototype,"levelName",{get:function(){return LEVEL_TO_STRING[this.level];}});Object.defineProperty(Message.prototype,"prettyTime",{get:function(){var d=util.formatDate(new Date(this.time));return(d.hour+":"+d.minute+" "+d.meridian);}});Messages=flux.createCollection({modelName:"Messages",model:Message,didUpdate:function(){this.splice(1000);}});module.exports={LEVEL:LEVEL,Message:Message,Messages:Messages,};},function(module,exports,__webpack_require__){var ReactModalView,ReactModalUnsafeView,ReactModalMixin,el,id=0;function killModal(){React.unmountComponentAtNode(el);}
function showModal(component,args){el=document.createElement("div");el.id="modal-id-"+(++id);document.body.appendChild(el);React.render(React.createElement(component,args),el);}
ReactModalMixin={componentDidMount:function(){if(el&&el.id!==this.getDOMNode().parentNode.id){killModal();}
if(!el){el=this.getDOMNode().parentNode;}
$(this.refs.modal.getDOMNode()).modal('show').on('hide.bs.modal',this.close);},close:function(){if(this.isMounted()){killModal();}else{console.log("componenent isn't mounted. no-op");}},componentWillUnmount:function(){var node;node=$(this.refs.modal.getDOMNode());node.off('hide.bs.modal');node.modal('hide');el=null;},render:function(){return(React.createElement("div",{className:"modal",ref:"modal"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},this.props.title||(this.renderHeader&&this.renderHeader())),React.createElement("div",{className:"modal-body"},this.renderBody()),React.createElement("div",{className:"modal-footer"},this.renderFooter())))));}};ReactModalView=React.createClass({displayName:"ReactModalView",mixins:[ReactModalMixin],renderBody:function(){return(React.createElement("p",null,this.props.body));},renderFooter:function(){return(React.createElement("button",{className:"btn btn-primary","aria-hidden":"true","data-dismiss":"modal"},"OK"));}});ReactModalUnsafeView=React.createClass({displayName:"ReactModalUnsafeView",mixins:[ReactModalMixin],renderBody:function(){return(React.createElement("p",{dangerouslySetInnerHTML:{__html:this.props.body}}));},renderFooter:function(){return(React.createElement("button",{className:"btn btn-primary","aria-hidden":"true","data-dismiss":"modal"},"OK"));}});function showWithText(text,title){return showModal(ReactModalView,{body:text,title:title||""});}
function showWithUnsafeHTML(html,title){return showModal(ReactModalUnsafeView,{body:html,title:title||""});}
module.exports={showModal:showModal,showWithText:showWithText,showWithUnsafeHTML:showWithUnsafeHTML,ReactModalMixin:ReactModalMixin,killModal:killModal};},function(module,exports,__webpack_require__){util={};var extensions_to_mime={"bmp":"bmp","cgm":"cgm","g3":"g3fax","gif":"gif","ief":"ief","jp2":"jp2","jpeg":"jpeg","jpg":"jpeg","jpe":"jpeg","pict":"pict","pic":"pict","pct":"pict","png":"png","btif":"prs.btif","svg":"svg+xml","svgz":"svg+xml","tiff":"tiff","tif":"tiff","psd":"vnd.adobe.photoshop","djvu":"vnd.djvu",'djv':"vnd.djvu","dwg":"vnd.dwg","dxf":"vnd.dxf","fbs":"vnd.fastbidsheet","fpx":"vnd.fpx","fst":"vnd.fst","mmr":"vnd.fujixerox.edmics-mmr","rlc":"vnd.fujixerox.edmics-rlc","mdi":"vnd.ms-modi","npx":"vnd.net-fpx","wbmp":"vnd.wap.wbmp","xif":"vnd.xiff","ras":"x-cmu-raster","cmx":"x-cmx","ico":"x-icon","pntg":"x-macpaint","pnt":"x-macpaint","mac":"x-macpaint","pcx":"x-pcx","pnm":"x-portable-anymap","pbm":"x-portable-bitmap","pgm":"x-portable-graymap","ppm":"x-portable-pixmap","qtif":"x-quicktime","qti":"x-quicktime","rgb":"x-rgb","xbm":"x-xbitmap","xpm":"x-xpixmap","xwd":"x-xwindowdump"};var highlightColors=["lime","black","blue","darkblue","fuchsia","gray","green","greenyellow","indigo","magenta","midnightblue","maroon","orange","orangered","purple","red","teal","yellow"];util.userColor=function(username){var i=_.reduce(util.md5(username),function(memo,c){return memo+c.charCodeAt(0);},0);return highlightColors[i%highlightColors.length];};util.css_escape=function(css){var escaped=Base64.encode(css).replace(/\=/g,'');return escaped;};util.image_mime_from_extension=function(name){var extension=name.split(".").slice(-1);try{extension=extension[0].toLowerCase();return extensions_to_mime[extension];}catch(e){console.log("image_mime_from_extension:",e);}
return null;};util.is_binary=function(bytes,size){var i,max_bytes=1024,suspicious_bytes=0,total_bytes;if(size===0){return false;}
total_bytes=Math.min(size,max_bytes);if(size>=3&&bytes[0]===0xEF&&bytes[1]===0xBB&&bytes[2]===0xBF){return false;}
for(i=0;i<total_bytes;i++){if(bytes[i]===0){return true;}
if((bytes[i]<7||bytes[i]>14)&&(bytes[i]<32||bytes[i]>127)){if(bytes[i]>191&&bytes[i]<224&&i+1<total_bytes){i++;if(bytes[i]<192){continue;}}else if(bytes[i]>223&&bytes[i]<239&&i+2<total_bytes){i++;if(bytes[i]<192&&bytes[i+1]<192){i++;continue;}}
suspicious_bytes++;if(i>32&&(suspicious_bytes*100)/total_bytes>10){return true;}}}
if((suspicious_bytes*100)/total_bytes>10){return true;}
return false;};util.md5=function(data){if(!_.isString(data)){data=CryptoJS.lib.WordArray.create(data);}
return CryptoJS.MD5(data).toString(CryptoJS.enc.Hex);};util.padNum=function(padNum){var n;n=padNum.toString(10);if(n.length<2){return"0"+n;}
return n;};util.formatDate=function(date){var months,month,day,hour,h,minute,second,formatted,type,year,oneyear,oneminute,alongtimeago,ashortimeago;months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];oneminute=1000*60;oneyear=oneminute*60*60*24*365;month=months[date.getMonth()];h=date.getHours();year=date.getFullYear();hour=util.padNum(h);day=util.padNum(date.getDate());minute=util.padNum(date.getMinutes());second=util.padNum(date.getSeconds());alongtimeago=date.getTime()<(new Date().getTime()-oneyear);ashortimeago=date.getTime()>(new Date().getTime()-(oneminute*3));formatted=[month," ",(alongtimeago?year+" ":""),day," ",hour,":",minute,(ashortimeago?":"+second:"")," ",type].join("");return{date:date,formatted:formatted,month:month,day:day,hour:hour,minute:minute,second:second,type:type,year:year,alongtimeago:alongtimeago,ashortimeago:ashortimeago,meridian:h<12?"AM":"PM",};};var LANGS={apab:["apab"],asciidoc:["asciidoc"],applescript:["AppleScript","scpt"],c_cpp:["c","cc","cpp","cxx","h","hh","hpp","p","pwn"],clojure:["clj","cljs"],coffee:["Cakefile","coffee","cf","cson"],coldfusion:["cfm"],csharp:["cs"],css:["css"],curly:["curly"],dart:["dart"],diff:["diff","patch"],dot:["dot"],glsl:["frag","glsl","vert"],golang:["go"],groovy:["groovy"],haml:["haml","hml"],haskell:["hs"],haxe:["hx"],html:["htm","html","xhtml"],jade:["jade"],java:["java","pde"],javascript:["js"],json:["json"],jsp:["jsp"],jsx:["jsx"],latex:["latex","tex","ltx","bib"],less:["less"],liquid:["liquid"],lisp:["el","lisp"],lua:["lua"],luapage:["lp"],makefile:["Makefile","make"],markdown:["md","markdown"],objectivec:["m","mm"],ocaml:["ml","mli"],pascal:["pas","pascal"],perl:["pl","pm"],pgsql:["pgsql","psql"],php:["php","phtml"],powershell:["ps1"],python:["py"],r:["r"],rdoc:["rd","rdoc"],rhtml:["rhtml"],ruby:["ru","gemspec","rake","rb"],sass:["sass"],scad:["scad"],scala:["scala"],scss:["scss"],sh:["sh","bash","bat"],sql:["sql"],stylus:["styl","stylus"],svg:["svg"],tcl:["tcl"],tex:["tex"],text:["txt"],textile:["textile"],tm_snippet:["tmSnippet"],toml:["toml"],typescript:["str","ts","typescript"],vala:["vala","vapi"],vbscript:["vbs","vbe","wsf","wsc"],xml:["xml","rdf","rss","wsdl","xslt","atom","mathml","mml","xul","xbl"],xquery:["xq"],yaml:["yaml"]};util.modeForFile=function(path){var mode,parts,extension;mode="text";parts=path.split(".");if(parts.length>1){extension=_.last(parts);if(extension==="erb"&&parts.length>2){parts.pop();extension=_.last(parts);}
extension=extension.toLowerCase();_.each(LANGS,function(extensions,lang){if(_.contains(extensions,extension)){mode=lang;}});}
console.log("setting mode to",mode);return mode;};if(typeof Uint8ClampedArray!=="undefined"){util.Uint8ClampedArray=Uint8ClampedArray;}else if(typeof Uint8Array!=="undefined"){util.Uint8ClampedArray=Uint8Array;}else{util.Uint8ClampedArray=null;}
util.requestFullscreen=function(elem){if(elem.requestFullscreen){elem.requestFullscreen();}else if(elem.msRequestFullscreen){elem.msRequestFullscreen();}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen();}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen();}};util.exitFullscreen=function(){if(document.exitFullscreen){document.exitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}};util.getFullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;};module.exports=util;},function(module,exports,__webpack_require__){"use strict";var Socket=__webpack_require__(25),BaseHandler=__webpack_require__(49),messageAction=__webpack_require__(2);function Handler(apiKey,apiSecret,username,uri,isHangout){BaseHandler.call(this);this.apiKey_=apiKey;this.apiSecret_=apiSecret;this.username_=username;this.socketURI_=uri;this.isHangout_=isHangout;this.owner_="";this.workspace_="";this.path_="";}
Handler.prototype=Object.create(BaseHandler.prototype);Handler.prototype.constructor=Handler;_.assign(Handler.prototype,{__VERSION__:"0.11",on_error:function(data){console.error("error data",data.msg);messageAction.error(data.msg);messageAction.modal(data.msg);},on_disconnect:function(data){var msg=data&&data.reason;messageAction.warn(msg||"Disconnected from workspace");if(!msg){return;}
messageAction.modal(msg);Socket.disconnect();},go:function(owner,workspace,path){this.owner_=owner;this.workspace_=workspace;this.path_=path;console.log("connection connecting",owner,workspace,path);Socket.connect(this.socketURI_);},on_sio_connect:function(){console.log("connection auth",this.path_,this.workspace_,this.owner_);Socket.auth({"username":this.username_,"api_key":this.apiKey_,"secret":this.apiSecret_,"path":this.path_,"platform":this.platform(),"client":this.client(),"supported_encodings":["utf8","base64"],"version":this.__VERSION__});},platform:function(){if(navigator.appVersion.indexOf("Win")!==-1){return"win32";}else if(navigator.appVersion.indexOf("Mac")!==-1){return"darwin";}else if(navigator.appVersion.indexOf("X11")!==-1){return"unix";}else if(navigator.appVersion.indexOf("Linux")!==-1){return"linux";}
return"unknown";},client:function(){return this.isHangout_?"web-hangout":"web";}});module.exports=Handler;},function(module,exports,__webpack_require__){"use strict";var routes,loadQuery;routes=[];loadQuery=self.location.search;function handleState(event){var path,found=false;event=event||{state:null};path=decodeURI(self.location.pathname);routes.forEach(function(route){if(route.path.test(path)){route.callbacks.forEach(function(cb){found=true;cb(path,event.state);});}});return found;}
self.onpopstate=handleState;module.exports=Object.create({},{addRoute:{value:function(path,callbacks){routes.push(Object.create({},{path:{value:path,},callbacks:{value:callbacks,},name:{value:name,}}));}},start:{value:handleState,},navigate:{value:function(path,state){path=encodeURI(path);try{history.pushState({state:state,path:path},"",(path+loadQuery));}catch(e){console.log("Push state error.",arguments,e);}}}});},function(module,exports,__webpack_require__){"use strict";var PermissionView,handlerAction=__webpack_require__(12),modal=__webpack_require__(42);PermissionView=React.createClass({displayName:"PermissionView",mixins:[modal.ReactModalMixin],getInitialState:function(){var permissions;permissions=this.props.user.permissions;return{admin_room:permissions.indexOf("kick")!==-1,view_room:permissions.indexOf("get_buf")!==-1,edit_room:permissions.indexOf("set_buf")!==-1,request_perms:permissions.indexOf("request_perms")!==-1,};},componentDidMount:function(){return;},renderField:function(label,name,description){return(React.createElement("div",{className:"field_wrapper",key:name},React.createElement("label",{htmlFor:"id_"+name},label),React.createElement("input",{onChange:_.bind(this.handleChange_,this,name),ref:name,id:"id_"+name,type:"checkbox",checked:this.state[name]}),React.createElement("div",null,React.createElement("small",{className:"text-info"},description))));},renderBody:function(){var fields=[["View","view_room","view files and terminals in this workspace"],["Request permissions","request_perms","ask admins for permission to edit files in this workspace"],["Edit","edit_room","edit files in this workspace"],["Administer","admin_room","set permissions and type in all terminals"],].map(function(perm){return this.renderField.apply(this,perm);},this);return(React.createElement("form",null,React.createElement("fieldset",null,fields)));},handleSubmit_:function(event){var newPerms;event.preventDefault();newPerms=["view_room","edit_room","request_perms","admin_room"].filter(function(perm){return this.state[perm];},this);handlerAction.update_perms(this.props.user.getConnectionID(),newPerms);this.close();},handleChange_:function(type,event){var index,permissions,state,checked;permissions=["view_room","request_perms","edit_room","admin_room"];checked=event.target.checked;index=permissions.indexOf(type);state={};permissions.forEach(function(perm,i){if(i<index&&checked){state[perm]=checked;}else if(i>index&&!checked){state[perm]=checked;}else if(i===index){state[perm]=checked;}else{state[perm]=this.state[perm];}},this);this.setState(state);},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close"),React.createElement("button",{className:"btn btn-success",onClick:this.handleSubmit_},"Save")));}});module.exports=PermissionView;},function(module,exports,__webpack_require__){"use strict";var PopoverMixin;PopoverMixin={timeout:null,setState_:function(state){if(!this.isMounted()){return;}
this.setState(state);},handleClick:function(event){console.log("clicking");if(this.state.showPopover){clearTimeout(this.timeout);this.setState_({showPopover:false});}else{this.handleMouseEnter(event);}},leave:function(){if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}
this.setState_({showPopover:false});},handleMouseEnter:function(event){this.setState_({showPopover:true});if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}},handleMouseLeave:function(event){var self=this;this.timeout=window.setTimeout(function(){self.leave();},300);},};module.exports={PopoverMixin:PopoverMixin};},function(module,exports,__webpack_require__){"use strict";window.AudioContext=window.AudioContext||window.webkitAudioContext;window.PannerNode=window.PannerNode||window.webkitAudioPannerNode;var prefs=__webpack_require__(17),semitone,root,majorScale,minorScale,chromatic,harmonicMinor,tempo,duration,analyseCurrentWait;semitone=1.0594545454545454;root=440;majorScale=[0,2,4,5,7,9,11,12];minorScale=[0,2,3,5,7,8,10,12];harmonicMinor=[0,2,3,5,7,9,11,12];chromatic=[0,1,2,3,4,5,6,7,8,9,10,11,12];tempo=0.1;duration={whole:tempo*4,half:tempo*2,quarter:tempo,eighth:tempo/2};analyseCurrentWait=0;function SoundEffects(){if(!window.AudioContext){return;}
try{this.context=new window.AudioContext();}catch(e){console.error("Unable to create AudioContext for sound effects. :( Exception:",e);return;}
try{this.gainNode=this.context.createGain();this.gainNode.gain.value=0.2;this.gainNode.connect(this.context.destination);}catch(e){console.log("Your browser can't createGain(). Things might be loud. :( Exception:",e);this.gainNode=this.context.destination;}
try{this.panner=this.context.createPanner();this.panner.panningModel=window.PannerNode.HRTF;this.panner.setPosition(0,1,1);this.panner.connect(this.gainNode);}catch(e){console.log("Your browser can't createPanner(). Things might sound weird. :( Exception:",e);this.panner=this.gainNode;}
this.waveform="square";this.scale=this.makeScale(harmonicMinor,220,15);console.log("sound effects initialized");}
SoundEffects.prototype.playNote=function(type,frequency,duration,offset){var osc;if(!this.context){return;}
if(!prefs.sound){console.debug("sound disabled. not playing",frequency,"for",duration);return;}
console.debug("playing",frequency,"for",duration);osc=this.context.createOscillator();offset=offset||0;osc.type=type;osc.frequency.value=frequency;osc.connect(this.panner);osc.start(this.context.currentTime+offset);osc.stop(this.context.currentTime+offset+duration);};SoundEffects.prototype.audioAnalyseTracker={};SoundEffects.prototype.makeScale=function(scale,root,len){var s,current,position;s=[];current=root;for(position=0;s.length<len;position++){if(_.contains(scale,position%12)){s.push(current);}
current=current*semitone;}
return s;};SoundEffects.prototype.join=function(username){var i,note;i=_.reduce(util.md5(username),function(memo,c){return memo+c.charCodeAt(0);},0);note=this.scale[i%_.size(this.scale)];this.playNote(this.waveform,this.scale[0],duration.quarter,0);this.playNote(this.waveform,note,duration.quarter,duration.quarter);};SoundEffects.prototype.leave=function(username){var i,note;i=_.reduce(util.md5(username),function(memo,c){return memo+c.charCodeAt(0);},0);note=this.scale[i%_.size(this.scale)];this.playNote(this.waveform,note,duration.quarter,0);this.playNote(this.waveform,this.scale[0],duration.quarter,duration.quarter);};module.exports=new SoundEffects();},function(module,exports,__webpack_require__){"use strict";var Socket=__webpack_require__(25);function BaseHandler(){Socket.on(_.bind(this.handle_,this));}
BaseHandler.prototype.handle_=function(name,data){var f;if(name===Socket.PING){return;}
f=this["on_"+name.toLowerCase()];if(!_.isFunction(f)){return;}
console.log(this.constructor.name,"handler handling",name,this[name]);f.call(this,data);};module.exports=BaseHandler;},function(module,exports,__webpack_require__){"use strict";var DeleteDirView,editorAction=__webpack_require__(5),modal=__webpack_require__(42);DeleteDirView=React.createClass({displayName:"DeleteDirView",mixins:[modal.ReactModalMixin],renderBody:function(){return(React.createElement("p",{className:"alert-block alert-DeleteDir"},("Are you sure you want to delete "+this.props.path+" and all its contents?")));},handleDelete:function(){this.close();this.deleteBuffers_(this.props.tree);},deleteBuffers_:function(tree){_.each(tree,function(leaf){if(_.isNumber(leaf)){editorAction.close(leaf);editorAction.delete_buf(leaf);}else{this.deleteBuffers_(leaf);}},this);},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-danger",onClick:this.handleDelete},"Delete Directory"),React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Cancel")));}});function show(path,tree){modal.showModal(DeleteDirView,{path:path,tree:tree,title:"Floobits DeleteDir"});}
module.exports={show:show};},function(module,exports,__webpack_require__){"use strict";var TerminalModalView,modal=__webpack_require__(42);TerminalModalView=React.createClass({displayName:"TerminalModalView",mixins:[modal.ReactModalMixin],renderBody:function(){var location=window.location,workspaceURL=location.protocol+"//"+location.hostname+"/"+fl.editor_settings.path;return(React.createElement("div",null,React.createElement("p",{className:"alert alert-block alert-warning"},"This workspace has no terminals."),React.createElement("div",{className:"alert alert-block alert-info"},React.createElement("div",null,"You can use ",React.createElement("a",{href:"https://github.com/Floobits/flootty/",target:"_blank"},"Flootty")," to share and join terminals. Its very useful for collaborative debugging."),React.createElement("div",null,"If you have Flootty installed, you can create a terminal in this workspace by running:"),React.createElement("div",null,React.createElement("textarea",{type:"text",className:"code-input",disabled:"disabled",style:{"font-size":"14px"},value:'flootty --create --url="'+workspaceURL+'"'})))));},renderFooter:function(){return(React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"OK")));}});function show(){modal.showModal(TerminalModalView,{title:"Floobits Terminals"});}
module.exports={show:show};},function(module,exports,__webpack_require__){var flux=__webpack_require__(11),Actions,actions;Actions=flux.createActions({resize:function(){return;}});actions=new Actions();window.addEventListener("resize",actions.resize);module.exports=actions;},function(module,exports,__webpack_require__){var IGNORE_FILES,HIDDEN_WHITELIST,MAX_FILESIZE,MAX_DIRSIZE;MAX_FILESIZE=10000000;MAX_DIRSIZE=MAX_FILESIZE*10;IGNORE_FILES=[".gitignore",".hgignore",".flignore",".flooignore"];HIDDEN_WHITELIST=IGNORE_FILES.concat(".floo");function Ignore(filetree,_path){console.log("Creating ignore",arguments);this.ignores={"/TOO_BIG/":[]};this.children={};this.filetree=filetree;this.path=_path;this.size=0;console.log("Initializing ignores for ",_path);_.each(IGNORE_FILES,_.bind(this.load,this));}
Ignore.prototype.recurse=function(){_.each(this.filetree.contents,function(item){var ignore;if(item.isDir){ignore=new Ignore(item,this.path+item.name);ignore.recurse();this.size+=ignore.size;this.children[item.name]=ignore;return;}
console.log("ignore file",item,item.file,this.filetree);this.size+=item.file.size;if(item.file.size>MAX_FILESIZE){this.ignores["/TOO_BIG/"].push(item.fullpath);}},this);if(this.size>MAX_DIRSIZE){this.ignores["/TOO_BIG/"].push(this.path);}};Ignore.prototype.load=function(ignoreFilename){var ignores,ignoreFile;ignoreFile=this.filetree.contents[ignoreFilename];if(!ignoreFile){return;}
ignores=ignoreFile.buf.split("\n");this.ignores[ignoreFile.name]=[];_.each(ignores,function(ignore){ignore=ignore.trim();if(ignore.length===0||ignore[0]==="#"){return;}
console.log("Adding %s to ignore patterns",ignore);this.ignores[ignoreFile.name].push(ignore);},this);};Ignore.prototype.isIgnored=function(treeitem){var parts,path,i,j,keys,ignoreFile,patterns,basePath,filename,pattern,newPath,ignore,visited;keys=_.keys(this.ignores);path=treeitem.fullpath;parts=path.split("/");parts.pop();basePath=parts.join("/");filename=treeitem.name;if(filename[0]==="."){console.log("Ignore hidden file or directory.");return true;}
console.log("ignore keys checked",keys,this.ignores);for(i=0;i<keys.length;i++){ignoreFile=keys[i];patterns=this.ignores[ignoreFile];console.log("ignore patterns",patterns,ignoreFile);for(j=0;j<patterns.length;j++){pattern=patterns[j];console.log("ignore checking",filename,"against",pattern);if(pattern.length&&_.last(pattern)==="/"&&treeitem.isDir){pattern=pattern.substr(0,pattern.length-1);}
if(pattern.length&&pattern[0]==="/"){if(basePath===this.path&&minimatch(filename,pattern.slice(1))){console.log("Ignored item on /",filename,pattern);return true;}}else if(minimatch(filename,pattern)||minimatch(path,pattern)){console.log("Ignored item",filename,pattern);return true;}}}
parts=path.split("/");visited=this.path.split("/");while(true){if(_.isEmpty(parts)){return false;}
newPath=parts.shift();if(visited.shift()===newPath){continue;}
break;}
if(_.isEmpty(newPath)){return false;}
ignore=this.children[newPath];if(ignore){return ignore.isIgnored(treeitem);}
return false;};function buildIgnores(filetree){var ignore;ignore=new Ignore(filetree,"");ignore.recurse();return ignore;}
module.exports={buildIgnores:buildIgnores,HIDDEN_WHITELIST:HIDDEN_WHITELIST,MAX_FILESIZE:MAX_FILESIZE,MAX_DIRSIZE:MAX_DIRSIZE,TOTAL_MAXSIZE:0,Ignore:Ignore};},function(module,exports,__webpack_require__){"use strict";var upArrowKeyCode=38;var downArrowKeyCode=40;var enterKey=13;var tabKey=9;var allowedKeys=[enterKey,upArrowKeyCode,downArrowKeyCode,tabKey];var Selector=React.createClass({displayName:"Selector",getInitialState:function(){return{focused:false,filteredItems:this.props.items,selected:null,};},componentWillReceiveProps:function(props){this.filter(props.items);},handleSelect:function(item){this.props.handleSelect(item);this.refs.filter.getDOMNode().blur();this.setState({focused:false});},handleKeyDown:function(event){var kc=event.which;if(allowedKeys.indexOf(kc)==-1){return;}
event.preventDefault();event.stopPropagation();if(_.isEmpty(this.state.filteredItems)){return;}
var current=this.state.selected;if(!current){current=this.state.filteredItems[0];}
if(kc===enterKey){this.handleSelect(current);return;}
if(kc===tabKey){this.props.handleSelect(current);this.refs.filter.getDOMNode().value="";return;}
if(this.state.filteredItems.length===1){this.setState({"selected":current});return;}
var index=this.state.filteredItems.indexOf(current);if(kc===upArrowKeyCode){index--;if(index<0){index=this.state.filteredItems.length-1;}}else{index++;}
if(index>=this.state.filteredItems.length){index=0;}
this.setState({"selected":this.state.filteredItems[index]});},handleKeyUp:function(event){var kc=event.which;if(allowedKeys.indexOf(kc)!==-1){return;}
this.filter();},filter:function(optItems){var val=this.refs.filter.getDOMNode().value;var items=optItems||this.props.items;if(!val.length){this.setState({"filteredItems":items});}
var filteredItems=items.filter(function(item){return item.displayName.indexOf(val)===0;});if(_.isEmpty(filteredItems)){this.setState({"filteredItems":[],"selected":null});return;}
this.setState({"filteredItems":filteredItems,"selected":filteredItems[0],});},onFocus:function(){this.setState({"focused":true});this.refs.filter.getDOMNode().focus();},onBlur:function(){_.delay(function(){if(this.state.focused){this.setState({"focused":false});}}.bind(this),150);},componentDidUpdate:function(){var el=$(".selected-item",this.getDOMNode()).get(0);if(!el){return;}
if(_.isFunction(el.scrollIntoViewIfNeeded)){el.scrollIntoViewIfNeeded();}else{el.scrollIntoView();}},render:function(){var items=this.state.filteredItems.map(function(item){var selected=(item===this.state.selected);return(React.createElement("li",{className:"select-item"+(selected?" selected-item":""),onClick:_.partial(this.handleSelect,item),ref:item.displayName},item.displayName));},this);return(React.createElement("div",{className:"select-container"},!this.state.focused&&React.createElement("p",{className:"select-display",onClick:this.onFocus},this.props.selectDisplay," "),React.createElement("input",{type:"text",ref:"filter",class:"select-input-filter",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp}),this.state.focused&&React.createElement("ul",{className:"select-list"},items)));}});var List=React.createClass({displayName:"List",handleRemove:function(item){this.props.handleRemove(item);},render:function(){var listItems=this.props.items.map(function(item){return(React.createElement("li",{className:"select-list-item label"},item.displayName,React.createElement("span",{className:"select-list-item-remove",onClick:_.partial(this.handleRemove,item)},"x")));},this);return(React.createElement("ul",{className:"select-list-container"},listItems));},});var Item={};function createItem(displayName,data){return Object.create(Item,{displayName:{value:displayName,enumerable:true,},data:{value:data,enumerable:true,},});}
module.exports={Selector:Selector,List:List,Item:Item,createItem:createItem,};}]);