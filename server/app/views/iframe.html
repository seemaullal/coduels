<html>

<head>
    <title>Mocha</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="/mocha/mocha.css">
    <script src="/mocha/mocha.js"></script>
    <script src="/chai/chai.js"></script>
    <script src="/socket.io-client/socket.io.js"></script>

    <!-- sets the Behavior Driven Development interface to show on mocha.run() -->
    <script>
    mocha.setup('bdd');
    </script>

    <!-- mocha error-handling & variable defintions -->
    <script>
    function assert(expr, msg) {
        if (!expr) throw new Error(msg || 'failed');
    }
    var expect = chai.expect;
    </script>

    <!-- Firebase dependency -->
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

    <!-- Source file -->
    <script type="text/javascript">

    var socket = io();
    var g = document.createElement('script');
    var s = document.getElementsByTagName('script')[0];

    socket.on('theCode', function (userCode){

        console.log('this is the value from the socket:', userCode)
        g.text = userCode.code;
        s.parentNode.insertBefore(g, s);

        mocha.run(function(failures){
            console.log('this is the userId in iframe:', userCode.userId)
            socket.emit('failures', {failures: failures, userId: userCode.userId});
        });
    });

    // var fromUserPad = new Firebase('http://dazzling-torch-169.firebaseio.com/codes');

    // fromUserPad.on('value', function(snapshot) {

    //     var g = document.createElement('script');

    //     var s = document.getElementsByTagName('script')[0];

    //     g.text = snapshot.val();
    //     console.log('this is the snapshot value:', snapshot.val())
    //     s.parentNode.insertBefore(g, s);

    //     mocha.run(function(failures){
    //         console.log("# of failures: ", failures);
    //     });
    // });

    </script>

    <!-- Test file -->
    <script type="text/javascript">
    <%- exercise %>
    </script>

</head>

<body>
    <div id="mocha"></div> <!-- mocha runner div -->
</body>


</html>
